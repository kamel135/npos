const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CLcWQdf2.js","assets/index-CfvA770r.css"])))=>i.map(i=>d[i]);
var Vs=Object.defineProperty,Ds=Object.defineProperties;var Ms=Object.getOwnPropertyDescriptors;var co=Object.getOwnPropertySymbols;var Ps=Object.prototype.hasOwnProperty,Ts=Object.prototype.propertyIsEnumerable;var mo=(i,l,d)=>l in i?Vs(i,l,{enumerable:!0,configurable:!0,writable:!0,value:d}):i[l]=d,We=(i,l)=>{for(var d in l||(l={}))Ps.call(l,d)&&mo(i,d,l[d]);if(co)for(var d of co(l))Ts.call(l,d)&&mo(i,d,l[d]);return i},lt=(i,l)=>Ds(i,Ms(l));var Z=(i,l,d)=>new Promise((m,$)=>{var D=p=>{try{S(d.next(p))}catch(x){$(x)}},T=p=>{try{S(d.throw(p))}catch(x){$(x)}},S=p=>p.done?m(p.value):Promise.resolve(p.value).then(D,T);S((d=d.apply(i,l)).next())});import{a as Fe,b as Et,r as Mo,c as n,o as s,d as h,e as Q,t,f as e,g as I,h as nt,i as C,j as ze,k as Qe,l as ee,m as ie,w as E,T as Ye,n as Po,u as o,p as de,q as N,s as As,v as js,x as Ct,y as wt,z as xe,A as ke,F as ce,B as ge,C as Rt,D as Tt,E as Wt,G as fe,H as dt,I as Jt,J as vt,K as it,L as kt,M as ft,N as Ls,O as ct,P as Ae,Q as ye,R as Oe,S as Bs,U as Os,V as He,W as Es,X as zs,Y as vo,Z as st,_ as po}from"./index-CLcWQdf2.js";import{u as Kt,a as To,_ as ut,b as Ao,c as Ns,d as Fs,e as Rs,p as Ut}from"./posUI-DTgWktYq.js";import{u as zt,P as Us,E as Hs,f as Nt,C as jo,a as qs,b as Ws,g as Gt,_ as Lo,p as Bo,c as Gs,d as Qs,e as Ys,h as Js,i as Ks,j as Xs,R as Zs,k as ea,l as ta,m as oa,n as sa,o as aa,q as la,r as na,s as ra,t as ia}from"./posSync-DNlvupde.js";import{useBootstrapStore as ua}from"./bootstrap-BaxiQ869.js";const da={name:"Loading",props:{text:{type:String,default:"Loading..."}},components:{LoadingIndicator:Et}},ca={class:"flex items-center text-base text-ink-gray-4"};function ma(i,l,d,m,$,D){const T=Mo("LoadingIndicator");return s(),n("div",ca,[h(T,{class:"-ml-1 mr-2 h-3 w-3"}),Q(" "+t(d.text),1)])}const va=Fe(da,[["render",ma]]),pa={name:"Card",props:{title:{type:String},subtitle:{type:String},loading:{type:Boolean}},components:{LoadingText:va}},fa={class:"flex flex-col rounded-lg border bg-white px-6 py-5 shadow"},ga={class:"flex items-baseline justify-between"},ha={class:"flex items-baseline space-x-2"},_a={key:0,class:"flex items-center space-x-2"},ya={class:"text-xl font-semibold"},ba={key:0,class:"flex items-center space-x-2"},xa={key:0,class:"mt-1.5 text-base text-gray-600"},wa={key:1,class:"mt-4 flex flex-auto flex-col items-center justify-center rounded-md"},ka={key:2,class:"mt-4 flex-auto overflow-auto"};function $a(i,l,d,m,$,D){const T=Mo("LoadingText");return s(),n("div",fa,[e("div",ga,[e("div",ha,[i.$slots["actions-left"]?(s(),n("div",_a,[nt(i.$slots,"actions-left")])):I("",!0),e("h2",ya,t(d.title),1)]),i.$slots.actions?(s(),n("div",ba,[nt(i.$slots,"actions")])):I("",!0)]),d.subtitle?(s(),n("p",xa,t(d.subtitle),1)):I("",!0),d.loading?(s(),n("div",wa,[h(T)])):i.$slots.default?(s(),n("div",ka,[nt(i.$slots,"default")])):I("",!0)])}const pt=Fe(pa,[["render",$a]]),At="pwa-install-dismissed",Ca=7,Sa=Ca*24*60*60*1e3,Ot=()=>typeof window!="undefined",Ia=()=>Ot()?window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0:!1,Va=()=>{if(!Ot())return!1;try{const i=localStorage.getItem(At);if(!i)return!1;const l=new Date(i).getTime();return Number.isNaN(l)?(localStorage.removeItem(At),!1):Date.now()-l<Sa?!0:(localStorage.removeItem(At),!1)}catch(i){return console.warn("[PWA] Failed to read dismissal state",i),!1}};function Da(){const i=C(null),l=C(!1),d=C(!1),m=C(!1),$=()=>{const V=Ia();if(d.value=V,V&&(l.value=!1,m.value=!1,Ot()))try{localStorage.removeItem(At)}catch(O){console.warn("[PWA] Failed to clear dismissal state",O)}return V},D=V=>{V.preventDefault(),i.value=V,l.value=!0,!d.value&&!Va()&&(m.value=!0)},T=()=>{i.value=null,$()},S=()=>{document.visibilityState==="visible"&&$()};return ze(()=>{$()||(window.addEventListener("beforeinstallprompt",D),window.addEventListener("appinstalled",T),typeof document!="undefined"&&document.addEventListener("visibilitychange",S))}),Qe(()=>{window.removeEventListener("beforeinstallprompt",D),window.removeEventListener("appinstalled",T),typeof document!="undefined"&&document.removeEventListener("visibilitychange",S)}),{isInstallable:l,isInstalled:d,showInstallBadge:m,promptInstall:()=>Z(this,null,function*(){if(!i.value)return!1;i.value.prompt();const{outcome:V}=yield i.value.userChoice;return i.value=null,l.value=!1,V==="accepted"?(m.value=!1,$(),!0):(m.value=!1,!1)}),dismissBadge:()=>{m.value=!1},snoozeBadge:()=>{if(m.value=!1,!!Ot())try{localStorage.setItem(At,new Date().toISOString())}catch(V){console.warn("[PWA] Failed to snooze install badge",V)}}}}const Ma={key:0,class:"lg:hidden fixed top-0 start-0 end-0 bg-white border-b border-gray-200 shadow-md z-[250]",role:"dialog","aria-labelledby":"install-banner-title"},Pa={class:"px-3 py-2.5"},Ta={class:"flex items-center gap-2"},Aa={class:"flex-1 min-w-0 me-2"},ja={id:"install-banner-title",class:"text-xs font-semibold mb-0.5 leading-tight",style:{color:"#111827"}},La={class:"text-[10px] leading-tight mb-1",style:{color:"#4B5563"}},Ba={class:"flex items-center gap-1.5 flex-shrink-0"},Oa=["aria-label","title"],Ea={__name:"InstallAppBadge",setup(i){const{showInstallBadge:l,promptInstall:d,dismissBadge:m,snoozeBadge:$}=Da(),D=ee(()=>l.value),T=()=>Z(this,null,function*(){yield d()}),S=()=>{m()},p=()=>{$()};return(x,g)=>(s(),ie(Ye,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-full","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-full"},{default:E(()=>[D.value?(s(),n("div",Ma,[e("div",Pa,[e("div",Ta,[g[1]||(g[1]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-10 h-10 rounded-lg flex items-center justify-center shadow-sm",style:{"background-color":"#4F46E5"}},[e("svg",{class:"w-6 h-6",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"#ffffff",d:"M20 7h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v3H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zM10 4h4v3h-4V4zm10 16H4V9h16v11z"})])])],-1)),e("div",Aa,[e("h3",ja,t(x.__("Install INTouch")),1),e("p",La,t(x.__("Faster access and offline support")),1),e("button",{onClick:p,class:"text-[10px] underline hover:no-underline transition-all",style:{color:"#6B7280"}},t(x.__("Snooze for 7 days")),1)]),e("div",Ba,[e("button",{onClick:T,class:"px-3 py-1.5 text-xs font-medium rounded hover:opacity-90 active:opacity-80 transition-opacity touch-manipulation shadow-sm whitespace-nowrap",style:{"background-color":"#4F46E5",color:"#ffffff"}},t(x.__("Install")),1),e("button",{onClick:S,class:"p-1.5 hover:bg-gray-100 rounded transition-colors touch-manipulation flex-shrink-0",style:{color:"#6B7280"},"aria-label":x.__("Close"),title:x.__("Close (shows again next session)")},g[0]||(g[0]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Oa)])])])])):I("",!0)]),_:1}))}},za={key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center"},Na={class:"relative z-10"},Fa={key:"confirm",class:"bg-white rounded-2xl shadow-2xl p-8 max-w-md mx-4 transform"},Ra={class:"text-2xl font-bold text-gray-900 text-center mb-3"},Ua={class:"text-gray-600 text-center mb-8 leading-relaxed"},Ha={class:"flex gap-3"},qa={key:"clearing",class:"bg-white rounded-2xl shadow-2xl p-12 max-w-md mx-4 transform"},Wa={class:"flex flex-col items-center"},Ga={class:"text-xl font-bold text-gray-900 mb-2"},Qa={class:"text-gray-500 text-center"},Ya={__name:"ClearCacheOverlay",props:{show:{type:Boolean,default:!1}},emits:["cancel","confirm"],setup(i,{expose:l,emit:d}){const m=d,$=C(!1);function D(){$.value=!0,m("confirm")}function T(){$.value=!1}return l({reset:T}),(S,p)=>(s(),ie(Po,{to:"body"},[h(Ye,{name:"overlay"},{default:E(()=>[i.show?(s(),n("div",za,[p[4]||(p[4]=e("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm"},null,-1)),e("div",Na,[h(Ye,{name:"card",mode:"out-in"},{default:E(()=>[$.value?(s(),n("div",qa,[e("div",Wa,[p[2]||(p[2]=e("div",{class:"relative mb-6"},[e("div",{class:"w-24 h-24 rounded-full border-4 border-blue-200 border-t-blue-600 animate-spin"}),e("div",{class:"absolute inset-0 flex items-center justify-center"},[e("svg",{class:"w-10 h-10 text-blue-600 animate-pulse",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C8.13 2 5 3.12 5 4.5V7c0 1.38 3.13 2.5 7 2.5S19 8.38 19 7V4.5C19 3.12 15.87 2 12 2zM5 9v3c0 1.38 3.13 2.5 7 2.5s7-1.12 7-2.5V9c0 1.38-3.13 2.5-7 2.5S5 10.38 5 9zm0 5v3c0 1.38 3.13 2.5 7 2.5s7-1.12 7-2.5v-3c0 1.38-3.13 2.5-7 2.5S5 15.38 5 14z"})])])],-1)),e("h3",Ga,t(S.__("Clearing Cache...")),1),e("p",Qa,t(S.__("Please wait while we clear your cached data")),1),p[3]||(p[3]=e("div",{class:"flex gap-2 mt-6"},[e("div",{class:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{"animation-delay":"0ms"}}),e("div",{class:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{"animation-delay":"150ms"}}),e("div",{class:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{"animation-delay":"300ms"}})],-1))])])):(s(),n("div",Fa,[p[1]||(p[1]=e("div",{class:"flex justify-center mb-6"},[e("div",{class:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-10 h-10 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])])],-1)),e("h3",Ra,t(S.__("Clear Cache?")),1),e("p",Ua,t(S.__("This will clear all cached items, customers, and stock data. Invoices and drafts will be preserved.")),1),e("div",Ha,[e("button",{onClick:p[0]||(p[0]=x=>S.$emit("cancel")),class:"flex-1 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-xl transition-all active:scale-95"},t(S.__("Cancel")),1),e("button",{onClick:D,class:"flex-1 px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-xl transition-all active:scale-95 shadow-lg shadow-red-500/30"},t(S.__("Clear Cache")),1)])]))]),_:1})])])):I("",!0)]),_:1})]))}},Ja=Fe(Ya,[["__scopeId","data-v-ac503ea1"]]),Ka={class:"hidden lg:flex w-16 flex-shrink-0 bg-white border-e border-gray-200 flex-col items-center py-4 flex flex-col gap-2"},Xa=["title"],Za={class:"absolute start-full ms-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50"},el=["title"],tl={class:"absolute start-full ms-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50"},ol=["title"],sl={class:"absolute start-full ms-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50"},al=["title"],ll={class:"absolute start-full ms-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50"},nl=["title"],rl={class:"absolute start-full ms-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50"},il=["title"],ul={class:"absolute start-full ms-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50"},dl={__name:"ManagementSlider",emits:["menu-clicked"],setup(i,{emit:l}){const d=l,m=C("");function $(D){m.value=D,d("menu-clicked",D)}return(D,T)=>(s(),n("div",Ka,[e("button",{onClick:T[0]||(T[0]=S=>$("dashboard")),class:N(["w-12 h-12 rounded-lg flex items-center justify-center transition-all relative group",m.value==="dashboard"?"bg-blue-100 text-blue-600":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"]),title:D.__("Dashboard")},[h(o(de),{name:"layout",class:"w-5 h-5"}),e("div",Za,t(D.__("Dashboard")),1)],10,Xa),e("button",{onClick:T[1]||(T[1]=S=>$("promotions")),class:N(["w-12 h-12 rounded-lg flex items-center justify-center transition-all relative group",m.value==="promotions"?"bg-green-100 text-green-600":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"]),title:D.__("Promotions")},[h(o(de),{name:"tag",class:"w-5 h-5"}),e("div",tl,t(D.__("Promotions")),1)],10,el),e("button",{onClick:T[2]||(T[2]=S=>$("products")),class:N(["w-12 h-12 rounded-lg flex items-center justify-center transition-all relative group",m.value==="products"?"bg-purple-100 text-purple-600":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"]),title:D.__("Products")},[h(o(de),{name:"package",class:"w-5 h-5"}),e("div",sl,t(D.__("Products")),1)],10,ol),e("button",{onClick:T[3]||(T[3]=S=>$("reports")),class:N(["w-12 h-12 rounded-lg flex items-center justify-center transition-all relative group",m.value==="reports"?"bg-orange-100 text-orange-600":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"]),title:D.__("Reports")},[h(o(de),{name:"bar-chart-2",class:"w-5 h-5"}),e("div",ll,t(D.__("Reports")),1)],10,al),e("button",{onClick:T[4]||(T[4]=S=>$("invoices")),class:N(["w-12 h-12 rounded-lg flex items-center justify-center transition-all relative group",m.value==="invoices"?"bg-indigo-100 text-indigo-600":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"]),title:D.__("Invoice Management")},[h(o(de),{name:"file-text",class:"w-5 h-5"}),e("div",rl,t(D.__("Invoice Management")),1)],10,nl),T[6]||(T[6]=e("div",{class:"w-8 border-t border-gray-200 my-2"},null,-1)),e("button",{onClick:T[5]||(T[5]=S=>$("settings")),class:N(["w-12 h-12 rounded-lg flex items-center justify-center transition-all relative group",m.value==="settings"?"bg-gray-100 text-gray-900":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"]),title:D.__("Settings")},[h(o(de),{name:"settings",class:"w-5 h-5"}),e("div",ul,t(D.__("Settings")),1)],10,il)]))}},cl=["title"],ml=["fill"],vl=["stroke-linecap","stroke-linejoin","stroke-width","d"],pl={key:0,class:"absolute -top-1 -end-1 bg-orange-600 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center"},fo={__name:"ActionButton",props:{icon:{type:String,required:!0},title:{type:String,default:""},variant:{type:String,default:"gray",validator:i=>["gray","green","orange","red","blue"].includes(i)},size:{type:String,default:"md",validator:i=>["sm","md","lg"].includes(i)},badge:{type:[String,Number],default:null},iconFill:{type:String,default:"none"},strokeLinecap:{type:String,default:"round"},strokeLinejoin:{type:String,default:"round"},strokeWidth:{type:String,default:"2"},animate:{type:Boolean,default:!1}},emits:["click"],setup(i){const l=i,d=ee(()=>{const $="p-1.5 sm:p-2 hover:bg-gray-50 rounded-lg transition-colors group touch-manipulation",D=l.animate?"animate-pulse":"";return`${$} ${D}`.trim()}),m=ee(()=>{const $={sm:"w-3.5 h-3.5 sm:w-4 sm:h-4",md:"w-4 h-4 sm:w-5 sm:h-5",lg:"w-5 h-5 sm:w-6 sm:h-6"},D={gray:"text-gray-600 group-hover:text-gray-900",green:"text-green-600",orange:"text-orange-600",red:"text-red-600",blue:"text-blue-600"};return`${$[l.size]} ${D[l.variant]}`});return($,D)=>(s(),n("button",{onClick:D[0]||(D[0]=T=>$.$emit("click",T)),title:i.title,class:N([d.value,"relative"])},[(s(),n("svg",{class:N(m.value),fill:i.iconFill,stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":i.strokeLinecap,"stroke-linejoin":i.strokeLinejoin,"stroke-width":i.strokeWidth,d:i.icon},null,8,vl)],10,ml)),i.badge?(s(),n("span",pl,t(i.badge),1)):I("",!0)],10,cl))}},fl=["fill"],gl=["stroke-linecap","stroke-linejoin","stroke-width","d"],hl={key:0,class:"text-gray-600"},go={__name:"StatusBadge",props:{variant:{type:String,default:"blue",validator:i=>["blue","green","orange","red","gray"].includes(i)},icon:{type:String,default:null},iconFill:{type:String,default:"none"},strokeLinecap:{type:String,default:"round"},strokeLinejoin:{type:String,default:"round"},strokeWidth:{type:String,default:"2"},text:{type:String,default:""},label:{type:String,default:null},value:{type:String,default:null},size:{type:String,default:"sm",validator:i=>["xs","sm","md"].includes(i)}},setup(i){const l=i,d=ee(()=>{const D={blue:"bg-blue-50 border-blue-100",green:"bg-green-50 border-green-100",orange:"bg-orange-50 border-orange-100",red:"bg-red-50 border-red-100",gray:"bg-gray-50 border-gray-100"};return D[l.variant]||D.blue}),m=ee(()=>{const D={blue:"text-blue-600",green:"text-green-600",orange:"text-orange-600",red:"text-red-600",gray:"text-gray-600"};return D[l.variant]||D.blue}),$=ee(()=>{const D={xs:"text-xs",sm:"text-sm",md:"text-base"};return D[l.size]||D.sm});return(D,T)=>(s(),n("div",{class:N(["flex items-center gap-2 px-3 py-1.5 rounded-lg border",d.value])},[i.icon?(s(),n("svg",{key:0,class:N(["w-4 h-4",m.value]),fill:i.iconFill,stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":i.strokeLinecap,"stroke-linejoin":i.strokeLinejoin,"stroke-width":i.strokeWidth,d:i.icon},null,8,gl)],10,fl)):I("",!0),i.label||i.value?(s(),n("div",{key:1,class:N($.value)},[i.label?(s(),n("span",hl,t(i.label),1)):I("",!0),i.value?(s(),n("span",{key:1,class:N(["font-semibold text-gray-900",{"ms-1":i.label}])},t(i.value),3)):I("",!0)],2)):(s(),n("span",{key:2,class:N(["font-semibold text-gray-900",$.value])},t(i.text),3))],2))}},Mt=Ct.create("Locale"),Ht=C("en"),Bt=C("ltr"),Oo="pos_next_language";let ho=!1;function _o(i){return i?`https://flagcdn.com/h24/${i.toLowerCase()}.png`:null}function yo(i){return i?`https://flagcdn.com/${i.toLowerCase()}.svg`:null}const tt={en:{name:"English",nativeName:"English",countryCode:"us",dir:"ltr"},ar:{name:"Arabic",nativeName:"العربية",countryCode:"eg",dir:"rtl"}};function _l(){return Z(this,null,function*(){try{const l=ua().getPreloadedLocale();if(l&&tt[l])return Mt.info(`Using preloaded language from bootstrap: ${l}`),l}catch(i){Mt.debug("Bootstrap store not available, fetching language from API")}try{const i=yield wt("pos_next.api.localization.get_user_language",{});if(i!=null&&i.locale&&tt[i.locale])return Mt.info(`Fetched language from server: ${i.locale}`),i.locale}catch(i){Mt.warn("Failed to fetch language from server",i)}return null})}function yl(){var d,m;if(typeof window!="undefined"&&((m=(d=window.frappe)==null?void 0:d.boot)!=null&&m.lang)){const $=window.frappe.boot.lang.toLowerCase();if(tt[$])return $}const i=localStorage.getItem(Oo);if(i&&tt[i])return i;const l=navigator.language.split("-")[0].toLowerCase();return tt[l]?l:"en"}function Xt(){const i=ee(()=>Ht.value),l=ee(()=>Bt.value),d=ee(()=>Bt.value==="rtl"),m=ee(()=>{const p=tt[i.value]||tt.en;return lt(We({},p),{flagUrl:_o(p.countryCode),flagUrlSvg:yo(p.countryCode)})});function $(p){return Z(this,null,function*(){if(!tt[p]){console.warn(`Locale ${p} not supported`);return}const x=tt[p];Ht.value=p,Bt.value=x.dir,document.documentElement.setAttribute("dir",x.dir),document.documentElement.setAttribute("lang",p),x.dir==="rtl"?document.documentElement.classList.add("rtl"):document.documentElement.classList.remove("rtl"),localStorage.setItem(Oo,p);try{yield wt("pos_next.api.localization.change_user_language",{locale:p})}catch(g){console.error("Failed to save language preference to Frappe:",g)}if(typeof window!="undefined"&&window.$changeLanguage)try{yield window.$changeLanguage(p)}catch(g){console.error("Failed to load translations:",g)}})}function D(p){const x=tt[p];x&&(Ht.value=p,Bt.value=x.dir,typeof document!="undefined"&&(document.documentElement.setAttribute("dir",x.dir),document.documentElement.setAttribute("lang",p),x.dir==="rtl"?document.documentElement.classList.add("rtl"):document.documentElement.classList.remove("rtl")))}function T(){return Z(this,null,function*(){const p=yl();if(D(p),!js.isOffline&&!ho){ho=!0;const x=yield _l();x&&x!==p&&(Mt.info(`Server language (${x}) differs from cached (${p}), switching`),yield $(x))}})}ze(()=>{T()});const S=ee(()=>{const p={};for(const[x,g]of Object.entries(tt))p[x]=lt(We({},g),{flagUrl:_o(g.countryCode),flagUrlSvg:yo(g.countryCode)});return p});return{locale:i,dir:l,isRTL:d,localeConfig:m,supportedLocales:S,changeLocale:$,initLocale:T,translationVersion:As}}const bl={class:"text-end mx-1 hidden sm:block"},xl={class:"text-sm font-semibold text-gray-900"},wl={class:"px-4 py-3 border-b border-gray-100 flex items-center"},kl={class:"flex-1 mx-2 min-w-0"},$l={class:"text-sm font-semibold text-gray-900 truncate"},Cl={key:0,class:"text-xs text-gray-500 mt-0.5 truncate"},Sl={class:"py-1"},Il={key:0,class:"my-2 border-gray-100"},Vl={class:"md:hidden"},Dl={class:"flex-1"},Ml={class:"flex items-center gap-2"},Pl=["src","alt"],Tl={key:0,class:"bg-gray-50 border-t border-gray-100"},Al=["onClick"],jl=["src","alt"],Ll={class:"flex-1"},Bl={key:0,class:"w-4 h-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20"},Ol={key:1,class:"my-2 border-gray-100"},El={class:"mx-4"},zl={__name:"UserMenu",props:{userName:{type:String,required:!0},profileName:{type:String,default:null},profileImage:{type:String,default:null},showLogout:{type:Boolean,default:!0},showDivider:{type:Boolean,default:!0}},emits:["logout","menu-opened","menu-closed"],setup(i,{emit:l}){const d=v=>{const b=v.size==="sm"?"w-9 h-9":"w-10 h-10",B=v.image?"bg-gray-200":"bg-gradient-to-br from-blue-500 to-blue-600";return Rt("div",{class:`${b} rounded-full flex items-center justify-center shadow-md overflow-hidden flex-shrink-0 ${B}`},[v.image?Rt("img",{src:v.image,alt:v.name,class:"w-full h-full object-cover"}):Rt("span",{class:"text-sm font-bold text-white"},v.initials)])},{locale:m,supportedLocales:$,changeLocale:D}=Xt(),T=i,S=l,p=C(null),x=C(!1),g=C(!1),V=ee(()=>{const v=T.userName.split(" ");return v.length>=2?(v[0][0]+v[1][0]).toUpperCase():T.userName.substring(0,2).toUpperCase()});xe(x,v=>{v?S("menu-opened"):(S("menu-closed"),g.value=!1)});function O(){x.value=!1}function w(){x.value=!1,S("logout")}function M(v){return Z(this,null,function*(){v!==m.value&&(x.value=!1,yield D(v))})}function y(v){x.value&&p.value&&!p.value.contains(v.target)&&(x.value=!1)}return ze(()=>{document.addEventListener("click",y)}),Qe(()=>{document.removeEventListener("click",y)}),(v,b)=>{var B,H;return s(),n("div",{ref_key:"menuRef",ref:p,class:"relative"},[e("button",{onClick:b[0]||(b[0]=le=>x.value=!x.value),class:"flex items-center gap-3 px-3 py-2 hover:bg-gray-50 rounded-lg transition-colors"},[e("div",bl,[e("p",xl,t(i.userName),1)]),h(d,{image:i.profileImage,name:i.userName,initials:V.value,size:"sm"},null,8,["image","name","initials"]),b[2]||(b[2]=e("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),x.value?(s(),n("div",{key:0,onClick:O,class:"absolute end-0 mt-2 w-60 bg-white rounded-xl shadow-xl border border-gray-200 py-2 z-[250]"},[e("div",wl,[h(d,{image:i.profileImage,name:i.userName,initials:V.value,size:"md"},null,8,["image","name","initials"]),e("div",kl,[e("p",$l,t(i.userName),1),i.profileName?(s(),n("p",Cl,t(i.profileName),1)):I("",!0)])]),e("div",Sl,[nt(v.$slots,"menu-items")]),i.showDivider?(s(),n("hr",Il)):I("",!0),nt(v.$slots,"additional-actions"),e("div",Vl,[b[6]||(b[6]=e("hr",{class:"my-2 border-gray-100"},null,-1)),e("button",{onClick:b[1]||(b[1]=ke(le=>g.value=!g.value,["stop"])),class:"w-full text-start px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-3 transition-colors"},[b[4]||(b[4]=e("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"})],-1)),e("span",Dl,t(v.__("Language")),1),e("div",Ml,[e("img",{src:(B=o($)[o(m)])==null?void 0:B.flagUrlSvg,alt:(H=o($)[o(m)])==null?void 0:H.name,class:"w-5 h-3.5 object-cover rounded-sm shadow-sm"},null,8,Pl),(s(),n("svg",{class:N(["w-4 h-4 text-gray-400 transition-transform",{"rotate-180":g.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},b[3]||(b[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])]),g.value?(s(),n("div",Tl,[(s(!0),n(ce,null,ge(o($),(le,K)=>(s(),n("button",{key:K,onClick:ke(L=>M(K),["stop"]),class:N(["w-full text-start px-4 py-2.5 text-sm flex items-center gap-3 transition-colors",o(m)===K?"bg-blue-50 text-blue-700":"text-gray-600 hover:bg-gray-100"])},[e("img",{src:le.flagUrlSvg,alt:le.name,class:"w-5 h-3.5 object-cover rounded-sm shadow-sm ms-6"},null,8,jl),e("span",Ll,t(le.nativeName),1),o(m)===K?(s(),n("svg",Bl,b[5]||(b[5]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)]))):I("",!0)],10,Al))),128))])):I("",!0)]),i.showLogout?(s(),n("hr",Ol)):I("",!0),i.showLogout?(s(),n("button",{key:2,onClick:w,class:"w-full text-start px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 flex items-center gap-3 transition-colors"},[b[7]||(b[7]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1)),e("span",El,t(v.__("Logout")),1)])):I("",!0)])):I("",!0)],512)}}},Nl=["disabled","title"],Fl=["src","alt"],Rl={class:"hidden sm:inline text-xs sm:text-sm"},Ul={class:"py-1"},Hl=["onClick"],ql=["src","alt"],Wl={__name:"LanguageSwitcher",setup(i){const{locale:l,localeConfig:d,isRTL:m,supportedLocales:$,changeLocale:D}=Xt(),T=C(!1),S=C(!1),p=C(null),x=()=>!S.value&&(T.value=!T.value),g=O=>Z(this,null,function*(){if(T.value=!1,!(O===l.value||S.value)){S.value=!0;try{yield D(O)}finally{S.value=!1}}}),V=O=>{var w;return((w=p.value)==null?void 0:w.contains(O.target))||(T.value=!1)};return ze(()=>document.addEventListener("click",V)),Qe(()=>document.removeEventListener("click",V)),(O,w)=>(s(),n("div",{ref_key:"dropdownRef",ref:p,class:"relative"},[e("button",{onClick:x,class:N(["flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors disabled:opacity-60 disabled:cursor-wait",{"flex-row-reverse":o(m)}]),disabled:S.value,title:o(d).nativeName},[S.value?(s(),ie(o(Et),{key:0,class:"w-4 h-4"})):(s(),n(ce,{key:1},[e("img",{src:o(d).flagUrlSvg,alt:o(d).name,class:"w-5 h-3.5 sm:w-6 sm:h-4 object-cover rounded-sm shadow-sm"},null,8,Fl),e("span",Rl,t(o(d).nativeName),1),h(o(de),{name:"chevron-down",class:N(["w-3 h-3 sm:w-4 sm:h-4 transition-transform text-gray-500",{"rotate-180":T.value}])},null,8,["class"])],64))],10,Nl),h(Ye,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:E(()=>[T.value?(s(),n("div",{key:0,class:N(["absolute z-50 mt-2 w-36 rounded-lg bg-white shadow-lg ring-1 ring-black/5",o(m)?"start-0":"end-0"]),role:"menu"},[e("div",Ul,[(s(!0),n(ce,null,ge(o($),(M,y)=>(s(),n("button",{key:y,onClick:v=>g(y),class:N(["flex items-center w-full px-4 py-2 text-sm transition-colors",[o(l)===y?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-100",M.dir==="rtl"?"flex-row-reverse":""]]),role:"menuitem"},[e("img",{src:M.flagUrlSvg,alt:M.name,class:N(["w-6 h-4 object-cover rounded-sm shadow-sm",M.dir==="rtl"?"ms-3":"me-3"])},null,10,ql),e("span",{class:N(["flex-1",M.dir==="rtl"?"text-end":"text-start"])},t(M.nativeName),3),o(l)===y?(s(),ie(o(de),{key:0,name:"check",class:"w-4 h-4 text-blue-600"})):I("",!0)],10,Hl))),128))])],2)):I("",!0)]),_:1})],512))}},Gl="1.10.0",Ql={class:"flex items-center"},Yl={class:"w-10 flex-shrink-0 flex items-center justify-center px-1"},Jl=["title","aria-label"],Kl={class:"w-16 flex-shrink-0 flex items-center justify-center"},Xl=["title"],Zl={class:"flex-1 flex justify-between items-center gap-1 sm:gap-2 px-2 sm:px-4 md:px-6"},en={key:0,class:"min-w-0 flex-shrink overflow-hidden"},tn={class:"flex items-center gap-1 sm:gap-2"},on={class:"hidden sm:inline-flex relative items-center px-1 sm:px-2 py-0.5 text-[8px] sm:text-[10px] font-bold bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-md shadow-sm hover:shadow-md transition-shadow flex-shrink-0"},sn={class:"relative"},an={key:0,class:"text-[9px] sm:text-xs text-gray-500 truncate hidden sm:block mt-0.5"},ln={key:1,class:"hidden lg:flex items-center gap-4 ms-6 flex-shrink-0"},nn={key:2,class:"flex lg:hidden items-center text-[10px] text-gray-600 font-medium flex-shrink-0 ms-1"},rn={class:"hidden xs:inline whitespace-nowrap"},un={class:"flex items-center gap-0.5 sm:gap-1 md:gap-2 flex-shrink-0"},dn=["title","aria-label"],cn={key:0,class:"w-4 h-4 sm:w-5 sm:h-5 text-green-600",fill:"currentColor",viewBox:"0 0 24 24"},mn={key:1,class:"w-4 h-4 sm:w-5 sm:h-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},vn={key:2,class:"absolute -top-1 -end-1 bg-orange-600 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-md"},pn={class:"relative"},fn=["aria-label"],gn={class:"bg-gray-900 text-white text-xs rounded-lg shadow-xl py-2 px-2.5 sm:px-3"},hn={class:"flex items-center justify-between mb-1.5 sm:mb-2 pb-1.5 sm:pb-2 border-b border-gray-700"},_n={class:"font-semibold text-[11px] sm:text-xs"},yn={class:"flex flex-col gap-1 sm:gap-1.5 text-[10px] sm:text-xs"},bn={class:"flex items-center justify-between"},xn={class:"text-gray-400"},wn={class:"font-semibold"},kn={key:0,class:"flex items-center justify-between"},$n={class:"text-gray-400"},Cn={class:"font-semibold text-[9px] sm:text-[10px]"},Sn={key:1,class:"flex items-center justify-between"},In={class:"text-gray-400"},Vn={class:"text-orange-400 font-semibold flex items-center gap-1"},Dn={key:2,class:"flex items-center justify-between"},Mn={class:"text-gray-400"},Pn={class:"text-green-400 font-semibold flex items-center gap-1"},Tn={class:"mt-1.5 sm:mt-2 pt-1.5 sm:pt-2 border-t border-gray-700"},An={class:"hidden md:block"},jn={key:0,class:"w-px h-4 sm:h-6 bg-gray-200 hidden md:block"},Ln={class:"hidden md:block"},Bn="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z",On="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z",En="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z",zn="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15",Nn={__name:"POSHeader",props:{currentTime:{type:String,required:!0},shiftDuration:{type:String,default:null},hasOpenShift:{type:Boolean,default:!1},profileName:{type:String,default:null},userName:{type:String,required:!0},userImage:{type:String,default:null},isOffline:{type:Boolean,default:!1},isSyncing:{type:Boolean,default:!1},pendingInvoicesCount:{type:Number,default:0},isAnyDialogOpen:{type:Boolean,default:!1},cacheSyncing:{type:Boolean,default:!1},cacheStats:{type:Object,default:()=>({items:0,lastSync:null})},stockSyncActive:{type:Boolean,default:!1},isRefreshing:{type:Boolean,default:!1}},emits:["sync-click","printer-click","refresh-click","menu-click","logout","menu-opened","menu-closed","clear-cache","header-collapsed"],setup(i,{expose:l,emit:d}){const m=C(!1),$=Gl,D=C(!1);function T(){D.value=!D.value,typeof window!="undefined"&&localStorage.setItem("pos-header-collapsed",D.value.toString()),S("header-collapsed",D.value)}l({toggleCollapse:T});const S=d;ze(()=>{typeof window!="undefined"&&localStorage.getItem("pos-header-collapsed")==="true"&&(D.value=!0,S("header-collapsed",!0))});function p(){m.value=!1,S("clear-cache")}function x(v){(!v.relatedTarget||!v.currentTarget.parentElement.contains(v.relatedTarget))&&setTimeout(()=>{m.value=!1},200)}const g=i;function V(){return!g.cacheStats||g.cacheStats.items===0?"text-red-600":g.cacheSyncing?"text-orange-600":"text-green-600"}function O(){return!g.cacheStats||g.cacheStats.items===0?__("Empty"):g.cacheSyncing?__("Syncing"):__("Ready")}function w(){return!g.cacheStats||g.cacheStats.items===0?"bg-red-500/20 text-red-300":g.cacheSyncing?"bg-orange-500/20 text-orange-300":"bg-green-500/20 text-green-300"}function M(){var b;return(b=g.cacheStats)!=null&&b.lastSync?new Date(g.cacheStats.lastSync).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):__("Never")}function y(){return!g.cacheStats||g.cacheStats.items===0?__("Cache empty"):g.cacheSyncing?__("Cache syncing"):__("Cache ready")}return(v,b)=>{var B,H;return s(),n("div",{class:"bg-white shadow-sm sticky top-0 z-[200] transition-all duration-300",style:Tt(D.value?{maxHeight:"0px",opacity:0,padding:0,margin:0,overflow:"hidden"}:{maxHeight:"100px",opacity:1,overflow:"visible"})},[e("div",Ql,[e("div",Yl,[e("button",{onClick:T,class:"w-7 h-7 flex items-center justify-center rounded-md hover:bg-gray-100 active:bg-gray-200 transition-colors touch-manipulation",title:D.value?v.__("Show Header Info"):v.__("Hide Header Info"),"aria-label":D.value?v.__("Show Header Info"):v.__("Hide Header Info")},[(s(),n("svg",{class:N(["w-4 h-4 text-gray-600 transition-transform duration-300",{"rotate-180":D.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},b[8]||(b[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))],8,Jl)]),e("div",Kl,[e("button",{class:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0 hover:from-blue-600 hover:to-blue-700 active:scale-95 transition-all","aria-label":"INTouch POS",title:v.__("INTouch POS")},b[9]||(b[9]=[e("span",{class:"text-white font-bold text-sm"},"iT",-1)]),8,Xl)]),e("div",Zl,[e("div",{class:N(["flex items-center gap-1 sm:gap-4 min-w-0 flex-1",{"overflow-hidden":D.value}])},[D.value?I("",!0):(s(),n("div",en,[e("div",tn,[b[11]||(b[11]=e("h1",{class:"text-xs sm:text-base font-bold text-gray-900 truncate flex-shrink"},t("INTouch"),-1)),e("span",on,[b[10]||(b[10]=e("span",{class:"absolute inset-0 bg-white/20 rounded-md animate-pulse"},null,-1)),e("span",sn,"v"+t(o($)),1)])]),i.profileName?(s(),n("p",an,t(i.profileName),1)):I("",!0)])),D.value?I("",!0):(s(),n("div",ln,[h(go,{variant:"blue",size:"sm",icon:Bn,text:i.currentTime},null,8,["text"]),i.hasOpenShift&&i.shiftDuration?(s(),ie(go,{key:0,variant:"green",size:"xs",icon:On,label:v.__("Shift Open:"),value:i.shiftDuration},null,8,["label","value"])):I("",!0)])),D.value?I("",!0):(s(),n("div",nn,[e("span",rn,t(i.currentTime),1)]))],2),e("div",un,[e("button",{onClick:b[0]||(b[0]=le=>v.$emit("sync-click")),class:N(["p-1.5 sm:p-2 hover:bg-gray-100 active:bg-gray-200 rounded-lg transition-colors relative group touch-manipulation",i.isSyncing?"animate-pulse":""]),title:i.isOffline?v.__("Offline ({0} pending)",[i.pendingInvoicesCount]):v.__("Online - Click to sync"),"aria-label":i.isOffline?v.__("Offline mode active"):v.__("Online mode active")},[i.isOffline?(s(),n("svg",mn,b[13]||(b[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414"},null,-1)]))):(s(),n("svg",cn,b[12]||(b[12]=[e("path",{d:"M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"},null,-1)]))),i.pendingInvoicesCount>0?(s(),n("span",vn,t(i.pendingInvoicesCount),1)):I("",!0)],10,dn),e("div",pn,[e("button",{onClick:b[1]||(b[1]=le=>m.value=!m.value),onBlur:x,class:"p-1.5 sm:p-2 hover:bg-gray-100 active:bg-gray-200 rounded-lg transition-colors relative touch-manipulation","aria-label":y()},[(s(),n("svg",{class:N(["w-4 h-4 sm:w-5 sm:h-5 transition-colors",V()]),fill:"currentColor",viewBox:"0 0 24 24"},b[14]||(b[14]=[e("path",{d:"M12 2C8.13 2 5 3.12 5 4.5V7c0 1.38 3.13 2.5 7 2.5S19 8.38 19 7V4.5C19 3.12 15.87 2 12 2zM5 9v3c0 1.38 3.13 2.5 7 2.5s7-1.12 7-2.5V9c0 1.38-3.13 2.5-7 2.5S5 10.38 5 9zm0 5v3c0 1.38 3.13 2.5 7 2.5s7-1.12 7-2.5v-3c0 1.38-3.13 2.5-7 2.5S5 15.38 5 14z"},null,-1)]),2)),i.cacheSyncing||i.isRefreshing?(s(),n("svg",{key:0,class:N(["w-4 h-4 sm:w-5 sm:h-5 absolute top-2 start-2 animate-spin opacity-70",V()]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},b[15]||(b[15]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)]),2)):I("",!0)],40,fn),m.value?(s(),n("div",{key:0,onMousedown:b[2]||(b[2]=ke(()=>{},["prevent"])),class:"absolute top-full mt-2 z-[999] w-[90vw] max-w-[240px] sm:max-w-[260px]",style:{left:"50%",transform:"translateX(-50%)"}},[e("div",gn,[b[19]||(b[19]=e("div",{class:"absolute bottom-full mb-px left-1/2 -translate-x-1/2"},[e("div",{class:"border-[5px] sm:border-4 border-transparent border-b-gray-900"})],-1)),e("div",hn,[e("span",_n,t(v.__("Cache")),1),e("span",{class:N(["px-1.5 sm:px-2 py-0.5 rounded text-[9px] sm:text-[10px] font-bold uppercase",w()])},t(O()),3)]),e("div",yn,[e("div",bn,[e("span",xn,t(v.__("Items:")),1),e("span",wn,t(((B=i.cacheStats)==null?void 0:B.items)||0),1)]),(H=i.cacheStats)!=null&&H.lastSync?(s(),n("div",kn,[e("span",$n,t(v.__("Last Sync:")),1),e("span",Cn,t(M()),1)])):I("",!0),i.cacheSyncing?(s(),n("div",Sn,[e("span",In,t(v.__("Status:")),1),e("span",Vn,[b[16]||(b[16]=e("svg",{class:"w-2.5 h-2.5 sm:w-3 sm:h-3 animate-spin",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)),Q(" "+t(v.__("Syncing...")),1)])])):I("",!0),i.stockSyncActive?(s(),n("div",Dn,[e("span",Mn,t(v.__("Auto-Sync:")),1),e("span",Pn,[b[17]||(b[17]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"},null,-1)),Q(" "+t(v.__("Active")),1)])])):I("",!0)]),e("div",Tn,[e("button",{onClick:p,class:"w-full px-2 py-1.5 sm:py-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 hover:text-red-200 rounded transition-colors font-semibold text-[10px] sm:text-[11px] flex items-center justify-center gap-1.5 active:scale-95"},[b[18]||(b[18]=e("svg",{class:"w-2.5 h-2.5 sm:w-3 sm:h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),Q(" "+t(v.__("Clear Cache")),1)])])])],32)):I("",!0)]),e("div",An,[h(fo,{icon:En,title:v.__("Print Invoice"),onClick:b[3]||(b[3]=le=>v.$emit("printer-click"))},null,8,["title"])]),h(fo,{icon:zn,title:i.isRefreshing?v.__("Refreshing..."):v.__("Refresh Items"),onClick:b[4]||(b[4]=le=>v.$emit("refresh-click")),class:N(["touch-manipulation p-1 sm:p-2",i.isRefreshing?"animate-spin":""]),"aria-label":i.isRefreshing?v.__("Refreshing items..."):v.__("Refresh items list")},null,8,["title","class","aria-label"]),D.value?I("",!0):(s(),n("div",jn)),e("div",Ln,[h(Wl)]),b[20]||(b[20]=e("div",{class:"w-px h-4 sm:h-6 bg-gray-200"},null,-1)),h(zl,{"user-name":i.userName,"profile-name":i.profileName,"profile-image":i.userImage,onLogout:b[5]||(b[5]=le=>v.$emit("logout")),onMenuOpened:b[6]||(b[6]=le=>v.$emit("menu-opened")),onMenuClosed:b[7]||(b[7]=le=>v.$emit("menu-closed"))},{"menu-items":E(()=>[nt(v.$slots,"menu-items")]),"additional-actions":E(()=>[nt(v.$slots,"additional-actions")]),_:3},8,["user-name","profile-name","profile-image"])])])])],4)}}},Fn={class:"flex flex-col h-full bg-gradient-to-b from-gray-200 to-gray-300"},Rn={class:"flex justify-around items-center px-3 py-3 bg-gray-200 gap-3 flex-shrink-0"},Un={class:"px-2 py-2 bg-gray-200 flex-shrink-0"},Hn={class:"flex items-center gap-3"},qn={class:"text-left flex-1"},Wn={class:"text-base font-bold text-gray-900"},Gn={key:0,class:"text-xs text-gray-500"},Qn={class:"bg-gradient-to-r from-blue-500 to-blue-600 p-2 flex items-center justify-between border-y-4 border-blue-700 flex-shrink-0"},Yn={class:"text-white"},Jn={class:"text-3xl font-bold"},Kn={class:"text-white text-right"},Xn={class:"text-3xl font-bold"},Zn={class:"flex-1 overflow-y-auto bg-white min-h-0 border-b-2 border-gray-300"},er={class:"w-full text-sm border-collapse"},tr={class:"bg-gradient-to-r from-blue-500 to-blue-600 text-white sticky top-0 z-10"},or={class:"p-2 text-center w-14 border-r border-blue-400"},sr={class:"p-2 text-right border-r border-blue-400"},ar={class:"p-2 text-center w-20 border-r border-blue-400"},lr={class:"p-2 text-center w-20 border-r border-blue-400"},nr=["onClick"],rr={class:"p-2 text-center border-r border-gray-200 align-middle"},ir={class:"text-xl font-bold text-blue-600"},ur={class:"p-2 text-right border-r border-gray-200 align-middle"},dr={key:0,class:"text-xs text-red-500 font-bold mt-1"},cr={class:"p-2 text-center border-r border-gray-200 align-middle"},mr={class:"p-2 text-center border-r border-gray-200 align-middle"},vr={class:"p-2 text-center align-middle"},pr=["checked","onChange"],fr={key:0},gr={colspan:"5",class:"p-10 text-center text-gray-400"},hr={class:"bg-white border-t-2 border-gray-300 px-2 py-1 flex-shrink-0"},_r={class:"grid grid-cols-3 gap-1 text-[10px] sm:text-xs"},yr={class:"text-center"},br={class:"text-gray-600"},xr={class:"text-blue-600 font-bold"},wr={class:"text-center"},kr={class:"text-gray-600"},$r={class:"text-blue-600 font-bold"},Cr={class:"text-center"},Sr={class:"text-gray-600"},Ir={class:"text-blue-600 font-bold"},Vr={class:"flex-shrink-0 h-64 border-t border-gray-400"},Dr={class:"p-4"},Mr={class:"text-sm text-gray-600 mb-3 text-center"},Pr=["placeholder"],Tr={key:0,class:"mb-4"},Ar={class:"text-xs text-gray-500 mb-2"},jr={class:"grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-48 overflow-y-auto"},Lr=["onClick"],Br={key:1,class:"text-center text-gray-400 text-sm py-4 border-2 border-dashed border-gray-200 rounded-lg mb-4"},Or={class:"flex gap-2 w-full"},qt="pos_quick_comments",Er={__name:"InvoiceCart",props:{items:{type:Array,default:()=>[]},customer:Object,subtotal:{type:Number,default:0},taxAmount:{type:Number,default:0},discountAmount:{type:Number,default:0},grandTotal:{type:Number,default:0},posProfile:String,currency:{type:String,default:"USD"},appliedOffers:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]}},emits:["update-quantity","remove-item","select-customer","create-customer","proceed-to-payment","clear-cart","save-draft","apply-coupon","show-coupons","show-offers","remove-offer","update-uom","edit-item","view-shift","show-drafts","show-history","show-return","close-shift"],setup(i,{expose:l,emit:d}){Kt();const m=zt(),{searchTerm:$}=Wt(m),{showWarning:D,showSuccess:T}=ft(),S=i,p=d,x=C(-1),g=C(""),V=C(!1),O=C(""),w=C(null),M=C(!1),y=C(null),v=C(1),b=C([]);ze(()=>{const r="pos_comments_version",_="2";localStorage.getItem(r)!==_&&(localStorage.removeItem(qt),localStorage.setItem(r,_)),B()});function B(){try{const r=localStorage.getItem(qt);r?b.value=JSON.parse(r):b.value=[]}catch(r){console.error("Error loading saved comments:",r),b.value=[]}}function H(){try{localStorage.setItem(qt,JSON.stringify(b.value))}catch(r){console.error("Error saving comments:",r)}}function le(r){r&&!b.value.includes(r)&&(b.value.unshift(r),b.value.length>20&&(b.value=b.value.slice(0,20)),H())}function K(r){O.value=r}const L=ee(()=>x.value<0||x.value>=S.items.length?null:S.items[x.value]),me=ee(()=>S.customer&&(S.customer.customer_name||S.customer.name||S.customer.customer)||__("Walk-In Customer")),we=ee(()=>S.customer&&(S.customer.mobile_no||S.customer.mobile||S.customer.phone)||null);xe(()=>S.items.length,r=>{r===0?(x.value=-1,g.value=""):(x.value>=r||r>0&&x.value===-1)&&(x.value=r-1)}),xe(x,()=>{});function J(r){return Nt(Number.parseFloat(r||0),S.currency)}function te(r){x.value=r}function ne(){return L.value?!0:(D(__("الرجاء اختيار صنف من القائمة أولاً")),!1)}function ae(r){if(r===Math.floor(r))return 1;const _=Math.round(r*1e4)/1e4;return Math.abs(_%.5)<1e-4?.5:Math.abs(_%.25)<1e-4?.25:Math.abs(_%.1)<1e-4?.1:.01}function he(){if(!ne())return;const r=L.value,_=ae(r.quantity),F=Math.round((r.quantity+_)*1e4)/1e4;p("update-quantity",r.row_id||r.item_code,F)}function oe(){if(!ne())return;const r=L.value,_=ae(r.quantity),F=Math.round((r.quantity-_)*1e4)/1e4;F<=0?p("remove-item",r.row_id||r.item_code):p("update-quantity",r.row_id||r.item_code,F)}function Ce(){ne()&&p("remove-item",L.value.row_id||L.value.item_code)}function be(r){}function Pe(){if(!L.value){D(__("الرجاء اختيار صنف من القائمة أولاً"));return}const r=Number.parseFloat(g.value);!Number.isNaN(r)&&r>0&&(p("update-quantity",L.value.row_id||L.value.item_code,r),g.value="",T(__("تم تحديث الكمية إلى {0}",[r])))}function W(){ne()&&(O.value=L.value.comment||"",V.value=!0,kt(()=>{var r;(r=w.value)==null||r.focus()}))}function se(){if(!L.value)return;const r=O.value.trim();r&&le(r);const _=lt(We({},L.value),{comment:r,display_comment_in_ui:!0});p("edit-item",_),V.value=!1,O.value="",T(__("تم حفظ التعليق"))}function _e(){if(!L.value)return;const r=O.value.trim(),_=lt(We({},L.value),{comment:r,display_comment_in_ui:!1});p("edit-item",_),V.value=!1,O.value="",T(__("تم حفظ التعليق في الفاتورة فقط"))}function De(r){p("edit-item",r),M.value=!1}return l({keypadValue:g,clearKeypad:()=>{g.value=""},removeSelectedItem:Ce,handleKeypadEnter:Pe,openCommentDialog:W,triggerAdd:()=>{const r=document.getElementById("invoice-item-search");r&&r.value}}),(r,_)=>(s(),n("div",Fn,[e("div",Rn,[e("button",{onClick:_[0]||(_[0]=F=>r.$emit("save-draft")),class:"circular-btn hold"},_[7]||(_[7]=[e("span",{class:"text-sm font-bold"},"HOLD",-1)])),e("button",{onClick:oe,class:"circular-btn danger"},_[8]||(_[8]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M20 12H4"})],-1)])),e("button",{onClick:he,class:"circular-btn danger"},_[9]||(_[9]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)])),e("button",{onClick:Ce,class:"circular-btn danger"},_[10]||(_[10]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Un,[e("button",{onClick:_[1]||(_[1]=F=>r.$emit("select-customer")),class:"w-full px-4 py-2.5 bg-white hover:bg-gray-50 border-2 border-gray-400 rounded-lg transition-colors flex items-center justify-between touch-manipulation"},[e("div",Hn,[_[11]||(_[11]=e("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),e("div",qn,[e("div",Wn,t(me.value),1),we.value?(s(),n("div",Gn,t(we.value),1)):I("",!0)])]),_[12]||(_[12]=e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])]),e("div",Qn,[e("div",Yn,[e("div",Jn,t(J(i.grandTotal)),1)]),e("div",Kn,[e("div",Xn,"NO "+t(v.value),1)])]),e("div",Zn,[e("table",er,[e("thead",tr,[e("tr",null,[e("th",or,t(r.__("الكمية")),1),e("th",sr,t(r.__("اسم الصنف")),1),e("th",ar,t(r.__("السعر")),1),e("th",lr,t(r.__("الإجمالي")),1),_[13]||(_[13]=e("th",{class:"p-2 text-center w-10"},[e("input",{type:"checkbox",class:"w-4 h-4",disabled:""})],-1))])]),e("tbody",null,[(s(!0),n(ce,null,ge(i.items,(F,j)=>(s(),n("tr",{key:F.row_id||j,onClick:ve=>te(j),class:N(["border-b-2 border-gray-200 cursor-pointer transition-all",x.value===j?"bg-blue-100 border-blue-300":"hover:bg-blue-50"])},[e("td",rr,[e("div",ir,t(F.quantity),1)]),e("td",ur,[e("div",{class:N(["font-bold text-sm",F.discount_percentage>0?"text-red-600":"text-blue-600"])},t(F.item_name),3),F.comment&&F.display_comment_in_ui!==!1?(s(),n("div",dr,t(F.comment),1)):I("",!0)]),e("td",cr,[e("div",{class:N(["font-bold text-sm",F.discount_percentage>0?"text-red-600":"text-blue-600"])},t(J(F.rate||F.price_list_rate||0)),3)]),e("td",mr,[e("div",{class:N(["font-bold text-base",F.discount_percentage>0?"text-red-600":"text-blue-600"])},t(J(F.amount)),3)]),e("td",vr,[e("input",{type:"checkbox",checked:x.value===j,onChange:ke(ve=>te(j),["stop"]),class:N(["custom-checkbox",F.discount_percentage>0?"checkbox-red":"checkbox-green"])},null,42,pr)])],10,nr))),128)),i.items.length===0?(s(),n("tr",fr,[e("td",gr,t(r.__("لا توجد أصناف")),1)])):I("",!0)])])]),e("div",hr,[e("div",_r,[e("div",yr,[e("div",br,t(r.__("الاجمالي")),1),e("div",xr,t(J(i.subtotal)),1)]),e("div",wr,[e("div",kr,t(r.__("الضريبة")),1),e("div",$r,t(J(i.taxAmount)),1)]),e("div",Cr,[e("div",Sr,t(r.__("الخصم")),1),e("div",Ir,t(J(i.discountAmount)),1)])])]),e("div",Vr,[h(Us,{modelValue:g.value,"onUpdate:modelValue":_[2]||(_[2]=F=>g.value=F),onEnter:Pe,onNumberClick:be},null,8,["modelValue"])]),h(o(it),{modelValue:V.value,"onUpdate:modelValue":_[5]||(_[5]=F=>V.value=F),options:{title:r.__("Comment"),size:"lg"}},{"body-content":E(()=>[e("div",Dr,[e("p",Mr,t(r.__("اضغط انتر لحفظ التعليق")),1),dt(e("input",{ref_key:"commentInputRef",ref:w,"onUpdate:modelValue":_[3]||(_[3]=F=>O.value=F),type:"text",class:"w-full border-2 border-gray-300 rounded-lg p-3 text-lg mb-4 focus:border-blue-500 focus:outline-none",placeholder:r.__("اكتب التعليق هنا..."),onKeydown:Jt(se,["enter"])},null,40,Pr),[[vt,O.value]]),b.value.length>0?(s(),n("div",Tr,[e("p",Ar,t(r.__("التعليقات المحفوظة:")),1),e("div",jr,[(s(!0),n(ce,null,ge(b.value,(F,j)=>(s(),n("button",{key:j,onClick:ve=>K(F),class:"quick-comment-btn"},t(F),9,Lr))),128))])])):(s(),n("div",Br,t(r.__("لا توجد تعليقات محفوظة بعد")),1))])]),actions:E(()=>[e("div",Or,[h(o(fe),{variant:"subtle",theme:"red",class:"flex-1",onClick:_[4]||(_[4]=F=>V.value=!1)},{default:E(()=>[Q(t(r.__("خروج")),1)]),_:1}),h(o(fe),{variant:"solid",class:"flex-1",onClick:se},{default:E(()=>[Q(t(r.__("حفظ")),1)]),_:1}),h(o(fe),{variant:"solid",theme:"blue",class:"flex-1",onClick:_e},{default:E(()=>[Q(t(r.__("حفظ في الفاتورة فقط")),1)]),_:1})])]),_:1},8,["modelValue","options"]),h(Hs,{modelValue:M.value,"onUpdate:modelValue":_[6]||(_[6]=F=>M.value=F),item:y.value,warehouses:i.warehouses,currency:i.currency,onUpdateItem:De},null,8,["modelValue","item","warehouses","currency"])]))}},zr=Fe(Er,[["__scopeId","data-v-5ec2ebc1"]]);function Nr(i={}){const{rootMargin:l="50px",threshold:d=.01}=i,m=C(null),$=C(!1),D=C(!1),T=C(null);let S=null;return ze(()=>{if(m.value){if(!("IntersectionObserver"in window)){$.value=!0;return}S=new IntersectionObserver(p=>{p.forEach(x=>{x.isIntersecting&&!$.value&&($.value=!0,S==null||S.disconnect())})},{rootMargin:l,threshold:d}),S.observe(m.value)}}),Ls(()=>{S&&(S.disconnect(),S=null)}),{targetRef:m,isVisible:$,isLoaded:D,error:T}}const Fr=["src","alt","loading"],bo="relative overflow-hidden",Rr={__name:"LazyImage",props:{src:{type:String,required:!0},alt:{type:String,default:""},containerClass:{type:String,default:""},imgClass:{type:String,default:"w-full h-full object-cover"},placeholderClass:{type:String,default:""},errorClass:{type:String,default:""},rootMargin:{type:String,default:"50px"},threshold:{type:Number,default:.01},nativeLazy:{type:Boolean,default:!0}},emits:["load","error"],setup(i,{emit:l}){const d=i,m=l,$=ee(()=>{var O;const V=(O=d.containerClass)==null?void 0:O.trim();return V?`${bo} ${V}`:bo}),{targetRef:D,isVisible:T,isLoaded:S,error:p}=Nr({rootMargin:d.rootMargin,threshold:d.threshold});function x(V){p.value=null,S.value=!0,m("load",V)}function g(V){p.value=V,S.value=!0,m("error",V)}return(V,O)=>(s(),n("div",{ref_key:"targetRef",ref:D,class:N($.value)},[o(S)?I("",!0):(s(),n("div",{key:0,class:N(["absolute inset-0 bg-gray-100 flex items-center justify-center",i.placeholderClass])},[nt(V.$slots,"placeholder",{},()=>[O[0]||(O[0]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-gray-100 via-gray-200 to-gray-100 animate-pulse"},null,-1))],!0)],2)),o(T)?(s(),n("img",{key:1,src:i.src,alt:i.alt,class:N(["transition-opacity duration-300",o(S)?"opacity-100":"opacity-0",i.imgClass]),onLoad:x,onError:g,loading:i.nativeLazy?"lazy":"eager"},null,42,Fr)):I("",!0),o(p)?(s(),n("div",{key:2,class:N(["absolute inset-0 bg-gray-100 flex items-center justify-center",i.errorClass])},[nt(V.$slots,"error",{},()=>[O[1]||(O[1]=e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1))],!0)],2)):I("",!0)],2))}},xo=Fe(Rr,[["__scopeId","data-v-c257926e"]]),Ur={class:"flex min-h-full items-center justify-center p-4"},Hr={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200"},qr={class:"flex items-center gap-3"},Wr={class:"text-lg font-semibold text-gray-900"},Gr={class:"text-sm text-gray-500"},Qr=["aria-label"],Yr={class:"flex-1 overflow-y-auto px-6 py-4"},Jr={key:0,class:"flex items-center justify-center py-12"},Kr={class:"text-center"},Xr={class:"mt-4 text-sm text-gray-500"},Zr={key:1,class:"flex items-center justify-center py-12"},ei={class:"text-center"},ti={class:"mt-4 text-sm text-gray-700"},oi={key:2,class:"flex flex-col gap-3"},si={class:"flex items-center justify-between"},ai={class:"flex-1"},li={class:"font-medium text-gray-900"},ni={class:"text-sm text-gray-500 mt-0.5"},ri={class:"text-end"},ii={class:"text-lg font-bold text-green-600"},ui={class:"text-xs text-gray-500 mt-0.5"},di={key:0,class:"text-orange-600"},ci={key:1},mi={key:0,class:"mt-2 pt-2 border-t border-gray-200"},vi={class:"flex items-center justify-between text-xs text-gray-600"},pi={class:"font-medium"},fi={key:3,class:"flex items-center justify-center py-12"},gi={class:"text-center"},hi={class:"mt-4 text-sm text-gray-700 font-medium"},_i={class:"mt-1 text-sm text-gray-500"},yi={class:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl"},bi={class:"flex items-center justify-between"},xi={class:"text-sm text-gray-600"},wi={class:"font-medium"},ki={class:"ms-2 text-gray-900 font-semibold"},$i={key:0,class:"ms-2 text-gray-500"},Ci={__name:"WarehouseAvailabilityDialog",props:{show:Boolean,itemCode:String,itemName:String,uom:{type:String,default:"Nos"},company:String},emits:["close"],setup(i,{emit:l}){const d=i,m=C(!1),$=C(null),D=C([]),T=ee(()=>!D.value||D.value.length===0?0:Math.floor(D.value.reduce((p,x)=>p+(x.available_qty||0),0)));function S(){return Z(this,null,function*(){if(d.itemCode){m.value=!0,$.value=null,D.value=[];try{const p=yield ct("pos_next.api.items.get_item_warehouse_availability",{item_code:d.itemCode,company:d.company});D.value=p||[]}catch(p){console.error("Error loading warehouse availability:",p),$.value=p.message||"Failed to load warehouse availability"}finally{m.value=!1}}})}return xe(()=>d.show,p=>{p&&S()},{immediate:!0}),(p,x)=>(s(),ie(Po,{to:"body"},[i.show?(s(),n("div",{key:0,class:"fixed inset-0 z-[9999] overflow-y-auto",onClick:x[4]||(x[4]=ke(g=>p.$emit("close"),["self"]))},[e("div",{class:"fixed inset-0 bg-black/50 transition-opacity",onClick:x[0]||(x[0]=g=>p.$emit("close"))}),e("div",Ur,[e("div",{class:"relative bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] flex flex-col",onClick:x[3]||(x[3]=ke(()=>{},["stop"]))},[e("div",Hr,[e("div",qr,[x[5]||(x[5]=e("div",{class:"p-2 bg-blue-100 rounded-lg"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})])],-1)),e("div",null,[e("h2",Wr,t(p.__("Warehouse Availability")),1),e("p",Gr,t(i.itemName),1)])]),e("button",{onClick:x[1]||(x[1]=g=>p.$emit("close")),class:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":p.__("Close dialog")},x[6]||(x[6]=[e("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Qr)]),e("div",Yr,[m.value?(s(),n("div",Jr,[e("div",Kr,[x[7]||(x[7]=e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"},null,-1)),e("p",Xr,t(p.__("Checking warehouse availability...")),1)])])):$.value?(s(),n("div",Zr,[e("div",ei,[x[8]||(x[8]=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",ti,t($.value),1),e("button",{onClick:S,class:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},t(p.__("Try Again")),1)])])):D.value&&D.value.length>0?(s(),n("div",oi,[(s(!0),n(ce,null,ge(D.value,g=>(s(),n("div",{key:g.warehouse,class:"bg-gray-50 rounded-lg p-4 border border-gray-200 hover:border-blue-300 transition-colors"},[e("div",si,[e("div",ai,[e("h3",li,t(g.warehouse_name),1),e("p",ni,t(g.company),1)]),e("div",ri,[e("div",ii,t(Math.floor(g.available_qty))+" "+t(i.uom),1),e("div",ui,[g.reserved_qty>0?(s(),n("span",di,t(Math.floor(g.reserved_qty))+" reserved ",1)):(s(),n("span",ci,t(p.__("Available")),1))])])]),g.actual_qty!==g.available_qty?(s(),n("div",mi,[e("div",vi,[e("span",null,t(p.__("Actual Stock:")),1),e("span",pi,t(Math.floor(g.actual_qty))+" "+t(i.uom),1)])])):I("",!0)]))),128))])):(s(),n("div",fi,[e("div",gi,[x[9]||(x[9]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1)),e("p",hi,t(p.__("No stock available")),1),e("p",_i,t(p.__("This item is out of stock in all warehouses")),1)])]))]),e("div",yi,[e("div",bi,[e("div",xi,[e("span",wi,t(p.__("Total Available:")),1),e("span",ki,t(T.value)+" "+t(i.uom),1),D.value&&D.value.length>0?(s(),n("span",$i,t(D.value.length===1?p.__("across 1 warehouse"):p.__("across {0} warehouses",[D.value.length])),1)):I("",!0)]),e("button",{onClick:x[2]||(x[2]=g=>p.$emit("close")),class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"},t(p.__("Close")),1)])])])])])):I("",!0)]))}},Si={class:"p-4"},Ii={key:0,class:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg"},Vi={class:"text-sm text-red-700"},Di={class:"mt-4 text-center"},Mi={class:"text-sm text-gray-600"},Pi={__name:"BarcodeScanner",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","scan"],setup(i,{emit:l}){const d=i,m=l,$=C(d.modelValue),D=C(null),T=C("");let S=null,p=null;xe(()=>d.modelValue,w=>{$.value=w,w?x():g()}),xe($,w=>{m("update:modelValue",w),w?x():g()});function x(){return Z(this,null,function*(){try{if(!p){if(window.frappe&&window.frappe.require)try{yield window.frappe.require("/assets/frappe/node_modules/html5-qrcode/html5-qrcode.min.js"),p=window.Html5Qrcode}catch(M){console.warn("Could not load from Frappe assets, trying CDN:",M)}p||(yield O("https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"),p=window.Html5Qrcode)}if(!p)throw new Error("Failed to load Html5Qrcode library");if(yield new Promise(M=>setTimeout(M,100)),!D.value)throw new Error("Scanner container not found");const w=D.value.id||"barcode-scanner-container";S=new p(w),yield S.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250},aspectRatio:1},(M,y)=>{m("scan",M),g(),$.value=!1},M=>{}),T.value=""}catch(w){console.error("Scanner error:",w),T.value=w.message||__("Failed to start camera. Please check permissions.")}})}function g(){S&&S.stop().then(()=>{S.clear(),S=null}).catch(w=>{console.error("Error stopping scanner:",w)})}function V(){g(),$.value=!1}function O(w){return new Promise((M,y)=>{const v=document.createElement("script");v.src=w,v.onload=M,v.onerror=y,document.head.appendChild(v)})}return Qe(()=>{g()}),(w,M)=>(s(),ie(o(it),{modelValue:$.value,"onUpdate:modelValue":M[0]||(M[0]=y=>$.value=y),title:w.__("Scan Barcode"),options:{width:500,height:500},onClose:V},{default:E(()=>[e("div",Si,[e("div",{ref_key:"scannerContainerRef",ref:D,id:"barcode-scanner-container",class:"w-full bg-black rounded-lg overflow-hidden",style:{"min-height":"300px",position:"relative"}},null,512),T.value?(s(),n("div",Ii,[e("p",Vi,t(T.value),1)])):I("",!0),e("div",Di,[e("p",Mi,t(w.__("Position the barcode within the frame")),1)])])]),_:1},8,["modelValue","title"]))}},Ti=Fe(Pi,[["__scopeId","data-v-613e2765"]]),Eo=Ct.create("LowEndOptimizations"),Ai=window.requestIdleCallback||function(i){const l=Date.now();return setTimeout(function(){i({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-l))}})},1)};function zo(i,l={}){const{timeout:d=2e3}=l;return Ai(m=>{if(m.timeRemaining()>0||m.didTimeout)try{i()}catch($){Eo.error("Error in idle callback",$)}else zo(i,l)},{timeout:d})}function ji(i){let l=null,d=null;return function(...$){d=$,l===null&&(l=requestAnimationFrame(()=>{i(...d),l=null,d=null}))}}function xt(i,l,d,m={}){const $=We({passive:!0,capture:!1},m);return i.addEventListener(l,d,$),()=>{i.removeEventListener(l,d,$)}}function Li(i,l={}){const{feedback:d=!0}=l;let m=0,$=!1,D=!1,T=0;const S=10,p=500;let x=0,g=0;const V={touchstart:w=>{m=Date.now(),$=!1,D=!1;const M=w.touches[0];x=M.clientX,g=M.clientY,d&&w.currentTarget&&(w.currentTarget.style.opacity="0.7")},touchmove:w=>{const M=w.touches[0],y=Math.abs(M.clientX-x),v=Math.abs(M.clientY-g);(y>S||v>S)&&($=!0,d&&w.currentTarget&&(w.currentTarget.style.opacity=""))},touchend:w=>{d&&w.currentTarget&&(w.currentTarget.style.opacity="");const M=Date.now()-m;if(!$&&M<500){try{w.preventDefault()}catch(y){}D=!0,T=Date.now(),requestAnimationFrame(()=>{i(w)})}m=0,$=!1},click:w=>{const M=Date.now()-T;if(D&&M<p){w.preventDefault(),w.stopPropagation();return}requestAnimationFrame(()=>{i(w)})}};return setInterval(()=>{D&&Date.now()-T>=p&&(D=!1)},p),V}function Bi(){if((navigator.hardwareConcurrency||2)<=2||navigator.deviceMemory&&navigator.deviceMemory<=2)return!0;if(navigator.connection){const l=navigator.connection;if(l.effectiveType==="slow-2g"||l.effectiveType==="2g"||l.saveData)return!0}return!1}Eo.info("Low-end optimizations loaded",{isLowEnd:Bi()});const Oi={class:"flex flex-col h-full bg-white"},Ei={class:"control-buttons-grid grid grid-cols-4 gap-2 p-2 bg-white flex-shrink-0"},zi={key:0,class:"px-1.5 sm:px-3 py-1 bg-blue-50 border-b border-blue-200"},Ni={class:"flex items-center justify-center gap-2 text-[10px] sm:text-xs text-blue-700"},Fi={class:"px-3 py-2 bg-white border-b border-gray-200 flex-shrink-0"},Ri={class:"flex items-center gap-2"},Ui={class:"flex-1 relative"},Hi=["value","placeholder"],qi={class:"flex items-center gap-1 border border-gray-300 rounded-lg p-0.5 bg-gray-50"},Wi=["title","aria-label"],Gi=["title","aria-label"],Qi=["title","aria-label"],Yi=["title","aria-label"],Ji={key:1,class:"flex-1 flex items-center justify-center p-3"},Ki={class:"text-center py-8"},Xi={class:"mt-3 text-xs text-gray-500"},Zi={key:2,class:"flex-1 flex items-center justify-center p-3"},eu={class:"text-center py-8"},tu={key:0,class:"mt-2 text-xs font-medium text-gray-700"},ou={key:0},su={key:1},au={key:2},lu={key:1,class:"mt-2 text-xs text-gray-500"},nu={key:"grid",class:"flex-1 flex flex-col overflow-hidden min-h-0 relative"},ru=["disabled"],iu={class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 2xl:grid-cols-8 gap-1.5 sm:gap-2"},uu=["onTouchstart","onTouchmove","onTouchend","onClick"],du={key:0,class:"relative bg-gray-50 border-b border-gray-100",style:{width:"100%","padding-bottom":"75%",position:"relative",overflow:"hidden"}},cu={key:1,class:"w-full h-full flex items-center justify-center bg-gray-100 text-gray-300"},mu={class:"p-1.5 sm:p-2 flex-1 flex flex-col justify-between min-w-0 bg-white",style:{"min-height":"0"}},vu=["title"],pu={class:"flex items-center justify-between mt-auto gap-1"},fu={class:"text-xs sm:text-sm font-bold text-blue-600 truncate"},gu={class:"text-[9px] text-gray-500 font-medium bg-gray-100 px-1 py-0.5 rounded flex-shrink-0"},hu={key:0,class:"flex justify-center items-center py-4"},_u={class:"ms-2 text-xs text-gray-500"},yu={key:1,class:"flex justify-center items-center py-3"},bu={class:"text-xs text-gray-400"},xu={key:2,class:"flex justify-center items-center py-3"},wu={class:"text-xs text-gray-500"},ku=["disabled"],$u={key:0,class:"px-2 sm:px-3 py-2 bg-white border-t border-gray-200"},Cu={class:"flex flex-col sm:flex-row items-center justify-between gap-2"},Su={class:"text-[10px] sm:text-xs text-gray-600 order-2 sm:order-1"},Iu={class:"flex items-center gap-1 order-1 sm:order-2"},Vu=["disabled","aria-label"],Du={class:"hidden xs:inline"},Mu=["disabled","aria-label"],Pu={class:"hidden xs:inline"},Tu={class:"flex items-center gap-0.5 sm:gap-1"},Au=["onClick","aria-label"],ju=["disabled","aria-label"],Lu={class:"hidden xs:inline"},Bu=["disabled","aria-label"],Ou={class:"hidden xs:inline"},Eu={key:"list",class:"flex-1 flex flex-col overflow-hidden min-h-0"},zu={key:0,class:"min-w-full divide-y divide-gray-200"},Nu={class:"bg-gray-50 sticky top-0 z-10"},Fu={key:0,scope:"col",class:"px-2 sm:px-3 py-2 sm:py-2.5 text-start text-[10px] sm:text-xs font-semibold text-gray-700 uppercase tracking-wider bg-gray-50 border-b-2 border-gray-200 sticky top-0 z-10 w-[50px] sm:w-[60px]"},Ru={scope:"col",class:"px-2 sm:px-3 py-2 sm:py-2.5 text-start text-[10px] sm:text-xs font-semibold text-gray-700 uppercase tracking-wider bg-gray-50 border-b-2 border-gray-200 sticky top-0 z-10 max-w-[120px] sm:max-w-[180px] md:max-w-[200px]"},Uu={scope:"col",class:"hidden sm:table-cell px-2 sm:px-3 py-2 sm:py-2.5 text-start text-[10px] sm:text-xs font-semibold text-gray-700 uppercase tracking-wider bg-gray-50 border-b-2 border-gray-200 sticky top-0 z-10 sm:max-w-[150px]"},Hu={scope:"col",class:"px-2 sm:px-3 py-2 sm:py-2.5 text-start text-[10px] sm:text-xs font-semibold text-gray-700 uppercase tracking-wider bg-gray-50 border-b-2 border-gray-200 sticky top-0 z-10 w-[70px] sm:w-[100px]"},qu={scope:"col",class:"px-2 sm:px-3 py-2 sm:py-2.5 text-start text-[10px] sm:text-xs font-semibold text-gray-700 uppercase tracking-wider bg-gray-50 border-b-2 border-gray-200 sticky top-0 z-10 w-[70px] sm:w-[100px]"},Wu={scope:"col",class:"hidden md:table-cell px-2 sm:px-3 py-2 sm:py-2.5 text-start text-[10px] sm:text-xs font-semibold text-gray-700 uppercase tracking-wider bg-gray-50 border-b-2 border-gray-200 sticky top-0 z-10 md:w-[80px]"},Gu={class:"bg-white divide-y divide-gray-200"},Qu=["onTouchstart","onTouchmove","onTouchend","onClick"],Yu={key:0,class:"px-2 sm:px-3 py-2 whitespace-nowrap w-[50px] sm:w-[60px]"},Ju={class:"w-8 h-8 sm:w-10 sm:h-10 bg-gray-100 rounded flex items-center justify-center overflow-hidden"},Ku={key:1,class:"h-4 w-4 sm:h-5 sm:w-5 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Xu={class:"px-2 sm:px-3 py-2 max-w-[120px] sm:max-w-[180px] md:max-w-[200px]"},Zu=["title"],ed={class:"hidden sm:table-cell px-2 sm:px-3 py-2 whitespace-nowrap sm:max-w-[150px]"},td=["title"],od={class:"px-2 sm:px-3 py-2 whitespace-nowrap w-[70px] sm:w-[100px]"},sd={class:"text-xs sm:text-sm font-semibold text-blue-600"},ad={class:"px-2 sm:px-3 py-2 whitespace-nowrap w-[70px] sm:w-[100px]"},ld={key:0,class:"relative inline-flex"},nd={key:1,class:"text-xs sm:text-sm text-gray-400 italic"},rd={class:"hidden md:table-cell px-2 sm:px-3 py-2 whitespace-nowrap md:w-[80px]"},id={class:"text-xs sm:text-sm text-gray-500"},ud={key:0},dd={colspan:"6",class:"px-2 sm:px-3 py-4 text-center bg-white"},cd={class:"flex justify-center items-center"},md={class:"ms-2 text-xs text-gray-500"},vd={key:1},pd={colspan:"6",class:"px-2 sm:px-3 py-3 text-center bg-white"},fd={class:"text-xs text-gray-400"},gd={key:2},hd={colspan:"6",class:"px-2 sm:px-3 py-3 text-center bg-white"},_d={class:"text-xs text-gray-500"},yd={key:0,class:"px-2 sm:px-3 py-2 bg-white border-t border-gray-200"},bd={class:"flex flex-col sm:flex-row items-center justify-between gap-2"},xd={class:"text-[10px] sm:text-xs text-gray-600 order-2 sm:order-1"},wd={class:"flex items-center gap-1 order-1 sm:order-2"},kd=["disabled","aria-label"],$d={class:"hidden xs:inline"},Cd=["disabled","aria-label"],Sd={class:"hidden xs:inline"},Id={class:"flex items-center gap-0.5 sm:gap-1"},Vd=["onClick","aria-label"],Dd=["disabled","aria-label"],Md={class:"hidden xs:inline"},Pd=["disabled","aria-label"],Td={class:"hidden xs:inline"},Ad={__name:"ItemsSelector",props:{posProfile:String,cartItems:{type:Array,default:()=>[]},currency:{type:String,default:"USD"},customer:{type:Object,default:null}},emits:["item-selected","select-customer","show-history","close-shift","show-today-orders","show-tools","add-comment","set-order-type","select-table","show-discount","add-image","trigger-remove-item","trigger-add-item","finish-bill"],setup(i,{expose:l,emit:d}){const m=i,$=d;To();const{showWarning:D}=ft(),T=zt(),S=Kt(),{groupingEnabled:p}=Wt(S),{toggleGrouping:x}=S;C(!1),C(!1);function g(){$("show-discount")}function V(k){}const{filteredItems:O,searchTerm:w,selectedItemGroup:M,itemGroups:y,loading:v,loadingMore:b,hasMore:B,cacheSyncing:H,cacheStats:le,sortBy:K,sortOrder:L}=Wt(T),me=C("grid"),we=C(!0),J=C(!1),te=C(!1),ne=C(50),ae=C(!1),he=C(!1),oe=C(null),Ce=C(0),be=C(""),Pe=C(!1),W=C(!1),se=C(null),_e=C(null),De=C(null),r=C([]),_=C(!1),F=C(!1),j=C(1),ve=C(20),$e=ee(()=>{if(!O.value)return[];const k=(j.value-1)*ve.value,a=k+ve.value;return O.value.slice(k,a)}),ue=ee(()=>O.value?Math.ceil(O.value.length/ve.value):0),f=Object.freeze({auto:__("Auto-Add ON - Type or scan barcode"),scanner:__("Scanner ON - Enable Auto for automatic addition"),default:__("Search by item code, name or scan barcode")});Object.freeze([{field:"name",label:__("Name"),icon:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},{field:"quantity",label:__("Quantity"),icon:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"},{field:"item_group",label:__("Item Group"),icon:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"},{field:"price",label:__("Price"),icon:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},{field:"item_code",label:__("Item Code"),icon:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"}]);const R=ee(()=>autoAddEnabled.value?"auto":scannerEnabled.value?"scanner":"default");ee(()=>f[R.value]),xe(()=>`${m.cartItems.length}-${m.cartItems.map(k=>`${k.item_code}:${k.quantity||0}:${k.amount||0}`).join("|")}`,()=>{T.setCartItems(m.cartItems)},{immediate:!0,flush:"sync"}),xe(()=>m.posProfile,k=>{k&&T.setPosProfile(k)},{immediate:!0}),xe(O,k=>{var Le,St,Lt;if(!k)return;const a=k.length,A=a>0&&((Le=k[0])==null?void 0:Le.item_code)||"",z=a>0&&((St=k[a-1])==null?void 0:St.item_code)||"",pe=a>2?Math.floor(a/2):-1,U=pe>=0&&((Lt=k[pe])==null?void 0:Lt.item_code)||"",Ie=`${a}|${A}|${U}|${z}`;Ie!==be.value&&(j.value=1,be.value=Ie),!ae.value&&me.value==="grid"&&a>ne.value?Ce.value!==a&&(me.value="list",Ce.value=a):a<=ne.value&&(Ce.value=0)},{immediate:!1});const Se=ji(k=>{const a=k.target,A=a.scrollTop+a.clientHeight,z=a.scrollHeight;!(w.value&&w.value.trim().length>0)&&z-A<200&&B.value&&!b.value&&!v.value&&zo(()=>{T.loadMoreItems()},{timeout:1e3})});function X(k){Se(k)}const Ve=()=>{if(!_e.value)return;const{scrollTop:k,scrollHeight:a,clientHeight:A}=_e.value;_.value=k>0,F.value=k+A<a-1},je=k=>(k&&(k.preventDefault(),k.stopPropagation(),k.stopImmediatePropagation()),_e.value&&(_e.value.scrollBy({top:-200,behavior:"smooth"}),setTimeout(()=>Ve(),100)),!1),qe=k=>(k&&(k.preventDefault(),k.stopPropagation(),k.stopImmediatePropagation()),_e.value&&(_e.value.scrollBy({top:200,behavior:"smooth"}),setTimeout(()=>Ve(),100)),!1);ze(()=>{if(me.value==="grid"&&_e.value){const k=xt(_e.value,"scroll",X,{passive:!0});r.value.push(k);const a=xt(_e.value,"scroll",Ve,{passive:!0});r.value.push(a),kt(()=>{setTimeout(()=>{Ve()},100),setTimeout(()=>{Ve()},500)})}else if(me.value==="list"&&De.value){const k=xt(De.value,"scroll",X,{passive:!0});r.value.push(k)}document.addEventListener("click",Te)}),Qe(()=>{T.cleanup(),r.value.forEach(k=>k()),r.value=[],Je.clear(),document.removeEventListener("click",Te)});function ot(k){const a=Date.now(),A=a-lastKeyTime.value;if(k.key==="Enter"){k.preventDefault(),autoAddEnabled.value?Ke(!0):Ke(!1),barcodeBuffer.value="",he.value=!1,oe.value&&(clearTimeout(oe.value),oe.value=null);return}A<50&&k.key.length===1&&barcodeBuffer.value.length>0?(barcodeBuffer.value+=k.key,he.value=!0):k.key.length===1&&(barcodeBuffer.value=k.key,he.value=!1),lastKeyTime.value=a}function Re(k){const a=k.target.value;T.setSearchTerm(a),oe.value&&(clearTimeout(oe.value),oe.value=null),autoAddEnabled.value&&a.trim().length>0&&(oe.value=setTimeout(()=>{Ke(!0)},500))}const Je=new Map;function Ee(k){const a=k.item_code;if(!Je.has(a)){const A=Li(()=>{rt(k.item_code)},{feedback:!0});Je.set(a,A)}return Je.get(a)}function rt(k){const a=O.value.find(A=>A.item_code===k);a&&$("item-selected",a)}function Ke(k=!1){return Z(this,null,function*(){const a=w.value.trim();if(!a)return;const A=k||scannerEnabled.value&&autoAddEnabled.value;try{const z=yield T.searchByBarcode(a);if(z){$("item-selected",z,A),T.clearSearch();return}}catch(z){console.error("Barcode API error:",z)}O.value.length===1?($("item-selected",O.value[0],A),T.clearSearch()):O.value.length===0?(D(__("Item Not Found: No item found with barcode: {0}",[a])),A&&T.clearSearch()):D(A?__("Multiple Items Found: {0} items match barcode. Please refine search.",[O.value.length]):__("Multiple Items Found: {0} items match. Please select one.",[O.value.length]))})}function mt(k){T.setSearchTerm(k),Ke(!0)}function gt(){const k=document.createElement("input");k.type="file",k.accept="image/*",k.style.display="none",k.onchange=a=>Z(this,null,function*(){const A=a.target.files[0];A&&($("add-image",A),document.body.removeChild(k))}),document.body.appendChild(k),k.click()}function Xe(k){return Nt(Number.parseFloat(k||0),m.currency)}l({loadItems:()=>T.loadAllItems(m.posProfile),loadItemGroups:()=>T.loadItemGroups(),loadMoreItems:()=>T.loadMoreItems()}),xe(me,()=>Z(this,null,function*(){if(yield kt(),r.value.forEach(k=>k()),r.value=[],me.value==="grid"&&_e.value){const k=xt(_e.value,"scroll",X,{passive:!0});r.value.push(k);const a=xt(_e.value,"scroll",Ve,{passive:!0});r.value.push(a),kt(()=>{setTimeout(()=>{Ve()},100),setTimeout(()=>{Ve()},500)})}else if(me.value==="list"&&De.value){const k=xt(De.value,"scroll",X,{passive:!0});r.value.push(k)}}));function Ue(k){k>=1&&k<=ue.value&&(j.value=k)}function Ne(){j.value<ue.value&&j.value++}function ht(){j.value>1&&j.value--}function _t(){const k=[],a=ue.value,A=j.value,z=2;if(a<=7)for(let pe=1;pe<=a;pe++)k.push(pe);else if(A<=3)for(let pe=1;pe<=5;pe++)k.push(pe);else if(A>=a-2)for(let pe=a-4;pe<=a;pe++)k.push(pe);else for(let pe=A-z;pe<=A+z;pe++)k.push(pe);return k}function Te(k){var a;if(Pe.value){const A=k.target.closest(".relative");(!A||!((a=A.querySelector("button[data-sort-button]"))!=null&&a.contains(k.target)))&&(Pe.value=!1)}}return(k,a)=>{const A=jo;return s(),n(ce,null,[e("div",Oi,[e("div",Ei,[e("button",{class:"pos-header-btn danger",onClick:a[0]||(a[0]=z=>k.$emit("close-shift"))},t(k.__("إغلاق الورديه")),1),e("button",{class:"pos-header-btn danger",onClick:a[1]||(a[1]=z=>k.$emit("logout"))},t(k.__("خروج")),1),e("button",{class:"pos-header-btn secondary",onClick:a[2]||(a[2]=z=>k.$emit("show-today-orders"))},t(k.__("أوردارات اليوم")),1),e("button",{class:"pos-header-btn secondary",onClick:a[3]||(a[3]=z=>k.$emit("add-comment"))},t(k.__("كومنت")),1),e("button",{class:"pos-header-btn secondary",onClick:a[4]||(a[4]=z=>void 0)},t(k.__("أدوات")),1),e("button",{class:"pos-header-btn light",onClick:a[5]||(a[5]=z=>k.$emit("set-order-type","Takeaway"))},t(k.__("تيك أواي")),1),e("button",{class:"pos-header-btn primary",onClick:a[6]||(a[6]=z=>void 0)},t(k.__("صالة")),1),e("button",{class:"pos-header-btn primary",onClick:a[7]||(a[7]=z=>void 0)},t(k.__("ديلفري")),1),e("button",{class:"pos-header-btn secondary",onClick:a[8]||(a[8]=z=>void 0)},t(k.__("التربيزه")),1),e("button",{class:"pos-header-btn secondary",onClick:g},t(k.__("الخصم")),1),e("button",{class:"add-remove-btn remove",onClick:a[9]||(a[9]=z=>void 0)},t(k.__("بدون")),1),e("button",{class:"add-remove-btn add",onClick:a[10]||(a[10]=z=>void 0)},t(k.__("إضافة")),1),e("button",{class:N(["add-remove-btn grouping",o(p)?"active":""]),onClick:a[11]||(a[11]=(...z)=>o(x)&&o(x)(...z))},t(k.__("تجميع")),3),e("button",{class:"finish-btn col-span-3",onClick:a[12]||(a[12]=z=>k.$emit("finish-bill"))},t(k.__("انهاء البون")),1)]),a[52]||(a[52]=e("div",{class:"hidden"},null,-1)),o(H)?(s(),n("div",zi,[e("div",Ni,[a[25]||(a[25]=e("div",{class:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"},null,-1)),e("span",null,t(k.__("Syncing catalog in background... {0} items cached",[o(le).items])),1)])])):I("",!0),e("div",Fi,[e("div",Ri,[e("div",Ui,[e("input",{ref:"searchInputRef",id:"item-search",value:o(w),onInput:Re,onKeydown:ot,type:"text",placeholder:k.__("Search by item code, name or scan barcode"),class:"w-full px-4 py-2.5 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none text-sm bg-gray-50 hover:bg-white transition-colors"},null,40,Hi),a[26]||(a[26]=e("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},[e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",qi,[e("button",{onClick:a[13]||(a[13]=z=>te.value=!0),class:"p-2 hover:bg-white rounded-md transition-colors touch-manipulation",title:k.__("Scan Barcode"),"aria-label":k.__("Scan Barcode")},a[27]||(a[27]=[e("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})],-1)]),8,Wi),a[31]||(a[31]=e("div",{class:"w-px h-6 bg-gray-300"},null,-1)),e("button",{onClick:gt,class:"p-2 hover:bg-white rounded-md transition-colors touch-manipulation",title:k.__("Add Image"),"aria-label":k.__("Add Image")},a[28]||(a[28]=[e("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)]),8,Gi),a[32]||(a[32]=e("div",{class:"w-px h-6 bg-gray-300"},null,-1)),e("button",{onClick:a[14]||(a[14]=z=>{me.value="grid",we.value=!0}),class:N(["p-2 hover:bg-white rounded-md transition-colors touch-manipulation",me.value==="grid"&&we.value?"bg-blue-100 text-blue-600":"text-gray-600"]),title:k.__("Grid View with Images"),"aria-label":k.__("Grid View with Images")},a[29]||(a[29]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 5a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM14 5a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zM4 15a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1v-4zM14 15a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"})],-1)]),10,Qi),a[33]||(a[33]=e("div",{class:"w-px h-6 bg-gray-300"},null,-1)),e("button",{onClick:a[15]||(a[15]=z=>{me.value="list",we.value=!1}),class:N(["p-2 hover:bg-white rounded-md transition-colors touch-manipulation",me.value==="list"&&!we.value?"bg-blue-100 text-blue-600":"text-gray-600"]),title:k.__("List View without Images"),"aria-label":k.__("List View without Images")},a[30]||(a[30]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})],-1)]),10,Yi)])])]),h(Ti,{modelValue:te.value,"onUpdate:modelValue":a[16]||(a[16]=z=>te.value=z),onScan:mt},null,8,["modelValue"]),h(A,{modelValue:J.value,"onUpdate:modelValue":a[17]||(a[17]=z=>J.value=z),"pos-profile":i.posProfile,onCustomerSelected:k.handleCustomerSelected},null,8,["modelValue","pos-profile","onCustomerSelected"]),o(v)&&!o(O)?(s(),n("div",Ji,[e("div",Ki,[a[34]||(a[34]=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"},null,-1)),e("p",Xi,t(k.__("Loading items...")),1)])])):!o(O)||o(O).length===0?(s(),n("div",Zi,[e("div",eu,[a[35]||(a[35]=e("svg",{class:"mx-auto h-8 w-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1)),o(w)||o(M)?(s(),n("p",tu,[o(w)&&o(M)?(s(),n("span",ou,t(k.__("No results for {0} in {1}",[o(w),o(M)])),1)):o(M)?(s(),n("span",su,t(k.__("No results in {0}",[o(M)])),1)):(s(),n("span",au,t(k.__("No results for {0}",[o(w)])),1))])):(s(),n("p",lu,t(k.__("No items available")),1))])])):I("",!0),me.value==="grid"?(s(),n("div",nu,[e("button",{onClick:ke(je,["stop"]),onTouchstart:ke(je,["stop","prevent"]),onMousedown:ke(je,["stop","prevent"]),onTouchend:a[18]||(a[18]=ke(()=>{},["stop","prevent"])),class:"products-scroll-btn up",disabled:!_.value,type:"button"},a[36]||(a[36]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"})],-1)]),40,ru),e("div",{ref_key:"gridScrollContainer",ref:_e,class:"flex-1 overflow-y-auto p-1.5 sm:p-3",style:{"min-height":"0"},onScroll:Ve},[e("div",iu,[(s(!0),n(ce,null,ge($e.value,z=>{var pe,U;return s(),n("div",{key:z.item_code,onTouchstart:Ee(z).touchstart,onTouchmove:Ee(z).touchmove,onTouchend:Ee(z).touchend,onClick:Ee(z).click,class:N(["group relative cursor-pointer bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md hover:border-blue-300 transition-all duration-200 overflow-hidden flex flex-col","min-h-[90px] sm:min-h-[100px] md:min-h-[110px]","touch-manipulation"]),style:{"touch-action":"manipulation","-webkit-tap-highlight-color":"transparent","pointer-events":"auto"}},[we.value?(s(),n("div",du,[e("div",{class:N(["absolute inset-0 w-full h-full transition-all duration-300",(z.is_stock_item||z.is_bundle)&&((U=(pe=z.actual_qty)!=null?pe:z.stock_qty)!=null?U:0)<=0?"group-hover:blur-sm group-hover:brightness-75":""])},[z.image?(s(),ie(xo,{key:0,src:z.image,alt:z.item_name,"container-class":"relative w-full h-full","img-class":"w-full h-full object-cover","root-margin":"100px"},{error:E(()=>a[37]||(a[37]=[e("div",{class:"w-full h-full flex items-center justify-center bg-gray-100 text-gray-300"},[e("svg",{class:"h-6 w-6 sm:h-7 sm:w-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)])),_:2},1032,["src","alt"])):(s(),n("div",cu,a[38]||(a[38]=[e("svg",{class:"h-6 w-6 sm:h-7 sm:w-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])))],2)])):I("",!0),e("div",mu,[e("h3",{class:"text-[11px] sm:text-xs font-semibold text-gray-800 mb-0.5 leading-tight line-clamp-2-compat",title:z.item_name},t(z.item_name),9,vu),e("div",pu,[e("p",fu,t(Xe(z.rate||z.price_list_rate||0)),1),e("span",gu,t(z.uom||z.stock_uom||k.__("Nos",null,"UOM")),1)])])],40,uu)}),128))]),o(b)?(s(),n("div",hu,[a[39]||(a[39]=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"},null,-1)),e("p",_u,t(k.__("Loading more items...")),1)])):!o(B)&&o(O).length>0&&!o(w)&&(j.value===ue.value||ue.value===1)?(s(),n("div",yu,[e("p",bu,t(k.__("All items loaded")),1)])):o(w)&&o(O).length>0?(s(),n("div",xu,[e("p",wu,t(k.__("{0} items found",[o(O).length])),1)])):I("",!0)],544),e("button",{onClick:ke(qe,["stop"]),onTouchstart:ke(qe,["stop","prevent"]),onMousedown:ke(qe,["stop","prevent"]),onTouchend:a[19]||(a[19]=ke(()=>{},["stop","prevent"])),class:"products-scroll-btn down",disabled:!F.value,type:"button"},a[40]||(a[40]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)]),40,ku),ue.value>1?(s(),n("div",$u,[e("div",Cu,[e("div",Su,t(k.__("{0} - {1} of {2}",[(j.value-1)*ve.value+1,Math.min(j.value*ve.value,o(O).length),o(O).length])),1),e("div",Iu,[e("button",{onClick:a[20]||(a[20]=z=>Ue(1)),disabled:j.value===1,class:N(["px-2 sm:px-3 py-1.5 text-[10px] sm:text-xs font-medium rounded-lg border transition-[background-color] duration-75 touch-manipulation",j.value===1?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 active:bg-gray-100"]),"aria-label":k.__("Go to first page")},[e("span",Du,t(k.__("First")),1),a[41]||(a[41]=e("span",{class:"xs:hidden"},"«",-1))],10,Vu),e("button",{onClick:ht,disabled:j.value===1,class:N(["px-2 sm:px-3 py-1.5 text-[10px] sm:text-xs font-medium rounded-lg border transition-[background-color] duration-75 touch-manipulation",j.value===1?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 active:bg-gray-100"]),"aria-label":k.__("Go to previous page")},[e("span",Pu,t(k.__("Previous")),1),a[42]||(a[42]=e("span",{class:"xs:hidden"},"‹",-1))],10,Mu),e("div",Tu,[(s(!0),n(ce,null,ge(_t(),z=>(s(),n("button",{key:z,onClick:pe=>Ue(z),class:N(["min-w-[28px] sm:min-w-[32px] px-1.5 sm:px-2.5 py-1.5 text-[10px] sm:text-xs font-medium rounded-lg border transition-[background-color,border-color] duration-75 touch-manipulation",j.value===z?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 active:bg-gray-100"]),"aria-label":k.__("Go to page {0}",[z])},t(z),11,Au))),128))]),e("button",{onClick:Ne,disabled:j.value===ue.value,class:N(["px-2 sm:px-3 py-1.5 text-[10px] sm:text-xs font-medium rounded-lg border transition-[background-color] duration-75 touch-manipulation",j.value===ue.value?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 active:bg-gray-100"]),"aria-label":k.__("Go to next page")},[e("span",Lu,t(k.__("Next")),1),a[43]||(a[43]=e("span",{class:"xs:hidden"},"›",-1))],10,ju),e("button",{onClick:a[21]||(a[21]=z=>Ue(ue.value)),disabled:j.value===ue.value,class:N(["px-2 sm:px-3 py-1.5 text-[10px] sm:text-xs font-medium rounded-lg border transition-[background-color] duration-75 touch-manipulation",j.value===ue.value?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 active:bg-gray-100"]),"aria-label":k.__("Go to last page")},[e("span",Ou,t(k.__("Last")),1),a[44]||(a[44]=e("span",{class:"xs:hidden"},"»",-1))],10,Bu)])])])):I("",!0)])):I("",!0),me.value==="list"?(s(),n("div",Eu,[e("div",{ref_key:"listScrollContainer",ref:De,class:"flex-1 overflow-x-auto overflow-y-auto",style:{"min-height":"0"}},[$e.value.length>0?(s(),n("table",zu,[e("thead",Nu,[e("tr",null,[we.value?(s(),n("th",Fu,t(k.__("Image")),1)):I("",!0),e("th",Ru,t(k.__("Name")),1),e("th",Uu,t(k.__("Code")),1),e("th",Hu,t(k.__("Rate")),1),e("th",qu,t(k.__("Qty")),1),e("th",Wu,t(k.__("UOM")),1)])]),e("tbody",Gu,[(s(!0),n(ce,null,ge($e.value,z=>(s(),n("tr",{key:z.item_code,onTouchstart:Ee(z).touchstart,onTouchmove:Ee(z).touchmove,onTouchend:Ee(z).touchend,onClick:Ee(z).click,class:"group cursor-pointer hover:bg-blue-50 hover:shadow-md transition-[background-color,box-shadow] duration-100 touch-manipulation active:bg-blue-100",style:{"touch-action":"manipulation","-webkit-tap-highlight-color":"transparent","pointer-events":"auto"}},[we.value?(s(),n("td",Yu,[e("div",Ju,[z.image?(s(),ie(xo,{key:0,src:z.image,alt:z.item_name,"container-class":"relative w-full h-full","img-class":"w-full h-full object-cover","root-margin":"100px"},{error:E(()=>a[45]||(a[45]=[e("svg",{class:"h-4 w-4 sm:h-5 sm:w-5 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])),_:2},1032,["src","alt"])):(s(),n("svg",Ku,a[46]||(a[46]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])))])])):I("",!0),e("td",Xu,[e("div",{class:"text-xs sm:text-sm font-medium text-gray-900 truncate",title:z.item_name},t(z.item_name),9,Zu)]),e("td",ed,[e("div",{class:"text-xs sm:text-sm text-gray-500 truncate",title:z.item_code},t(z.item_code),9,td)]),e("td",od,[e("div",sd,t(Xe(z.rate||z.price_list_rate||0)),1)]),e("td",ad,[z.is_stock_item||z.is_bundle?(s(),n("div",ld)):(s(),n("span",nd,t(k.__("N/A")),1))]),e("td",rd,[e("div",id,t(z.uom||z.stock_uom||k.__("Nos",null,"UOM")),1)])],40,Qu))),128)),o(b)?(s(),n("tr",ud,[e("td",dd,[e("div",cd,[a[47]||(a[47]=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"},null,-1)),e("p",md,t(k.__("Loading more items...")),1)])])])):!o(B)&&o(O).length>0&&!o(w)&&(j.value===ue.value||ue.value===1)?(s(),n("tr",vd,[e("td",pd,[e("p",fd,t(k.__("All items loaded")),1)])])):o(w)&&o(O).length>0?(s(),n("tr",gd,[e("td",hd,[e("p",_d,t(k.__("{0} items found",[o(O).length])),1)])])):I("",!0)])])):I("",!0)],512),ue.value>1?(s(),n("div",yd,[e("div",bd,[e("div",xd,t(k.__("{0} - {1} of {2}",[(j.value-1)*ve.value+1,Math.min(j.value*ve.value,o(O).length),o(O).length])),1),e("div",wd,[e("button",{onClick:a[22]||(a[22]=z=>Ue(1)),disabled:j.value===1,class:N(["px-2 sm:px-3 py-1.5 text-[10px] sm:text-xs font-medium rounded-lg border transition-[background-color] duration-75 touch-manipulation",j.value===1?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 active:bg-gray-100"]),"aria-label":k.__("Go to first page")},[e("span",$d,t(k.__("First")),1),a[48]||(a[48]=e("span",{class:"xs:hidden"},"«",-1))],10,kd),e("button",{onClick:ht,disabled:j.value===1,class:N(["px-2 sm:px-3 py-1.5 text-[10px] sm:text-xs font-medium rounded-lg border transition-[background-color] duration-75 touch-manipulation",j.value===1?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 active:bg-gray-100"]),"aria-label":k.__("Go to previous page")},[e("span",Sd,t(k.__("Previous")),1),a[49]||(a[49]=e("span",{class:"xs:hidden"},"‹",-1))],10,Cd),e("div",Id,[(s(!0),n(ce,null,ge(_t(),z=>(s(),n("button",{key:z,onClick:pe=>Ue(z),class:N(["min-w-[28px] sm:min-w-[32px] px-1.5 sm:px-2.5 py-1.5 text-[10px] sm:text-xs font-medium rounded-lg border transition-[background-color,border-color] duration-75 touch-manipulation",j.value===z?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 active:bg-gray-100"]),"aria-label":k.__("Go to page {0}",[z])},t(z),11,Vd))),128))]),e("button",{onClick:Ne,disabled:j.value===ue.value,class:N(["px-2 sm:px-3 py-1.5 text-[10px] sm:text-xs font-medium rounded-lg border transition-[background-color] duration-75 touch-manipulation",j.value===ue.value?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 active:bg-gray-100"]),"aria-label":k.__("Go to next page")},[e("span",Md,t(k.__("Next")),1),a[50]||(a[50]=e("span",{class:"xs:hidden"},"›",-1))],10,Dd),e("button",{onClick:a[23]||(a[23]=z=>Ue(ue.value)),disabled:j.value===ue.value,class:N(["px-2 sm:px-3 py-1.5 text-[10px] sm:text-xs font-medium rounded-lg border transition-[background-color] duration-75 touch-manipulation",j.value===ue.value?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 active:bg-gray-100"]),"aria-label":k.__("Go to last page")},[e("span",Td,t(k.__("Last")),1),a[51]||(a[51]=e("span",{class:"xs:hidden"},"»",-1))],10,Pd)])])])):I("",!0)])):I("",!0)]),se.value?(s(),ie(Ci,{key:0,show:W.value,"item-code":se.value.itemCode,"item-name":se.value.itemName,uom:se.value.uom,company:se.value.company,onClose:a[24]||(a[24]=z=>W.value=!1)},null,8,["show","item-code","item-name","uom","company"])):I("",!0)],64)}}},jd=Fe(Ad,[["__scopeId","data-v-81c527c3"]]),Ld={class:"flex-1 flex overflow-hidden"},Bd={class:"w-80 flex-shrink-0 border-e bg-gray-50 flex flex-col"},Od={class:"p-4 bg-white border-b flex flex-col gap-3"},Ed={class:"grid grid-cols-2 gap-2"},zd={class:"p-4 bg-white border-b flex flex-col gap-2"},Nd={class:"flex-1 overflow-y-auto"},Fd={key:0,class:"flex items-center justify-center py-12"},Rd={class:"text-center"},Ud={class:"text-sm text-gray-600"},Hd={key:1,class:"text-center py-12 px-4"},qd={class:"text-gray-400 mb-3"},Wd={class:"text-sm text-gray-600"},Gd={key:2,class:"p-2 flex flex-col gap-1"},Qd=["onClick"],Yd={class:"flex items-start justify-between mb-2"},Jd={class:"flex-1 min-w-0"},Kd={class:"flex items-center gap-2"},Xd={class:"text-xs text-gray-500 mt-0.5 truncate"},Zd={class:"flex items-center justify-between text-xs"},ec={class:"text-gray-500"},tc={class:"text-gray-500"},oc={class:"flex-1 overflow-y-auto bg-white"},sc={key:0,class:"flex items-center justify-center h-full"},ac={class:"text-center px-8 max-w-md"},lc={class:"text-gray-300 mb-4"},nc={class:"text-xl font-semibold text-gray-900 mb-2"},rc={class:"text-sm text-gray-600 mb-6"},ic={key:1,class:"text-sm text-amber-600"},uc={key:1,class:"p-6"},dc={class:"max-w-5xl mx-auto"},cc={class:"flex items-center justify-between mb-6 pb-4 border-b"},mc={class:"flex items-center gap-3"},vc={class:"text-xl font-semibold text-gray-900"},pc={class:"text-sm text-gray-600 mt-1"},fc={class:"flex items-center gap-2"},gc={key:2,class:"w-px h-6 bg-gray-200"},hc={class:"flex flex-col gap-6"},_c={class:"p-5"},yc={class:"flex items-center gap-2 mb-4"},bc={class:"text-sm font-semibold text-gray-900"},xc={class:"grid grid-cols-2 gap-4"},wc={class:"col-span-2"},kc={key:0,class:"col-span-2"},$c={key:1},Cc={class:"block text-sm font-medium text-gray-700 mb-2 text-start"},Sc={class:"px-3 py-2 bg-gray-50 rounded-lg"},Ic={class:"text-sm font-medium text-gray-900"},Vc={class:"text-xs text-gray-500"},Dc={class:"block text-sm font-medium text-gray-700 mb-2 text-start"},Mc={class:"px-3 py-2 bg-gray-50 rounded-lg"},Pc={class:"text-sm text-gray-900"},Tc={key:2},Ac={class:"block text-sm font-medium text-gray-700 mb-2 text-start"},jc={class:"px-3 py-2 bg-blue-50 rounded-lg border border-blue-200"},Lc={class:"text-sm font-medium text-blue-900"},Bc={class:"p-5"},Oc={class:"flex items-center gap-2 mb-4"},Ec={class:"text-sm font-semibold text-gray-900"},zc={class:"grid grid-cols-2 gap-4"},Nc={key:0,class:"mt-4 p-3 bg-purple-50 rounded-lg"},Fc={class:"text-sm text-gray-700"},Rc={key:0},Uc={key:1},Hc={key:2,class:"ms-2"},qc={key:3,class:"ms-2"},Wc={class:"p-5"},Gc={class:"flex items-center gap-2 mb-4"},Qc={class:"text-sm font-semibold text-gray-900"},Yc={class:"grid grid-cols-3 gap-4"},Jc={key:1},Kc={class:"block text-sm font-medium text-gray-700 mb-2 text-start"},Xc={class:"px-3 py-2 bg-gray-50 rounded-lg"},Zc={class:"text-lg font-bold text-gray-900"},e0={class:"mt-4"},t0={class:"flex items-center gap-2"},o0={class:"text-sm text-gray-700"},s0={class:"p-5"},a0={class:"flex items-center gap-2 mb-4"},l0={class:"text-sm font-semibold text-gray-900"},n0={class:"grid grid-cols-3 gap-4"},r0={class:"block text-xs font-medium text-gray-500 mb-1 text-start"},i0={class:"block text-xs font-medium text-gray-500 mb-1 text-start"},u0={class:"text-sm text-gray-900"},d0={class:"block text-xs font-medium text-gray-500 mb-1 text-start"},c0={class:"text-sm text-gray-900"},m0={key:0},v0={class:"block text-xs font-medium text-gray-500 mb-1 text-start"},p0={class:"text-sm text-gray-900"},f0={key:1},g0={class:"block text-xs font-medium text-gray-500 mb-1 text-start"},h0={class:"text-sm text-gray-900"},_0={class:"bg-white rounded-lg shadow-2xl max-w-md w-full mx-4 p-6"},y0={class:"flex items-start gap-4"},b0={class:"flex-shrink-0"},x0={class:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center"},w0={class:"flex-1"},k0={class:"text-lg font-semibold text-gray-900 mb-2"},$0={class:"text-sm text-gray-500"},C0={class:"flex justify-end gap-3 mt-6"},S0={__name:"CouponManagement",props:{company:String,currency:{type:String,default:"USD"},permissions:{type:Object,default:()=>({create:!0,write:!0,delete:!0})}},emits:["coupon-saved","refresh-requested"],setup(i,{expose:l,emit:d}){const{showSuccess:m,showError:$,showWarning:D}=ft(),T=i,S=d,p=C(!1),x=C([]),g=C(null),V=C({}),O=C(!1),w=C(!1),M=C(""),y=C("all"),v=C("all"),b=C([]),B=C({coupon_name:"",coupon_type:"Promotional",coupon_code:"",discount_type:"Percentage",discount_percentage:null,discount_amount:null,min_amount:null,max_amount:null,apply_on:"Grand Total",customer:"",campaign:"",valid_from:"",valid_upto:"",maximum_use:null,one_use:0,company:T.company}),H=ee(()=>{let f=x.value;if(M.value){const R=M.value.toLowerCase();f=f.filter(Se=>{var X,Ve,je;return((X=Se.coupon_code)==null?void 0:X.toLowerCase().includes(R))||((Ve=Se.coupon_name)==null?void 0:Ve.toLowerCase().includes(R))||((je=Se.customer_name)==null?void 0:je.toLowerCase().includes(R))})}return y.value!=="all"&&(f=f.filter(R=>R.status.toLowerCase().replace(" ","_")===y.value)),v.value!=="all"&&(f=f.filter(R=>R.coupon_type===v.value)),f}),le=ee(()=>[{label:__("-- No Campaign --"),value:""},...b.value.map(f=>({label:f.name,value:f.name}))]),K=Ae({url:"pos_next.api.promotions.get_coupons",makeParams(){return{company:T.company,include_disabled:!0}},auto:!1,onSuccess(f){x.value=f||[],p.value=!1},onError(f){p.value=!1,ue(f,__("Failed to load coupons"))}}),L=Ae({url:"pos_next.api.promotions.get_coupon_details",makeParams(){var f;return{coupon_name:(f=g.value)==null?void 0:f.name}},auto:!1,onSuccess(f){V.value=f||{},_(f),p.value=!1},onError(f){p.value=!1,ue(f,__("Failed to load coupon details"))}}),me=Ae({url:"frappe.client.get_list",makeParams(){return{doctype:"Campaign",fields:["name"],filters:{disabled:0},limit_page_length:999}},auto:!1,onSuccess(f){b.value=f||[]}}),we=Ae({url:"pos_next.api.promotions.create_coupon",makeParams(){return{data:JSON.stringify(B.value)}},auto:!1,onSuccess(f){p.value=!1;const R=(f==null?void 0:f.message)||f;m((R==null?void 0:R.message)||__("Coupon created successfully")),ae(),be(),S("coupon-saved",R)},onError(f){p.value=!1,ue(f,__("Failed to create coupon"))}}),J=Ae({url:"pos_next.api.promotions.update_coupon",makeParams(){var f;return{coupon_name:(f=g.value)==null?void 0:f.name,data:JSON.stringify({discount_type:B.value.discount_type,discount_percentage:B.value.discount_percentage,discount_amount:B.value.discount_amount,min_amount:B.value.min_amount,max_amount:B.value.max_amount,apply_on:B.value.apply_on,valid_from:B.value.valid_from,valid_upto:B.value.valid_upto,maximum_use:B.value.maximum_use,one_use:B.value.one_use})}},auto:!1,onSuccess(f){p.value=!1;const R=(f==null?void 0:f.message)||f;m((R==null?void 0:R.message)||__("Coupon updated successfully")),ae(),L.reload()},onError(f){p.value=!1,ue(f,__("Failed to update coupon"))}}),te=Ae({url:"pos_next.api.promotions.toggle_coupon",makeParams(){var f;return{coupon_name:(f=g.value)==null?void 0:f.name}},auto:!1,onSuccess(f){p.value=!1;const R=(f==null?void 0:f.message)||f;m((R==null?void 0:R.message)||__("Coupon status updated successfully")),ae(),g.value&&L.reload()},onError(f){p.value=!1,ue(f,__("Failed to toggle coupon status"))}}),ne=Ae({url:"pos_next.api.promotions.delete_coupon",makeParams(){var f;return{coupon_name:(f=g.value)==null?void 0:f.name}},auto:!1,onSuccess(f){p.value=!1,w.value=!1;const R=(f==null?void 0:f.message)||f;m((R==null?void 0:R.message)||__("Coupon deleted successfully")),ae(),be()},onError(f){p.value=!1,w.value=!1,ue(f,__("Failed to delete coupon"))}});xe(()=>g.value,f=>{f&&!O.value&&(p.value=!0,L.reload())}),ze(()=>{ae(),he()});function ae(){p.value=!0,K.reload()}function he(){me.reload()}function oe(){r(),O.value=!0,g.value=null}function Ce(f){O.value||(g.value=f)}function be(){O.value=!1,g.value=null,r()}function Pe(){if(!B.value.coupon_name){D(__("Please enter a coupon name"));return}if(!B.value.discount_type){D(__("Please select a discount type"));return}if(B.value.discount_type==="Percentage"){if(!B.value.discount_percentage||B.value.discount_percentage<=0||B.value.discount_percentage>100){D(__("Please enter a valid discount percentage (1-100)"));return}}else if(B.value.discount_type==="Amount"&&(!B.value.discount_amount||B.value.discount_amount<=0)){D(__("Please enter a valid discount amount"));return}if(B.value.coupon_type==="Gift Card"&&!B.value.customer){D(__("Please select a customer for gift card"));return}p.value=!0,O.value?we.reload():J.reload()}function W(){p.value=!0,te.reload()}function se(){if(g.value.used>0){D(__("Cannot delete coupon as it has been used {0} times",[g.value.used]));return}w.value=!0}function _e(){p.value=!0,ne.reload()}function De(){const f="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let R="";for(let Se=0;Se<8;Se++)R+=f.charAt(Math.floor(Math.random()*f.length));B.value.coupon_code=R}function r(){B.value={coupon_name:"",coupon_type:"Promotional",coupon_code:"",discount_type:"Percentage",discount_percentage:null,discount_amount:null,min_amount:null,max_amount:null,apply_on:"Grand Total",customer:"",campaign:"",valid_from:"",valid_upto:"",maximum_use:null,one_use:0,company:T.company}}function _(f){B.value={coupon_name:f.coupon_name||"",coupon_type:f.coupon_type||__("Promotional"),coupon_code:f.coupon_code||"",discount_type:f.discount_type||__("Percentage"),discount_percentage:f.discount_percentage||null,discount_amount:f.discount_amount||null,min_amount:f.min_amount||null,max_amount:f.max_amount||null,apply_on:f.apply_on||__("Grand Total"),customer:f.customer||"",campaign:f.campaign||"",valid_from:f.valid_from||"",valid_upto:f.valid_upto||"",maximum_use:f.maximum_use||null,one_use:f.one_use||0,company:f.company||T.company}}function F(f){return f?new Date(f).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}function j(f){return new Intl.NumberFormat("en-US",{style:"currency",currency:T.currency}).format(f||0)}function ve(f){switch(f){case"Active":return"green";case"Expired":return"red";case"Not Started":return"orange";case"Exhausted":return"gray";case"Disabled":return"red";default:return"gray"}}function $e(f){try{if(f._server_messages){const R=JSON.parse(f._server_messages);if(Array.isArray(R)&&R.length>0)return(typeof R[0]=="string"?JSON.parse(R[0]):R[0]).message||f.message||__("An error occurred")}return f.message||__("An error occurred")}catch(R){return f.message||__("An error occurred")}}function ue(f,R=__("An error occurred")){const Se=$e(f);$(Se||R)}return l({loadCoupons:ae}),(f,R)=>{var Se;return s(),n(ce,null,[e("div",Ld,[e("div",Bd,[e("div",Od,[h(o(ye),{type:"text",modelValue:M.value,"onUpdate:modelValue":R[0]||(R[0]=X=>M.value=X),placeholder:f.__("Search coupons...")},{prefix:E(()=>[h(o(de),{name:"search",class:"w-4 h-4 text-gray-500"})]),_:1},8,["modelValue","placeholder"]),e("div",Ed,[h(o(ye),{type:"select",modelValue:y.value,"onUpdate:modelValue":R[1]||(R[1]=X=>y.value=X),options:[{label:f.__("All Status"),value:"all"},{label:f.__("Active Only"),value:"active"},{label:f.__("Expired"),value:"expired"},{label:f.__("Not Started"),value:"not_started"},{label:f.__("Exhausted"),value:"exhausted"},{label:f.__("Disabled"),value:"disabled"}]},null,8,["modelValue","options"]),h(o(ye),{type:"select",modelValue:v.value,"onUpdate:modelValue":R[2]||(R[2]=X=>v.value=X),options:[{label:f.__("All Types"),value:"all"},{label:f.__("Promotional"),value:"Promotional"},{label:f.__("Gift Card"),value:"Gift Card"}]},null,8,["modelValue","options"])])]),e("div",zd,[i.permissions.create?(s(),ie(o(fe),{key:0,onClick:oe,variant:"solid",class:"w-full"},{prefix:E(()=>[h(o(de),{name:"plus-circle",class:"w-4 h-4"})]),default:E(()=>[Q(" "+t(f.__("Create New Coupon")),1)]),_:1})):I("",!0),h(o(fe),{onClick:ae,variant:"outline",class:"w-full",loading:p.value},{prefix:E(()=>[h(o(de),{name:"refresh-cw",class:"w-4 h-4"})]),default:E(()=>[Q(" "+t(f.__("Refresh")),1)]),_:1},8,["loading"])]),e("div",Nd,[p.value&&x.value.length===0?(s(),n("div",Fd,[e("div",Rd,[h(o(Et),{class:"w-6 h-6 mx-auto mb-2"}),e("p",Ud,t(f.__("Loading...")),1)])])):H.value.length===0?(s(),n("div",Hd,[e("div",qd,[h(o(de),{name:"gift",class:"w-12 h-12 mx-auto"})]),e("p",Wd,t(f.__("No coupons found")),1)])):(s(),n("div",Gd,[(s(!0),n(ce,null,ge(H.value,X=>{var Ve,je;return s(),n("button",{key:X.name,onClick:qe=>Ce(X),class:N(["w-full text-start p-3 rounded-md transition-all",((Ve=g.value)==null?void 0:Ve.name)===X.name?"bg-blue-50 ring-2 ring-blue-500 ring-inset":"hover:bg-gray-100"])},[e("div",Yd,[e("div",Jd,[e("div",Kd,[e("p",{class:N(["text-sm font-medium truncate",((je=g.value)==null?void 0:je.name)===X.name?"text-blue-900":"text-gray-900"])},t(X.coupon_code),3),X.coupon_type==="Gift Card"?(s(),ie(o(Oe),{key:0,variant:"subtle",theme:"purple",size:"sm"},{default:E(()=>[Q(t(f.__("Gift")),1)]),_:1})):I("",!0)]),e("p",Xd,t(X.coupon_name),1)]),h(o(Oe),{variant:"subtle",theme:ve(X.status),size:"sm"},{default:E(()=>[Q(t(X.status||f.__("Active")),1)]),_:2},1032,["theme"])]),e("div",Zd,[e("span",ec,t(X.maximum_use?f.__("Used: {0}/{1}",[X.used,X.maximum_use]):f.__("Used: {0}",[X.used])),1),e("span",tc,t(X.valid_upto?F(X.valid_upto):f.__("No expiry")),1)])],10,Qd)}),128))]))])]),e("div",oc,[!g.value&&!O.value?(s(),n("div",sc,[e("div",ac,[e("div",lc,[h(o(de),{name:"gift",class:"w-16 h-16 mx-auto"})]),e("h3",nc,t(f.__("Select a Coupon")),1),e("p",rc,t(f.__("Choose a coupon from the list to view and edit, or create a new one to get started")),1),i.permissions.create?(s(),ie(o(fe),{key:0,onClick:oe,variant:"solid"},{prefix:E(()=>[h(o(de),{name:"plus",class:"w-4 h-4"})]),default:E(()=>[Q(" "+t(f.__("Create New Coupon")),1)]),_:1})):(s(),n("p",ic,t(f.__("You don't have permission to create coupons")),1))])])):(s(),n("div",uc,[e("div",dc,[e("div",cc,[e("div",null,[e("div",mc,[e("h3",vc,t(O.value?f.__("Create New Coupon"):f.__("Coupon Details")),1),!O.value&&((Se=g.value)!=null&&Se.coupon_type)?(s(),ie(o(Oe),{key:0,variant:"subtle",theme:g.value.coupon_type==="Gift Card"?"purple":"blue",size:"md"},{default:E(()=>[Q(t(g.value.coupon_type),1)]),_:1},8,["theme"])):I("",!0)]),e("p",pc,t(O.value?f.__("Fill in the details to create a new coupon"):f.__("View and update coupon information")),1)]),e("div",fc,[!O.value&&i.permissions.write?(s(),ie(o(fe),{key:0,onClick:W,variant:"outline",theme:V.value.disabled?"green":"orange"},{prefix:E(()=>[h(o(de),{name:V.value.disabled?"check-circle":"x-circle",class:"w-4 h-4"},null,8,["name"])]),default:E(()=>[Q(" "+t(V.value.disabled?f.__("Enable"):f.__("Disable")),1)]),_:1},8,["theme"])):I("",!0),!O.value&&i.permissions.delete&&g.value.used===0?(s(),ie(o(fe),{key:1,onClick:se,variant:"ghost",theme:"red"},{prefix:E(()=>[h(o(de),{name:"trash-2",class:"w-4 h-4"})]),default:E(()=>[Q(" "+t(f.__("Delete")),1)]),_:1})):I("",!0),!O.value&&(i.permissions.write||i.permissions.delete)?(s(),n("div",gc)):I("",!0),h(o(fe),{onClick:be,variant:"ghost"},{default:E(()=>[Q(t(f.__("Cancel")),1)]),_:1}),(O.value?i.permissions.create:i.permissions.write)?(s(),ie(o(fe),{key:3,onClick:Pe,loading:p.value,variant:"solid"},{prefix:E(()=>[h(o(de),{name:O.value?"plus":"save",class:"w-4 h-4"},null,8,["name"])]),default:E(()=>[Q(" "+t(O.value?f.__("Create"):f.__("Update")),1)]),_:1},8,["loading"])):I("",!0)])]),e("div",hc,[h(o(pt),null,{default:E(()=>[e("div",_c,[e("div",yc,[h(o(de),{name:"info",class:"w-4 h-4 text-blue-600"}),e("h4",bc,t(f.__("Basic Information")),1)]),e("div",xc,[e("div",wc,[h(o(ye),{type:"text",label:f.__("Coupon Name"),modelValue:B.value.coupon_name,"onUpdate:modelValue":R[3]||(R[3]=X=>B.value.coupon_name=X),disabled:!O.value,placeholder:f.__("e.g., Summer Sale Coupon 2025"),required:""},null,8,["label","modelValue","disabled","placeholder"])]),h(o(ye),{type:"select",label:f.__("Coupon Type"),modelValue:B.value.coupon_type,"onUpdate:modelValue":R[4]||(R[4]=X=>B.value.coupon_type=X),disabled:!O.value,options:[{label:f.__("Promotional"),value:"Promotional"},{label:f.__("Gift Card"),value:"Gift Card"}],required:""},null,8,["label","modelValue","disabled","options"]),h(o(ye),{type:"text",label:f.__("Coupon Code"),modelValue:B.value.coupon_code,"onUpdate:modelValue":R[5]||(R[5]=X=>B.value.coupon_code=X),disabled:!O.value,placeholder:f.__("Auto-generated if empty")},Bs({_:2},[O.value?{name:"suffix",fn:E(()=>[h(o(fe),{size:"sm",variant:"ghost",onClick:De},{default:E(()=>[Q(t(f.__("Generate")),1)]),_:1})]),key:"0"}:void 0]),1032,["label","modelValue","disabled","placeholder"]),B.value.coupon_type==="Gift Card"?(s(),n("div",kc,[O.value?(s(),ie(o(ye),{key:0,type:"text",label:f.__("Customer"),modelValue:B.value.customer,"onUpdate:modelValue":R[6]||(R[6]=X=>B.value.customer=X),placeholder:f.__("Customer ID or Name"),required:""},null,8,["label","modelValue","placeholder"])):(s(),n("div",$c,[e("label",Cc,t(f.__("Customer")),1),e("div",Sc,[e("p",Ic,t(V.value.customer_name||V.value.customer),1),e("p",Vc,t(V.value.customer),1)])]))])):I("",!0),b.value.length>0?(s(),ie(o(ye),{key:1,type:"select",label:f.__("Campaign"),modelValue:B.value.campaign,"onUpdate:modelValue":R[7]||(R[7]=X=>B.value.campaign=X),disabled:!O.value,options:le.value},null,8,["label","modelValue","disabled","options"])):I("",!0),e("div",null,[e("label",Dc,t(f.__("Company")),1),e("div",Mc,[e("p",Pc,t(O.value?T.company:V.value.company),1)])]),!O.value&&V.value.referral_code?(s(),n("div",Tc,[e("label",Ac,t(f.__("Referral Code")),1),e("div",jc,[e("p",Lc,t(V.value.referral_code),1)])])):I("",!0)])])]),_:1}),h(o(pt),null,{default:E(()=>[e("div",Bc,[e("div",Oc,[h(o(de),{name:"percent",class:"w-4 h-4 text-purple-600"}),e("h4",Ec,t(f.__("Discount Configuration")),1)]),e("div",zc,[h(o(ye),{type:"select",label:f.__("Discount Type"),modelValue:B.value.discount_type,"onUpdate:modelValue":R[8]||(R[8]=X=>B.value.discount_type=X),options:[{label:f.__("Percentage"),value:"Percentage"},{label:f.__("Amount"),value:"Amount"}],required:""},null,8,["label","modelValue","options"]),h(o(ye),{type:"select",label:f.__("Apply Discount On"),modelValue:B.value.apply_on,"onUpdate:modelValue":R[9]||(R[9]=X=>B.value.apply_on=X),options:[{label:f.__("Grand Total"),value:"Grand Total"},{label:f.__("Net Total"),value:"Net Total"}],required:""},null,8,["label","modelValue","options"]),B.value.discount_type==="Percentage"?(s(),ie(o(ye),{key:0,type:"number",label:f.__("Discount Percentage (%)"),modelValue:B.value.discount_percentage,"onUpdate:modelValue":R[10]||(R[10]=X=>B.value.discount_percentage=X),placeholder:f.__("e.g., 20"),min:0,max:100,required:""},null,8,["label","modelValue","placeholder"])):I("",!0),B.value.discount_type==="Amount"?(s(),ie(o(ye),{key:1,type:"number",label:f.__("Discount Amount"),modelValue:B.value.discount_amount,"onUpdate:modelValue":R[11]||(R[11]=X=>B.value.discount_amount=X),placeholder:f.__("Amount in {0}",[i.currency]),min:0,required:""},null,8,["label","modelValue","placeholder"])):I("",!0),h(o(ye),{type:"number",label:f.__("Minimum Cart Amount"),modelValue:B.value.min_amount,"onUpdate:modelValue":R[12]||(R[12]=X=>B.value.min_amount=X),placeholder:f.__("Optional minimum in {0}",[i.currency]),min:0},null,8,["label","modelValue","placeholder"]),h(o(ye),{type:"number",label:f.__("Maximum Discount Amount"),modelValue:B.value.max_amount,"onUpdate:modelValue":R[13]||(R[13]=X=>B.value.max_amount=X),placeholder:f.__("Optional cap in {0}",[i.currency]),min:0},null,8,["label","modelValue","placeholder"])]),!O.value&&V.value.discount_type?(s(),n("div",Nc,[e("p",Fc,[e("strong",null,t(f.__("Current Discount:")),1),V.value.discount_type==="Percentage"?(s(),n("span",Rc,t(f.__("{0}% off {1}",[Number(V.value.discount_percentage).toFixed(2),V.value.apply_on])),1)):(s(),n("span",Uc,t(f.__("{0} off {1}",[j(V.value.discount_amount),V.value.apply_on])),1)),V.value.min_amount?(s(),n("span",Hc,t(f.__("(Min: {0})",[j(V.value.min_amount)])),1)):I("",!0),V.value.max_amount?(s(),n("span",qc,t(f.__("(Max Discount: {0})",[j(V.value.max_amount)])),1)):I("",!0)])])):I("",!0)])]),_:1}),h(o(pt),null,{default:E(()=>[e("div",Wc,[e("div",Gc,[h(o(de),{name:"calendar",class:"w-4 h-4 text-green-600"}),e("h4",Qc,t(f.__("Validity & Usage")),1)]),e("div",Yc,[h(o(ye),{type:"date",label:f.__("Valid From"),modelValue:B.value.valid_from,"onUpdate:modelValue":R[14]||(R[14]=X=>B.value.valid_from=X)},null,8,["label","modelValue"]),h(o(ye),{type:"date",label:f.__("Valid Until"),modelValue:B.value.valid_upto,"onUpdate:modelValue":R[15]||(R[15]=X=>B.value.valid_upto=X)},null,8,["label","modelValue"]),B.value.coupon_type==="Promotional"?(s(),ie(o(ye),{key:0,type:"number",label:f.__("Maximum Use"),modelValue:B.value.maximum_use,"onUpdate:modelValue":R[16]||(R[16]=X=>B.value.maximum_use=X),placeholder:f.__("Unlimited")},null,8,["label","modelValue","placeholder"])):I("",!0),O.value?I("",!0):(s(),n("div",Jc,[e("label",Kc,t(f.__("Times Used")),1),e("div",Xc,[e("p",Zc,t(V.value.used||0),1)])]))]),e("div",e0,[e("label",t0,[dt(e("input",{type:"checkbox","onUpdate:modelValue":R[17]||(R[17]=X=>B.value.one_use=X),class:"rounded border-gray-300"},null,512),[[Os,B.value.one_use]]),e("span",o0,t(f.__("Only One Use Per Customer")),1)])])])]),_:1}),O.value?I("",!0):(s(),ie(o(pt),{key:0},{default:E(()=>[e("div",s0,[e("div",a0,[h(o(de),{name:"activity",class:"w-4 h-4 text-orange-600"}),e("h4",l0,t(f.__("Coupon Status & Info")),1)]),e("div",n0,[e("div",null,[e("label",r0,t(f.__("Current Status")),1),h(o(Oe),{theme:ve(g.value.status),variant:"subtle",size:"md"},{default:E(()=>[Q(t(g.value.status),1)]),_:1},8,["theme"])]),e("div",null,[e("label",i0,t(f.__("Created On")),1),e("p",u0,t(F(V.value.creation)),1)]),e("div",null,[e("label",d0,t(f.__("Last Modified")),1),e("p",c0,t(F(V.value.modified)),1)]),V.value.email_id?(s(),n("div",m0,[e("label",v0,t(f.__("Email")),1),e("p",p0,t(V.value.email_id),1)])):I("",!0),V.value.mobile_no?(s(),n("div",f0,[e("label",g0,t(f.__("Mobile")),1),e("p",h0,t(V.value.mobile_no),1)])):I("",!0)])])]),_:1}))])])]))])]),h(Ye,{name:"fade"},{default:E(()=>{var X;return[w.value?(s(),n("div",{key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[400]",onClick:R[19]||(R[19]=ke(Ve=>w.value=!1,["self"]))},[e("div",_0,[e("div",y0,[e("div",b0,[e("div",x0,[h(o(de),{name:"alert-triangle",class:"w-6 h-6 text-red-600"})])]),e("div",w0,[e("h3",k0,t(f.__("Delete Coupon")),1),h(ut,{tag:"p",class:"text-sm text-gray-600 mb-1",inner:f.__('Are you sure you want to delete <strong>"{0}"<strong>?',[(X=g.value)==null?void 0:X.coupon_code])},null,8,["inner"]),e("p",$0,t(f.__("This action cannot be undone.")),1)])]),e("div",C0,[h(o(fe),{onClick:R[18]||(R[18]=Ve=>w.value=!1),variant:"ghost"},{default:E(()=>[Q(t(f.__("Cancel")),1)]),_:1}),h(o(fe),{onClick:_e,variant:"solid",theme:"red",loading:p.value},{prefix:E(()=>[h(o(de),{name:"trash-2",class:"w-4 h-4"})]),default:E(()=>[Q(" "+t(f.__("Delete Coupon")),1)]),_:1},8,["loading"])])])])):I("",!0)]}),_:1})],64)}}},I0=Fe(S0,[["__scopeId","data-v-cbe8f16c"]]),V0={class:"fixed inset-0 flex items-center justify-center p-4"},D0={class:"w-full h-full max-w-[95vw] max-h-[95vh] bg-white rounded-lg shadow-2xl overflow-hidden flex flex-col"},M0={class:"flex items-center justify-between px-6 py-4 border-b"},P0={class:"flex items-center gap-3"},T0={class:"text-lg mb-1 font-semibold text-gray-900"},A0={class:"text-sm text-gray-600"},j0={class:"flex items-center gap-2"},L0={class:"border-b bg-white px-6"},B0={class:"flex gap-1"},O0={class:"flex items-center gap-2"},E0={class:"flex items-center gap-2"},z0={class:"flex-1 flex overflow-hidden"},N0={class:"w-80 flex-shrink-0 border-e bg-gray-50 flex flex-col"},F0={class:"p-4 bg-white border-b flex flex-col gap-3"},R0={class:"p-4 bg-white border-b flex flex-col gap-2"},U0={key:1,class:"px-3 py-2 bg-amber-50 border border-amber-200 rounded-lg"},H0={class:"flex items-start gap-2"},q0={class:"flex-1"},W0={class:"text-xs font-medium text-amber-900"},G0={class:"flex-1 overflow-y-auto"},Q0={key:0,class:"flex items-center justify-center py-12"},Y0={class:"text-center"},J0={class:"text-sm text-gray-600"},K0={key:1,class:"text-center py-12 px-4"},X0={class:"text-gray-400 mb-3"},Z0={class:"text-sm text-gray-600"},em={key:2,class:"p-2 flex flex-col gap-1"},tm=["onClick"],om={class:"flex items-start justify-between mb-2"},sm={class:"flex-1 min-w-0"},am={class:"flex items-center gap-2"},lm={class:"text-xs text-gray-500 mt-0.5"},nm={class:"flex items-center justify-between text-xs"},rm={class:"text-gray-500"},im={class:"flex-1 overflow-y-auto bg-white"},um={key:0,class:"flex items-center justify-center h-full"},dm={class:"text-center px-8 max-w-md"},cm={class:"text-gray-300 mb-4"},mm={class:"text-xl font-semibold text-gray-900 mb-2"},vm={class:"text-sm text-gray-600 mb-6"},pm={key:1,class:"text-sm text-amber-600"},fm={key:1,class:"p-6"},gm={class:"max-w-5xl mx-auto"},hm={class:"flex items-center justify-between mb-6 pb-4 border-b"},_m={class:"flex items-center gap-3"},ym={class:"text-xl font-semibold text-gray-900"},bm={class:"text-sm text-gray-600 mt-1"},xm={key:0},wm={key:1},km={key:2},$m={class:"flex items-center gap-2"},Cm={key:0,class:"flex items-center gap-2 px-3 py-1 bg-blue-50 rounded-lg"},Sm={class:"text-xs text-blue-700 font-medium"},Im={key:3,class:"w-px h-6 bg-gray-200"},Vm={class:"flex flex-col gap-6"},Dm={class:"p-5"},Mm={class:"flex items-center gap-2 mb-4"},Pm={class:"text-sm font-semibold text-gray-900"},Tm={class:"grid grid-cols-3 gap-4"},Am={class:"col-span-3"},jm={class:"p-5"},Lm={class:"flex items-center gap-2 mb-4"},Bm={class:"text-sm font-semibold text-gray-900"},Om={key:0,class:"flex flex-col gap-3"},Em={class:"text-xs text-gray-500 mt-1"},zm={key:0,class:"border rounded-lg overflow-hidden"},Nm={class:"max-h-40 overflow-y-auto divide-y"},Fm=["onClick"],Rm={class:"text-sm font-medium text-gray-900"},Um={class:"text-xs text-gray-500"},Hm={key:1,class:"flex flex-wrap gap-2"},qm=["onClick"],Wm={key:1,class:"flex flex-col gap-3"},Gm={key:0,class:"flex flex-wrap gap-2"},Qm=["onClick"],Ym={key:2,class:"flex flex-col gap-3"},Jm={key:0,class:"flex flex-wrap gap-2"},Km=["onClick"],Xm={class:"p-5"},Zm={class:"flex items-center gap-2 mb-4"},ev={class:"text-sm font-semibold text-gray-900"},tv={class:"flex flex-col gap-4"},ov={class:"block text-sm font-medium text-gray-700 mb-3 text-start"},sv={class:"grid grid-cols-3 gap-3"},av=["onClick","disabled"],lv={class:"text-sm font-medium"},nv={class:"grid grid-cols-3 gap-4"},rv={key:1,class:"flex flex-col gap-2"},iv={class:"block text-sm font-medium text-gray-700 text-start"},uv={key:1,class:"border rounded-lg overflow-hidden"},dv={class:"max-h-40 overflow-y-auto divide-y"},cv=["onClick"],mv={class:"text-sm font-medium text-gray-900"},vv={class:"text-xs text-gray-500"},pv={key:2,class:"flex items-center gap-2"},fv={class:"bg-white rounded-lg shadow-2xl max-w-md w-full mx-4 p-6"},gv={class:"flex items-start gap-4"},hv={class:"flex-shrink-0"},_v={class:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center"},yv={class:"flex-1"},bv={class:"text-lg font-semibold text-gray-900 mb-2"},xv={class:"text-sm text-gray-500"},wv={class:"flex justify-end gap-3 mt-6"},kv={__name:"PromotionManagement",props:{modelValue:Boolean,posProfile:String,company:String,currency:{type:String,default:"USD"}},emits:["update:modelValue","promotion-saved"],setup(i,{emit:l}){const{showSuccess:d,showError:m,showWarning:$}=ft(),{canCreatePromotion:D,canEditPromotion:T,canDeletePromotion:S}=qs(),p=C({create:!0,write:!0,delete:!0}),x=i,g=l,V=zt(),O=C(x.modelValue),w=C(!1),M=C(!1),y=C(null),v=C(!1),b=C(null),B=C("promotions"),H=C([]),le=C(""),K=C("all"),L=C({name:"",company:x.company,apply_on:"Item Group",discount_type:"percentage",discount_value:0,free_item:"",free_qty:1,items:[],min_qty:0,max_qty:0,min_amt:0,max_amt:0,valid_from:"",valid_upto:""}),me=C([]),we=C([]),J=C(""),te=C(""),ne=C(""),ae=C(""),he=[{value:"percentage",label:__("Percentage"),icon:"percent"},{value:"amount",label:__("Fixed Amount"),icon:"dollar-sign"},{value:"free_item",label:__("Free Item"),icon:"gift"}],oe=ee(()=>{var a;return!M.value&&((a=y.value)==null?void 0:a.source)==="Pricing Rule"}),Ce=ee(()=>{let a=H.value;return le.value&&(a=a.filter(A=>A.name.toLowerCase().includes(le.value.toLowerCase()))),K.value==="active"?a=a.filter(A=>A.status==="Active"):K.value==="expired"?a=a.filter(A=>A.status==="Expired"):K.value==="not_started"?a=a.filter(A=>A.status==="Not Started"):K.value==="disabled"&&(a=a.filter(A=>A.status==="Disabled")),a}),be=ee(()=>{if(!J.value||J.value.length<2)return[];const a=J.value.toLowerCase();return(V.allItems||[]).filter(pe=>{var U,Ie,Le;return((U=pe.item_code)==null?void 0:U.toLowerCase().includes(a))||((Ie=pe.item_name)==null?void 0:Ie.toLowerCase().includes(a))||((Le=pe.barcode)==null?void 0:Le.toLowerCase().includes(a))}).slice(0,20)}),Pe=ee(()=>{if(!te.value||te.value.length<2)return[];const a=te.value.toLowerCase();return(V.allItems||[]).filter(pe=>{var U,Ie,Le;return((U=pe.item_code)==null?void 0:U.toLowerCase().includes(a))||((Ie=pe.item_name)==null?void 0:Ie.toLowerCase().includes(a))||((Le=pe.barcode)==null?void 0:Le.toLowerCase().includes(a))}).slice(0,20)}),W=Ae({url:"pos_next.api.promotions.get_promotions",makeParams(){return{pos_profile:x.posProfile,company:x.company,include_disabled:!0}},auto:!1,onSuccess(a){H.value=a||[],w.value=!1}}),se=Ae({url:"pos_next.api.promotions.get_item_groups",makeParams(){return{company:x.company}},auto:!1,onSuccess(a){me.value=a||[]},onError(a){console.error("Error loading item groups:",a),ue(a,__("Failed to load item groups"))}}),_e=Ae({url:"pos_next.api.promotions.get_brands",auto:!1,onSuccess(a){we.value=a||[]},onError(a){console.error("Error loading brands:",a),ue(a,__("Failed to load brands"))}}),De=Ae({url:"pos_next.api.promotions.create_promotion",makeParams(){return{data:JSON.stringify(L.value)}},auto:!1,onSuccess(a){w.value=!1;const A=(a==null?void 0:a.message)||a,z=(A==null?void 0:A.message)||__("Promotion created successfully");d(z),g("promotion-saved",A),R(),f()},onError(a){w.value=!1,ue(a,__("Failed to create promotion"))}}),r=Ae({url:"pos_next.api.promotions.update_promotion",makeParams(){return{scheme_name:L.value.name,data:JSON.stringify({valid_from:L.value.valid_from,valid_upto:L.value.valid_upto,min_qty:L.value.min_qty,max_qty:L.value.max_qty,min_amt:L.value.min_amt,max_amt:L.value.max_amt,discount_value:L.value.discount_value,free_item:L.value.free_item,free_qty:L.value.free_qty})}},auto:!1,onSuccess(a){w.value=!1;const A=(a==null?void 0:a.message)||a,z=(A==null?void 0:A.message)||__("Promotion updated successfully");d(z),R(),f()},onError(a){w.value=!1,ue(a,__("Failed to update promotion"))}}),_=Ae({url:"pos_next.api.promotions.toggle_promotion",auto:!1,onSuccess(){d(__("Promotion status updated successfully")),R()},onError(a){ue(a,__("Failed to update promotion status"))}}),F=Ae({url:"pos_next.api.promotions.delete_promotion",auto:!1,onSuccess(a){const A=(a==null?void 0:a.message)||a,z=(A==null?void 0:A.message)||__("Promotion deleted successfully");d(z),v.value=!1,b.value=null,R(),f()},onError(a){w.value=!1,v.value=!1,b.value=null,ue(a,__("Failed to delete promotion"))}}),j=Ae({url:"pos_next.api.promotions.get_promotion_details",makeParams(){var a;return{scheme_name:(a=y.value)==null?void 0:a.name}},auto:!1,onSuccess(a){w.value=!1,ht(a)},onError(a){w.value=!1,ue(a,__("Failed to load promotion details"))}});xe(()=>x.modelValue,a=>{O.value=a,a&&(R(),Se(),ve())}),xe(O,a=>{g("update:modelValue",a),a||(Ne(),y.value=null,M.value=!1)}),ze(()=>{ve()});function ve(){return Z(this,null,function*(){try{const[a,A,z]=yield Promise.all([D(),T(),S()]);p.value={create:a,write:A,delete:z}}catch(a){console.error("Error checking promotion permissions:",a),p.value={create:!1,write:!1,delete:!1}}})}function $e(a){try{if(a._server_messages){const A=JSON.parse(a._server_messages);if(Array.isArray(A)&&A.length>0)return(typeof A[0]=="string"?JSON.parse(A[0]):A[0]).message||a.message||__("An error occurred")}return a.message||__("An error occurred")}catch(A){return a.message||__("An error occurred")}}function ue(a,A=__("An error occurred")){const z=$e(a);m(z||A)}function f(){Ne(),y.value=null,M.value=!1}function R(){w.value=!0,W.reload()}function Se(){se.reload(),_e.reload()}function X(){O.value=!1}function Ve(){Ne(),M.value=!0,y.value=null}function je(a){M.value=!1,y.value=a,w.value=!0,j.reload()}function qe(){Ne(),y.value=null,M.value=!1}function ot(a){_.submit({scheme_name:a.name})}function Re(a){b.value=a,v.value=!0}function Je(){b.value&&(w.value=!0,F.submit({scheme_name:b.value.name}))}function Ee(){v.value=!1,b.value=null}function rt(){if(!L.value.name){$(__("Please enter a promotion name"));return}if(M.value&&H.value.find(A=>A.name.toLowerCase()===L.value.name.toLowerCase())){$(__('Promotion "{0}" already exists. Please use a different name.',[L.value.name]));return}if(L.value.apply_on!=="Transaction"&&L.value.items.length===0){$(__("`Please select at least one {0}`",[L.value.apply_on]));return}w.value=!0,M.value?De.reload():r.reload()}function Ke(a){L.value.items.some(A=>A.item_code===a.item_code)||L.value.items.push({item_code:a.item_code}),J.value=""}function mt(){ne.value&&!L.value.items.some(a=>a.item_group===ne.value)&&L.value.items.push({item_group:ne.value}),ne.value=""}function gt(){ae.value&&!L.value.items.some(a=>a.brand===ae.value)&&L.value.items.push({brand:ae.value}),ae.value=""}function Xe(a){L.value.items.splice(a,1)}function Ue(a){L.value.free_item=a.item_code,te.value=""}function Ne(){L.value={name:"",company:x.company,apply_on:"Item Group",discount_type:"percentage",discount_value:0,free_item:"",free_qty:1,items:[],min_qty:0,max_qty:0,min_amt:0,max_amt:0,valid_from:"",valid_upto:""},J.value="",te.value="",ne.value="",ae.value=""}function ht(a){if(Ne(),L.value.name=a.name,L.value.company=a.company,L.value.apply_on=a.apply_on,L.value.valid_from=a.valid_from||"",L.value.valid_upto=a.valid_upto||"",a.apply_on==="Item Code"&&a.items?L.value.items=a.items.map(A=>({item_code:A.item_code,uom:A.uom})):a.apply_on==="Item Group"&&a.item_groups?L.value.items=a.item_groups.map(A=>({item_group:A.item_group,uom:A.uom})):a.apply_on==="Brand"&&a.brands&&(L.value.items=a.brands.map(A=>({brand:A.brand,uom:A.uom}))),a.price_discount_slabs&&a.price_discount_slabs.length>0){const A=a.price_discount_slabs[0];L.value.min_qty=A.min_qty||0,L.value.max_qty=A.max_qty||0,L.value.min_amt=A.min_amount||0,L.value.max_amt=A.max_amount||0,A.rate_or_discount==="Discount Percentage"?(L.value.discount_type="percentage",L.value.discount_value=A.discount_percentage||0):A.rate_or_discount==="Discount Amount"&&(L.value.discount_type="amount",L.value.discount_value=A.discount_amount||0)}else if(a.product_discount_slabs&&a.product_discount_slabs.length>0){const A=a.product_discount_slabs[0];L.value.discount_type="free_item",L.value.free_item=A.free_item||"",L.value.free_qty=A.free_qty||1,L.value.min_qty=A.min_qty||0,L.value.max_qty=A.max_qty||0,L.value.min_amt=A.min_amount||0,L.value.max_amt=A.max_amount||0}}function _t(a){return a?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}function Te(a){switch(a){case"Active":return"green";case"Expired":return"red";case"Not Started":return"orange";case"Disabled":return"gray";default:return"gray"}}function k(a){g("promotion-saved",a)}return(a,A)=>(s(),ie(Ye,{name:"fade"},{default:E(()=>{var z,pe;return[O.value?(s(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-[300]",onClick:ke(X,["self"])},[e("div",V0,[e("div",D0,[e("div",M0,[e("div",P0,[h(o(de),{name:"tag",class:"w-5 h-5 text-gray-700"}),e("div",null,[e("h2",T0,t(a.__("Promotion & Coupon Management")),1),e("p",A0,t(a.__("Manage promotional schemes and coupons")),1)])]),e("div",j0,[h(o(fe),{variant:"ghost",onClick:X,icon:"x"},{icon:E(()=>[h(o(de),{name:"x",class:"w-4 h-4"})]),_:1})])]),e("div",L0,[e("div",B0,[e("button",{onClick:A[0]||(A[0]=U=>B.value="promotions"),class:N(["px-4 py-3 text-sm font-medium border-b-2 transition-colors",B.value==="promotions"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-gray-900 hover:border-gray-300"])},[e("div",O0,[h(o(de),{name:"percent",class:"w-4 h-4"}),e("span",null,t(a.__("Promotional Schemes")),1)])],2),e("button",{onClick:A[1]||(A[1]=U=>B.value="coupons"),class:N(["px-4 py-3 text-sm font-medium border-b-2 transition-colors",B.value==="coupons"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-gray-900 hover:border-gray-300"])},[e("div",E0,[h(o(de),{name:"gift",class:"w-4 h-4"}),e("span",null,t(a.__("Coupons")),1)])],2)])]),e("div",z0,[B.value==="promotions"?(s(),n(ce,{key:0},[e("div",N0,[e("div",F0,[h(o(ye),{type:"text",modelValue:le.value,"onUpdate:modelValue":A[2]||(A[2]=U=>le.value=U),placeholder:a.__("Search promotions...")},{prefix:E(()=>[h(o(de),{name:"search",class:"w-4 h-4 text-gray-500"})]),_:1},8,["modelValue","placeholder"]),h(o(ye),{type:"select",modelValue:K.value,"onUpdate:modelValue":A[3]||(A[3]=U=>K.value=U),options:[{label:a.__("All Status"),value:"all"},{label:a.__("Active Only"),value:"active"},{label:a.__("Expired Only"),value:"expired"},{label:a.__("Not Started"),value:"not_started"},{label:a.__("Disabled Only"),value:"disabled"}]},null,8,["modelValue","options"])]),e("div",R0,[p.value.create?(s(),ie(o(fe),{key:0,onClick:Ve,variant:"solid",class:"w-full"},{prefix:E(()=>[h(o(de),{name:"plus-circle",class:"w-4 h-4"})]),default:E(()=>[Q(" "+t(a.__("Create New Promotion")),1)]),_:1})):(s(),n("div",U0,[e("div",H0,[A[21]||(A[21]=e("svg",{class:"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("div",q0,[e("p",W0,t(a.__("Create permission required")),1)])])])),h(o(fe),{onClick:R,variant:"outline",class:"w-full",loading:w.value},{prefix:E(()=>[h(o(de),{name:"refresh-cw",class:"w-4 h-4"})]),default:E(()=>[Q(" "+t(a.__("Refresh")),1)]),_:1},8,["loading"])]),e("div",G0,[w.value&&H.value.length===0?(s(),n("div",Q0,[e("div",Y0,[h(o(Et),{class:"w-6 h-6 mx-auto mb-2"}),e("p",J0,t(a.__("Loading...")),1)])])):Ce.value.length===0?(s(),n("div",K0,[e("div",X0,[h(o(de),{name:"inbox",class:"w-12 h-12 mx-auto"})]),e("p",Z0,t(a.__("No promotions found")),1)])):(s(),n("div",em,[(s(!0),n(ce,null,ge(Ce.value,U=>{var Ie,Le;return s(),n("button",{key:U.name,onClick:St=>je(U),class:N(["w-full text-start p-3 rounded-md transition-all",((Ie=y.value)==null?void 0:Ie.name)===U.name?"bg-blue-50 ring-2 ring-blue-500 ring-inset":"hover:bg-gray-100"])},[e("div",om,[e("div",sm,[e("div",am,[e("p",{class:N(["text-sm font-medium truncate",((Le=y.value)==null?void 0:Le.name)===U.name?"text-blue-900":"text-gray-900"])},t(U.name),3),U.source==="Pricing Rule"?(s(),ie(o(Oe),{key:0,variant:"subtle",theme:"blue",size:"sm"},{default:E(()=>[Q(t(a.__("Rule")),1)]),_:1})):U.source==="Promotional Scheme"?(s(),ie(o(Oe),{key:1,variant:"subtle",theme:"purple",size:"sm"},{default:E(()=>[Q(t(a.__("Scheme")),1)]),_:1})):I("",!0)]),e("p",lm,t(a.__("{0} items",[U.items_count||0])),1)]),h(o(Oe),{variant:"subtle",theme:Te(U.status),size:"sm"},{default:E(()=>[Q(t(U.status||a.__("Active")),1)]),_:2},1032,["theme"])]),e("div",nm,[h(o(Oe),{variant:"subtle"},{default:E(()=>[Q(t(U.apply_on),1)]),_:2},1024),e("span",rm,t(U.valid_upto?_t(U.valid_upto):a.__("No expiry")),1)])],10,tm)}),128))]))])]),e("div",im,[!y.value&&!M.value?(s(),n("div",um,[e("div",dm,[e("div",cm,[h(o(de),{name:"tag",class:"w-16 h-16 mx-auto"})]),e("h3",mm,t(a.__("Select a Promotion")),1),e("p",vm,t(a.__("Choose a promotion from the list to view and edit, or create a new one to get started")),1),p.value.create?(s(),ie(o(fe),{key:0,onClick:Ve,variant:"solid"},{prefix:E(()=>[h(o(de),{name:"plus",class:"w-4 h-4"})]),default:E(()=>[Q(" "+t(a.__("Create New Promotion")),1)]),_:1})):(s(),n("p",pm,t(a.__("You don't have permission to create promotions")),1))])])):(s(),n("div",fm,[e("div",gm,[e("div",hm,[e("div",null,[e("div",_m,[e("h3",ym,t(M.value?a.__("Create New Promotion"):a.__("Edit Promotion")),1),!M.value&&((z=y.value)==null?void 0:z.source)==="Pricing Rule"?(s(),ie(o(Oe),{key:0,variant:"subtle",theme:"blue",size:"md"},{default:E(()=>[Q(t(a.__("Pricing Rule")),1)]),_:1})):!M.value&&((pe=y.value)==null?void 0:pe.source)==="Promotional Scheme"?(s(),ie(o(Oe),{key:1,variant:"subtle",theme:"purple",size:"md"},{default:E(()=>[Q(t(a.__("Promotional Scheme")),1)]),_:1})):I("",!0)]),e("p",bm,[M.value?(s(),n("span",xm,t(a.__("Fill in the details to create a new promotional scheme")),1)):oe.value?(s(),n("span",wm,t(a.__("View pricing rule details (read-only)")),1)):(s(),n("span",km,t(a.__("Update the promotion details below")),1))])]),e("div",$m,[oe.value?(s(),n("div",Cm,[h(o(de),{name:"info",class:"w-4 h-4 text-blue-600"}),e("span",Sm,t(a.__("Read-only: Edit in ERPNext")),1)])):I("",!0),!M.value&&!oe.value&&p.value.delete?(s(),ie(o(fe),{key:1,onClick:A[4]||(A[4]=U=>Re(y.value)),variant:"ghost",theme:"red"},{prefix:E(()=>[h(o(de),{name:"trash-2",class:"w-4 h-4"})]),default:E(()=>[Q(" "+t(a.__("Delete")),1)]),_:1})):I("",!0),!M.value&&!oe.value&&p.value.write?(s(),ie(o(fe),{key:2,onClick:A[5]||(A[5]=U=>ot(y.value)),variant:"outline",theme:y.value.disable?"green":"orange"},{prefix:E(()=>[h(o(de),{name:y.value.disable?"check-circle":"x-circle",class:"w-4 h-4"},null,8,["name"])]),default:E(()=>[Q(" "+t(y.value.disable?a.__("Enable"):a.__("Disable")),1)]),_:1},8,["theme"])):I("",!0),!oe.value&&(p.value.write||p.value.delete)?(s(),n("div",Im)):I("",!0),h(o(fe),{onClick:qe,variant:"ghost"},{default:E(()=>[Q(t(oe.value?a.__("Close"):a.__("Cancel")),1)]),_:1}),!oe.value&&(M.value?p.value.create:p.value.write)?(s(),ie(o(fe),{key:4,onClick:rt,loading:w.value,variant:"solid"},{prefix:E(()=>[h(o(de),{name:M.value?"plus":"save",class:"w-4 h-4"},null,8,["name"])]),default:E(()=>[Q(" "+t(M.value?a.__("Create"):a.__("Update")),1)]),_:1},8,["loading"])):I("",!0)])]),e("div",Vm,[h(o(pt),null,{default:E(()=>[e("div",Dm,[e("div",Mm,[h(o(de),{name:"info",class:"w-4 h-4 text-blue-600"}),e("h4",Pm,t(a.__("Basic Information")),1)]),e("div",Tm,[e("div",Am,[h(o(ye),{type:"text",label:a.__("Promotion Name"),modelValue:L.value.name,"onUpdate:modelValue":A[6]||(A[6]=U=>L.value.name=U),disabled:!M.value,placeholder:a.__("e.g., Summer Sale 2025"),required:""},null,8,["label","modelValue","disabled","placeholder"])]),h(o(ye),{type:"date",label:a.__("Valid From"),modelValue:L.value.valid_from,"onUpdate:modelValue":A[7]||(A[7]=U=>L.value.valid_from=U),disabled:oe.value},null,8,["label","modelValue","disabled"]),h(o(ye),{type:"date",label:a.__("Valid Until"),modelValue:L.value.valid_upto,"onUpdate:modelValue":A[8]||(A[8]=U=>L.value.valid_upto=U),disabled:oe.value},null,8,["label","modelValue","disabled"]),h(o(ye),{type:"select",label:a.__("Apply On"),modelValue:L.value.apply_on,"onUpdate:modelValue":A[9]||(A[9]=U=>L.value.apply_on=U),disabled:!M.value||oe.value,options:[{label:a.__("Specific Items"),value:"Item Code"},{label:a.__("Item Groups"),value:"Item Group"},{label:a.__("Brands"),value:"Brand"},{label:a.__("Entire Transaction"),value:"Transaction"}],required:""},null,8,["label","modelValue","disabled","options"])])])]),_:1}),L.value.apply_on!=="Transaction"?(s(),ie(o(pt),{key:0},{default:E(()=>[e("div",jm,[e("div",Lm,[h(o(de),{name:"list",class:"w-4 h-4 text-green-600"}),e("h4",Bm,t(a.__("Select {0}",[L.value.apply_on])),1),h(o(Oe),{variant:"subtle",theme:"red",size:"sm"},{default:E(()=>[Q(t(a.__("Required")),1)]),_:1})]),L.value.apply_on==="Item Code"?(s(),n("div",Om,[e("div",null,[h(o(ye),{type:"text",modelValue:J.value,"onUpdate:modelValue":A[10]||(A[10]=U=>J.value=U),disabled:!M.value,placeholder:a.__("Search items... (min 2 characters)")},{prefix:E(()=>[h(o(de),{name:"search",class:"w-4 h-4 text-gray-500"})]),_:1},8,["modelValue","disabled","placeholder"]),e("p",Em,t(a.__("Searching from {0} cached items",[o(V).allItems.length])),1)]),be.value.length>0?(s(),n("div",zm,[e("div",Nm,[(s(!0),n(ce,null,ge(be.value,U=>(s(),n("button",{key:U.item_code,onClick:Ie=>Ke(U),class:"w-full text-start px-4 py-2 hover:bg-gray-50 transition-colors"},[e("p",Rm,t(U.item_name),1),e("p",Um,t(U.item_code),1)],8,Fm))),128))])])):I("",!0),L.value.items.length>0?(s(),n("div",Hm,[(s(!0),n(ce,null,ge(L.value.items,(U,Ie)=>(s(),ie(o(Oe),{key:Ie,variant:"subtle",theme:"blue"},{default:E(()=>[Q(t(U.item_code)+" ",1),e("button",{onClick:Le=>Xe(Ie),class:"ms-1 hover:text-blue-900"}," × ",8,qm)]),_:2},1024))),128))])):I("",!0)])):L.value.apply_on==="Item Group"?(s(),n("div",Wm,[h(o(ye),{type:"select",modelValue:ne.value,"onUpdate:modelValue":A[11]||(A[11]=U=>ne.value=U),disabled:!M.value,onChange:mt,options:[{label:a.__("-- Select Item Group --"),value:""},...me.value.map(U=>({label:U.name,value:U.name}))]},null,8,["modelValue","disabled","options"]),L.value.items.length>0?(s(),n("div",Gm,[(s(!0),n(ce,null,ge(L.value.items,(U,Ie)=>(s(),ie(o(Oe),{key:Ie,variant:"subtle",theme:"green"},{default:E(()=>[Q(t(U.item_group)+" ",1),e("button",{onClick:Le=>Xe(Ie),class:"ms-1 hover:text-green-900"}," × ",8,Qm)]),_:2},1024))),128))])):I("",!0)])):L.value.apply_on==="Brand"?(s(),n("div",Ym,[h(o(ye),{type:"select",modelValue:ae.value,"onUpdate:modelValue":A[12]||(A[12]=U=>ae.value=U),disabled:!M.value,onChange:gt,options:[{label:a.__("-- Select Brand --"),value:""},...we.value.map(U=>({label:U.name,value:U.name}))]},null,8,["modelValue","disabled","options"]),L.value.items.length>0?(s(),n("div",Jm,[(s(!0),n(ce,null,ge(L.value.items,(U,Ie)=>(s(),ie(o(Oe),{key:Ie,variant:"subtle",theme:"purple"},{default:E(()=>[Q(t(U.brand)+" ",1),e("button",{onClick:Le=>Xe(Ie),class:"ms-1 hover:text-purple-900"}," × ",8,Km)]),_:2},1024))),128))])):I("",!0)])):I("",!0)])]),_:1})):I("",!0),h(o(pt),null,{default:E(()=>[e("div",Xm,[e("div",Zm,[h(o(de),{name:"percent",class:"w-4 h-4 text-purple-600"}),e("h4",ev,t(a.__("Discount Details")),1),h(o(Oe),{variant:"subtle",theme:"red",size:"sm"},{default:E(()=>[Q(t(a.__("Required")),1)]),_:1})]),e("div",tv,[e("div",null,[e("label",ov,t(a.__("Discount Type")),1),e("div",sv,[(s(),n(ce,null,ge(he,U=>e("button",{key:U.value,onClick:Ie=>L.value.discount_type=U.value,disabled:!M.value,class:N(["p-3 border rounded-lg transition-all flex items-center justify-center gap-2",L.value.discount_type===U.value?"border-blue-600 bg-blue-50 text-blue-900":"border-gray-300 hover:border-gray-400 text-gray-700",M.value?"cursor-pointer":"opacity-50 cursor-not-allowed"])},[h(o(de),{name:U.icon,class:"w-4 h-4"},null,8,["name"]),e("span",lv,t(U.label),1)],10,av)),64))])]),e("div",nv,[L.value.discount_type!=="free_item"?(s(),ie(o(ye),{key:0,type:"number",label:L.value.discount_type==="percentage"?a.__("Discount (%)"):a.__("discount ({0})",[i.currency]),modelValue:L.value.discount_value,"onUpdate:modelValue":A[13]||(A[13]=U=>L.value.discount_value=U),placeholder:"0",disabled:oe.value,required:""},null,8,["label","modelValue","disabled"])):I("",!0),L.value.discount_type==="free_item"?(s(),n("div",rv,[e("label",iv,[Q(t(a.__("Free Item")),1),A[22]||(A[22]=e("span",{class:"text-red-500"}," *",-1))]),L.value.free_item?I("",!0):(s(),ie(o(ye),{key:0,type:"text",modelValue:te.value,"onUpdate:modelValue":A[14]||(A[14]=U=>te.value=U),placeholder:a.__("Search item... (min 2 characters)")},{prefix:E(()=>[h(o(de),{name:"search",class:"w-4 h-4 text-gray-500"})]),_:1},8,["modelValue","placeholder"])),Pe.value.length>0&&!L.value.free_item?(s(),n("div",uv,[e("div",dv,[(s(!0),n(ce,null,ge(Pe.value,U=>(s(),n("button",{key:U.item_code,onClick:Ie=>Ue(U),type:"button",class:"w-full text-start px-4 py-2 hover:bg-gray-50 transition-colors"},[e("p",mv,t(U.item_name),1),e("p",vv,t(U.item_code),1)],8,cv))),128))])])):I("",!0),L.value.free_item?(s(),n("div",pv,[h(o(Oe),{variant:"subtle",theme:"green",size:"md"},{default:E(()=>[Q(t(L.value.free_item)+" ",1),e("button",{onClick:A[15]||(A[15]=U=>L.value.free_item=""),type:"button",class:"ms-2 hover:text-green-900"}," × ")]),_:1})])):I("",!0)])):I("",!0),L.value.discount_type==="free_item"?(s(),ie(o(ye),{key:2,type:"number",label:a.__("Free Quantity"),modelValue:L.value.free_qty,"onUpdate:modelValue":A[16]||(A[16]=U=>L.value.free_qty=U),placeholder:"1",disabled:oe.value,required:""},null,8,["label","modelValue","disabled"])):I("",!0),h(o(ye),{type:"number",label:a.__("Minimum Quantity"),modelValue:L.value.min_qty,"onUpdate:modelValue":A[17]||(A[17]=U=>L.value.min_qty=U),placeholder:"0",disabled:oe.value},null,8,["label","modelValue","disabled"]),h(o(ye),{type:"number",label:a.__("Maximum Quantity"),modelValue:L.value.max_qty,"onUpdate:modelValue":A[18]||(A[18]=U=>L.value.max_qty=U),placeholder:"0",disabled:oe.value},null,8,["label","modelValue","disabled"]),h(o(ye),{type:"number",label:a.__("Minimum Amount ({0})",[i.currency]),modelValue:L.value.min_amt,"onUpdate:modelValue":A[19]||(A[19]=U=>L.value.min_amt=U),placeholder:"0",disabled:oe.value},null,8,["label","modelValue","disabled"]),h(o(ye),{type:"number",label:a.__("Maximum Amount ({0})",[i.currency]),modelValue:L.value.max_amt,"onUpdate:modelValue":A[20]||(A[20]=U=>L.value.max_amt=U),placeholder:"0",disabled:oe.value},null,8,["label","modelValue","disabled"])])])])]),_:1})])])]))])],64)):I("",!0),B.value==="coupons"?(s(),ie(I0,{key:1,company:i.company,currency:i.currency,permissions:p.value,onCouponSaved:k},null,8,["company","currency","permissions"])):I("",!0)])]),h(Ye,{name:"fade"},{default:E(()=>{var U;return[v.value?(s(),n("div",{key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[400]",onClick:ke(Ee,["self"])},[e("div",fv,[e("div",gv,[e("div",hv,[e("div",_v,[h(o(de),{name:"alert-triangle",class:"w-6 h-6 text-red-600"})])]),e("div",yv,[e("h3",bv,t(a.__("Delete Promotion")),1),h(ut,{tag:"p",class:"text-sm text-gray-600 mb-1",inner:a.__('Are you sure you want to delete <strong>"{0}"<strong>?',[(U=b.value)==null?void 0:U.name])},null,8,["inner"]),e("p",xv,t(a.__("This will also delete all associated pricing rules. This action cannot be undone.")),1)])]),e("div",wv,[h(o(fe),{onClick:Ee,variant:"ghost"},{default:E(()=>[Q(t(a.__("Cancel")),1)]),_:1}),h(o(fe),{onClick:Je,variant:"solid",theme:"red"},{prefix:E(()=>[h(o(de),{name:"trash-2",class:"w-4 h-4"})]),default:E(()=>[Q(" "+t(a.__("Delete Promotion")),1)]),_:1})])])])):I("",!0)]}),_:1})])])):I("",!0)]}),_:1}))}},$v=Fe(kv,[["__scopeId","data-v-d0f50e18"]]),Cv={class:"flex items-start gap-2.5 p-2 rounded hover:bg-gray-50 transition-colors"},Sv={class:"flex items-center h-5"},Iv=["id","checked"],Vv={class:"flex-1 min-w-0"},Dv=["for"],Mv={key:0,class:"text-xs text-gray-500 mt-0.5 leading-tight"},Ge={__name:"CheckboxField",props:{modelValue:{type:[Number,Boolean],default:0},label:{type:String,required:!0},description:{type:String,default:""}},emits:["update:modelValue"],setup(i){const l=ee(()=>`checkbox-${Math.random().toString(36).substr(2,9)}`);return(d,m)=>(s(),n("div",Cv,[e("div",Sv,[e("input",{id:l.value,type:"checkbox",checked:i.modelValue,onChange:m[0]||(m[0]=$=>d.$emit("update:modelValue",$.target.checked?1:0)),class:"w-4 h-4 text-blue-600 bg-white border-gray-300 rounded focus:ring-blue-500 focus:ring-1 cursor-pointer"},null,40,Iv)]),e("div",Vv,[e("label",{for:l.value,class:"block text-sm font-medium text-gray-900 cursor-pointer"},t(i.label),9,Dv),i.description?(s(),n("p",Mv,t(i.description),1)):I("",!0)])]))}},Pv={class:"p-2 rounded hover:bg-gray-50 transition-colors"},Tv=["for"],Av=["id","value","min","max","step"],jv={key:0,class:"text-xs text-gray-500 mt-0.5 leading-tight"},wo={__name:"NumberField",props:{modelValue:{type:Number,default:0},label:{type:String,required:!0},description:{type:String,default:""},min:{type:Number,default:void 0},max:{type:Number,default:void 0},step:{type:Number,default:1}},emits:["update:modelValue"],setup(i){const l=ee(()=>`number-${Math.random().toString(36).substr(2,9)}`);return(d,m)=>(s(),n("div",Pv,[e("label",{for:l.value,class:"block text-sm font-medium text-gray-900 mb-1"},t(i.label),9,Tv),e("input",{id:l.value,type:"number",value:i.modelValue,min:i.min,max:i.max,step:i.step,onInput:m[0]||(m[0]=$=>d.$emit("update:modelValue",parseFloat($.target.value)||0)),class:"w-full px-2.5 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent bg-white"},null,40,Av),i.description?(s(),n("p",jv,t(i.description),1)):I("",!0)]))}},Lv={class:"p-2 rounded hover:bg-gray-50 transition-colors"},Bv=["for"],Ov=["id","value"],Ev={value:""},zv=["value"],Nv={key:0,class:"text-xs text-gray-500 mt-0.5 leading-tight"},Fv={__name:"SelectField",props:{modelValue:{type:[String,Number],default:""},label:{type:String,required:!0},description:{type:String,default:""},options:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(i){const l=ee(()=>`select-${Math.random().toString(36).substr(2,9)}`);return(d,m)=>(s(),n("div",Lv,[e("label",{for:l.value,class:"block text-sm font-medium text-gray-900 mb-1"},t(i.label),9,Bv),e("select",{id:l.value,value:i.modelValue,onChange:m[0]||(m[0]=$=>d.$emit("update:modelValue",$.target.value)),class:"w-full px-2.5 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent bg-white cursor-pointer"},[e("option",Ev,t(d.__("-- Select --")),1),(s(!0),n(ce,null,ge(i.options,$=>(s(),n("option",{key:$.value,value:$.value},t($.label),9,zv))),128))],40,Ov),i.description?(s(),n("p",Nv,t(i.description),1)):I("",!0)]))}},et={warehouse:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4",shoppingCart:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z",checkCircle:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",currency:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z",location:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z M15 11a3 3 0 11-6 0 3 3 0 016 0z",clipboard:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2",tag:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z",info:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z",warning:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},ko={purple:{headerGradient:"from-purple-50 via-indigo-50 to-blue-50",iconBg:"bg-purple-100",iconColor:"text-purple-600",badgeBg:"bg-purple-100",badgeColor:"text-purple-700"},green:{headerGradient:"from-green-50 via-emerald-50 to-teal-50",iconBg:"bg-green-100",iconColor:"text-green-600",badgeBg:"bg-green-100",badgeColor:"text-green-700"}},$o={gray:{gradient:"from-gray-50 to-gray-100",border:"border-gray-200",iconColor:"text-indigo-600"},blue:{gradient:"from-blue-50 to-indigo-50",border:"border-blue-200",iconColor:"text-blue-600"},emerald:{gradient:"from-emerald-50 to-green-50",border:"border-green-200",iconColor:"text-green-600"},teal:{gradient:"from-teal-50 to-cyan-50",border:"border-teal-200",iconColor:"text-teal-600"}};function Co(i){const l=ko[i]||ko.purple;return{header:`px-6 py-4 bg-gradient-to-r ${l.headerGradient} border-b border-gray-200`,iconContainer:`p-2 ${l.iconBg} rounded-lg`,icon:`w-6 h-6 ${l.iconColor}`,badge:`flex items-center space-x-2 px-3 py-1.5 ${l.badgeBg} rounded-full`,badgeIcon:`w-4 h-4 ${l.iconColor}`,badgeText:`text-xs font-semibold ${l.badgeColor}`}}function Dt(i){const l=$o[i]||$o.gray;return{container:`bg-gradient-to-br ${l.gradient} rounded-lg p-5 border ${l.border}`,icon:`w-5 h-5 ${l.iconColor}`}}function No(){const i=Ws(),l=[];function d(K,L){const me=i.on(K,L);return l.push(me),me}function m(K,L){i.emit(K,L)}function $(K){return d("settings:changed",K)}function D(K){return d("settings:warehouse-changed",K)}function T(K){return d("settings:stock-policy-changed",K)}function S(K){return d("settings:pricing-changed",K)}function p(K){return d("settings:sales-operations-changed",K)}function x(K){return d("settings:display-changed",K)}function g(K){return d("settings:sync-configured",K)}function V(K){return d("sync:stock-updated",K)}function O(K){return d("*",K)}function w(K,L){i.detectSettingsChanges(K,L)}function M(K){i.updateSettingsSnapshot(K)}function y(K){i.emitStockSyncConfigured(K)}function v(K){i.emitStockSyncStatus(K)}function b(){return i.recentEvents}function B(K){return i.getEventsByType(K)}function H(){i.clearHistory()}function le(){l.forEach(K=>K()),l.length=0}return Qe(()=>{le()}),{on:d,emit:m,onSettingsChanged:$,onWarehouseChanged:D,onStockPolicyChanged:T,onPricingChanged:S,onSalesOperationsChanged:p,onDisplayChanged:x,onStockSyncConfigured:g,onStockSyncUpdate:V,onAny:O,detectSettingsChanges:w,updateSettingsSnapshot:M,emitStockSyncConfigured:y,emitStockSyncStatus:v,getRecentEvents:b,getEventsByType:B,clearHistory:H,unsubscribeAll:le,store:i}}const Rv={class:"fixed inset-0 flex items-center justify-center p-4 md:p-6"},Uv={class:"w-full max-w-5xl max-h-[90vh] bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col"},Hv={class:"flex items-center justify-between px-6 py-5 border-b bg-gradient-to-r from-blue-50 to-indigo-50"},qv={class:"flex items-center gap-3"},Wv={class:"text-xl font-bold text-gray-900"},Gv={class:"text-sm text-gray-600 flex items-center mt-0.5"},Qv={class:"flex items-center gap-2"},Yv={class:"flex-1 overflow-y-auto bg-gray-50"},Jv={key:0,class:"flex flex-col items-center justify-center py-16"},Kv={class:"text-sm font-medium text-gray-600"},Xv={key:1,class:"p-6 flex flex-col gap-6"},Zv={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},ep={class:"flex items-center justify-between"},tp={class:"flex items-center gap-3"},op=["d"],sp={class:"text-lg font-bold text-gray-900"},ap={class:"text-xs text-gray-600 mt-0.5"},lp=["d"],np={class:"p-6 flex flex-col gap-6"},rp={class:"flex items-center gap-2 mb-4"},ip=["d"],up={class:"text-sm font-semibold text-gray-900"},dp={key:0,class:"flex items-center p-4 bg-yellow-50 border border-yellow-200 rounded-lg"},cp={class:"w-5 h-5 text-yellow-600 me-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},mp=["d"],vp={class:"text-sm text-yellow-800 font-medium"},pp={class:"flex items-center gap-2 mb-4"},fp=["d"],gp={class:"text-sm font-semibold text-gray-900"},hp={class:"flex flex-col gap-3"},_p={class:"mt-3 p-3 bg-blue-100 rounded-md"},yp={class:"flex items-start gap-2"},bp={class:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},xp=["d"],wp={class:"flex items-center gap-2 mb-4"},kp={class:"text-sm font-semibold text-gray-900"},$p={key:0,class:"ms-auto flex items-center px-2.5 py-1 bg-green-100 border border-green-300 rounded-full"},Cp={class:"text-xs font-medium text-green-800"},Sp={key:1,class:"ms-auto flex items-center px-2.5 py-1 bg-gray-100 border border-gray-300 rounded-full"},Ip={class:"text-xs font-medium text-gray-600"},Vp={class:"flex flex-col gap-4"},Dp={key:0,class:"ps-6 flex flex-col gap-3 border-s-2 border-blue-200"},Mp={class:"p-3 bg-blue-50 border border-blue-200 rounded-lg"},Pp={class:"flex items-start gap-2"},Tp={class:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ap=["d"],jp={class:"text-xs text-blue-800 flex flex-col gap-1"},Lp={class:"p-3 bg-gray-50 border border-gray-200 rounded-lg"},Bp={class:"flex items-start gap-2"},Op={class:"text-xs text-gray-700"},Ep={class:"font-medium mb-1"},zp={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},Np={class:"flex items-center justify-between"},Fp={class:"flex items-center gap-3"},Rp=["d"],Up={class:"text-lg font-bold text-gray-900"},Hp={class:"text-xs text-gray-600 mt-0.5"},qp=["d"],Wp={class:"p-6 flex flex-col gap-6"},Gp={class:"flex items-center gap-2 mb-4"},Qp=["d"],Yp={class:"text-sm font-semibold text-gray-900"},Jp={class:"flex flex-col gap-3"},Kp={class:"flex items-center gap-2 mb-4"},Xp=["d"],Zp={class:"text-sm font-semibold text-gray-900"},ef={class:"flex flex-col gap-3"},tf={key:2,class:"flex flex-col items-center justify-center py-16 text-center"},of={class:"text-gray-600 font-medium"},sf={class:"text-gray-500 text-sm mt-1"},af={__name:"POSSettings",props:{modelValue:Boolean,posProfile:String,currentWarehouse:String},emits:["update:modelValue","warehouse-changed"],setup(i,{emit:l}){const d=Ct.create("POSSettings"),{detectSettingsChanges:m,updateSettingsSnapshot:$,emitStockSyncConfigured:D}=No(),{showSuccess:T,showError:S}=ft(),p=i,x=l,g=C(p.modelValue),V=C(!0),O=C(!1),w=C([]),M=C(p.currentWarehouse||""),y=C({pos_profile:p.posProfile||"",enabled:1,max_discount_allowed:0,use_percentage_discount:0,allow_user_to_edit_additional_discount:0,allow_user_to_edit_item_discount:1,disable_rounded_total:1,allow_credit_sale:0,allow_return:0,allow_write_off_change:0,allow_partial_payment:0,silent_print:0,allow_negative_stock:0,tax_inclusive:0}),v=C(!1),b=C(60),B=C({enabled:!1,warehouse:null,itemCount:0,intervalMs:6e4,lastSync:null,running:!1}),H=ee(()=>w.value.length===0?[]:w.value.map(r=>({label:r.warehouse_name||r.name,value:r.name}))),le=ee(()=>Co("purple")),K=ee(()=>Co("green")),L=ee(()=>Dt("gray")),me=ee(()=>Dt("blue")),we=ee(()=>Dt("indigo")),J=ee(()=>Dt("emerald")),te=ee(()=>Dt("teal"));Ae({url:"pos_next.api.pos_profile.get_warehouses",makeParams(){return{pos_profile:p.posProfile}},auto:!1,onSuccess(r){const _=(r==null?void 0:r.message)||r||[];w.value=_},onError(r){w.value=[]}});const ne=C(null),ae=Ae({url:"pos_next.pos_next.doctype.pos_settings.pos_settings.get_pos_settings",makeParams(){return{pos_profile:p.posProfile}},onSuccess(r){r&&(Object.assign(y.value,r),y.value.pos_profile=p.posProfile,ne.value=r.allow_negative_stock,$(y.value)),V.value=!1},onError(r){V.value=!1,S(__("Failed to load settings"))}});xe(()=>p.modelValue,r=>{g.value=r,r&&Ce()}),xe(g,r=>{x("update:modelValue",r)}),xe(()=>p.currentWarehouse,r=>{r&&(M.value=r)},{immediate:!0});const he=C(null);xe(()=>y.value.tax_inclusive,(r,_)=>{if(he.value===null&&_!==void 0&&(he.value=_),he.value!==null&&r!==he.value){const F=r?"inclusive":"exclusive";d.info(`Tax mode toggled to: ${F}`)}});function oe(){g.value=!1}function Ce(){return Z(this,null,function*(){if(p.posProfile){V.value=!0,y.value.pos_profile=p.posProfile,M.value=p.currentWarehouse||"";try{const r=yield ct("pos_next.api.pos_profile.get_warehouses",{pos_profile:p.posProfile});w.value=(r==null?void 0:r.message)||r||[],ae.reload()}catch(r){d.error("Error loading warehouses:",r),w.value=[],ae.reload()}}})}function be(){return Z(this,null,function*(){if(!p.posProfile){S(__("POS Profile not found"));return}O.value=!0;const r=p.currentWarehouse,_=M.value!==r,F=ne.value!==y.value.allow_negative_stock,j=he.value!==null&&he.value!==y.value.tax_inclusive,ve=lt(We({},y.value),{warehouse:r});try{const $e=yield ct("pos_next.pos_next.doctype.pos_settings.pos_settings.update_pos_settings",{pos_profile:p.posProfile,settings:y.value});if($e&&(Object.assign(y.value,$e),y.value.pos_profile=p.posProfile,ne.value=$e.allow_negative_stock,he.value=$e.tax_inclusive),_&&M.value){const f=yield ct("pos_next.api.pos_profile.update_warehouse",{pos_profile:p.posProfile,warehouse:M.value});f&&f.success&&(y.value.warehouse=M.value,x("warehouse-changed",M.value))}if(m(y.value,ve),F){d.info("Stock policy changed, reloading page for consistency..."),window.location.reload();return}let ue=__("Settings saved successfully");_&&j?ue=__("Settings saved, warehouse updated, and tax mode changed. Cart will be recalculated."):_?ue=__("Settings saved and warehouse updated. Reloading stock..."):j&&(ue=y.value.tax_inclusive?__('Settings saved. Tax mode is now "inclusive". Cart will be recalculated.'):__('Settings saved. Tax mode is now "exclusive". Cart will be recalculated.')),T(ue)}catch($e){d.error("Error saving settings:",$e),S($e.message||__("Failed to save settings"))}finally{O.value=!1}})}function Pe(){var r,_;try{const F=localStorage.getItem("pos_stock_sync_settings");if(F){const j=JSON.parse(F);v.value=(r=j.enabled)!=null?r:!1,b.value=(_=j.intervalSeconds)!=null?_:60}}catch(F){d.error("Failed to load stock sync settings:",F)}}function W(){try{localStorage.setItem("pos_stock_sync_settings",JSON.stringify({enabled:v.value,intervalSeconds:b.value}))}catch(r){d.error("Failed to save stock sync settings:",r)}}function se(){return Z(this,null,function*(){try{const r=yield He.getStockSyncStatus();B.value=r}catch(r){d.error("Failed to get stock sync status:",r)}})}function _e(){return Z(this,null,function*(){try{const r=b.value*1e3;v.value?(yield He.configureStockSync({intervalMs:r}),yield He.startStockSync()):yield He.stopStockSync(),yield se(),W(),D({enabled:v.value,intervalMs:r})}catch(r){d.error("Failed to apply stock sync config:",r)}})}function De(r){if(!r)return __("Never");const F=Date.now()-r;return F<6e4?__("{0}s ago",[Math.floor(F/1e3)]):F<36e5?__("{0}m ago",[Math.floor(F/6e4)]):new Date(r).toLocaleTimeString()}return xe(v,()=>{_e()}),xe(b,()=>{v.value&&_e()}),ze(()=>Z(this,null,function*(){Pe(),yield se();const r=setInterval(()=>{se()},5e3);Qe(()=>{clearInterval(r)})})),(r,_)=>(s(),ie(Ye,{name:"fade"},{default:E(()=>[g.value?(s(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-[300]",onClick:ke(oe,["self"])},[e("div",Rv,[e("div",Uv,[e("div",Hv,[e("div",qv,[_[16]||(_[16]=e("div",{class:"p-2 bg-blue-100 rounded-lg"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})])],-1)),e("div",null,[e("h2",Wv,t(r.__("POS Settings")),1),e("p",Gv,[_[15]||(_[15]=e("svg",{class:"w-4 h-4 me-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1)),Q(" "+t(y.value.pos_profile||i.posProfile),1)])])]),e("div",Qv,[h(o(fe),{onClick:Ce,loading:V.value,variant:"ghost",size:"sm"},{prefix:E(()=>_[17]||(_[17]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])),default:E(()=>[Q(" "+t(r.__("Refresh")),1)]),_:1},8,["loading"]),h(o(fe),{onClick:be,loading:O.value,variant:"solid",theme:"blue"},{prefix:E(()=>_[18]||(_[18]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])),default:E(()=>[Q(" "+t(r.__("Save Changes")),1)]),_:1},8,["loading"]),e("button",{onClick:oe,class:"p-2 hover:bg-white/50 rounded-lg transition-colors"},_[19]||(_[19]=[e("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])]),e("div",Yv,[V.value?(s(),n("div",Jv,[_[20]||(_[20]=e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-3 border-blue-500 mb-4"},null,-1)),e("p",Kv,t(r.__("Loading settings...")),1)])):y.value.pos_profile||i.posProfile?(s(),n("div",Xv,[e("div",Zv,[e("div",{class:N(le.value.header)},[e("div",ep,[e("div",tp,[e("div",{class:N(le.value.iconContainer)},[(s(),n("svg",{class:N(le.value.icon),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:o(et).warehouse},null,8,op)],2))],2),e("div",null,[e("h3",sp,t(r.__("Stock Management")),1),e("p",ap,t(r.__("Configure warehouse and inventory settings")),1)])]),e("div",{class:N(le.value.badge)},[(s(),n("svg",{class:N(le.value.badgeIcon),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:o(et).checkCircle},null,8,lp)],2)),e("span",{class:N(le.value.badgeText)},t(r.__("Stock Controls")),3)],2)])],2),e("div",np,[e("div",{class:N(L.value.container)},[e("div",rp,[(s(),n("svg",{class:N(L.value.icon),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:o(et).location},null,8,ip)],2)),e("h4",up,t(r.__("Warehouse Selection")),1)]),H.value.length===0?(s(),n("div",dp,[(s(),n("svg",cp,[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:o(et).warning},null,8,mp)])),e("p",vp,t(r.__("Loading warehouses...")),1)])):(s(),ie(Fv,{key:1,modelValue:M.value,"onUpdate:modelValue":_[0]||(_[0]=F=>M.value=F),label:r.__("Active Warehouse"),options:H.value,description:r.__("All stock operations will use this warehouse. Stock quantities will refresh after saving.")},null,8,["modelValue","label","options","description"]))],2),e("div",{class:N(me.value.container)},[e("div",pp,[(s(),n("svg",{class:N(me.value.icon),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:o(et).clipboard},null,8,fp)],2)),e("h4",gp,t(r.__("Stock Validation Policy")),1)]),e("div",hp,[h(Ge,{modelValue:y.value.allow_negative_stock,"onUpdate:modelValue":_[1]||(_[1]=F=>y.value.allow_negative_stock=F),label:r.__("Allow Negative Stock"),description:r.__("Enable selling items even when stock reaches zero or below. Integrates with ERPNext stock settings.")},null,8,["modelValue","label","description"]),e("div",_p,[e("div",yp,[(s(),n("svg",bp,[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:o(et).info},null,8,xp)])),h(ut,{tag:"p",class:"text-xs text-blue-800 leading-relaxed",inner:r.__("<strong>Note:<strong> When enabled, the system will allow sales even when stock quantity is zero or negative. This is useful for handling stock sync delays or backorders. All transactions are tracked in the stock ledger.")},null,8,["inner"])])])])],2),e("div",{class:N(we.value.container)},[e("div",wp,[(s(),n("svg",{class:N(we.value.icon),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_[21]||(_[21]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]),2)),e("h4",kp,t(r.__("Background Stock Sync")),1),B.value.enabled?(s(),n("div",$p,[_[22]||(_[22]=e("div",{class:"w-2 h-2 bg-green-500 rounded-full animate-pulse me-2"},null,-1)),e("span",Cp,t(r.__("Active")),1)])):(s(),n("div",Sp,[_[23]||(_[23]=e("div",{class:"w-2 h-2 bg-gray-400 rounded-full me-2"},null,-1)),e("span",Ip,t(r.__("Inactive")),1)]))]),e("div",Vp,[h(Ge,{modelValue:v.value,"onUpdate:modelValue":_[2]||(_[2]=F=>v.value=F),label:r.__("Enable Automatic Stock Sync"),description:r.__("Periodically sync stock quantities from server in the background (runs in Web Worker)")},null,8,["modelValue","label","description"]),v.value?(s(),n("div",Dp,[h(wo,{modelValue:b.value,"onUpdate:modelValue":_[3]||(_[3]=F=>b.value=F),label:r.__("Sync Interval (seconds)"),description:r.__("How often to check server for stock updates (minimum 10 seconds)"),min:10,max:300,step:10},null,8,["modelValue","label","description"]),e("div",Mp,[e("div",Pp,[(s(),n("svg",Tp,[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:o(et).info},null,8,Ap)])),e("div",jp,[h(ut,{tag:"p",inner:B.value.enabled?r.__("<strong>Status:<strong> Running"):r.__("<strong>Status:<strong> Stopped")},null,8,["inner"]),h(ut,{tag:"p",inner:r.__("<strong>Items Tracked:<strong> {0}",[B.value.itemCount||0])},null,8,["inner"]),h(ut,{tag:"p",inner:B.value.warehouse?r.__("<strong>Warehouse:<strong> {0}",[B.value.warehouse]):r.__("Warehouse not set")},null,8,["inner"]),h(ut,{tag:"p",inner:B.value.lastSync?r.__("<strong>Last Sync:<strong> {0}",[De(B.value.lastSync)]):r.__("<strong>Last Sync:<strong> Never")},null,8,["inner"])])])]),e("div",Lp,[e("div",Bp,[_[24]||(_[24]=e("svg",{class:"w-4 h-4 text-gray-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)),e("div",Op,[e("p",Ep,t(r.__("Network Usage:")),1),e("p",null,t(r.__("~15 KB per sync cycle")),1),e("p",null,t(r.__("~{0} MB per hour",[Math.round(3600/b.value*15/1024)])),1)])])])])):I("",!0)])],2)])]),e("div",zp,[e("div",{class:N(K.value.header)},[e("div",Np,[e("div",Fp,[e("div",{class:N(K.value.iconContainer)},[(s(),n("svg",{class:N(K.value.icon),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:o(et).shoppingCart},null,8,Rp)],2))],2),e("div",null,[e("h3",Up,t(r.__("Sales Management")),1),e("p",Hp,t(r.__("Configure pricing, discounts, and sales operations")),1)])]),e("div",{class:N(K.value.badge)},[(s(),n("svg",{class:N(K.value.badgeIcon),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:o(et).currency},null,8,qp)],2)),e("span",{class:N(K.value.badgeText)},t(r.__("Sales Controls")),3)],2)])],2),e("div",Wp,[e("div",{class:N(J.value.container)},[e("div",Gp,[(s(),n("svg",{class:N(J.value.icon),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:o(et).tag},null,8,Qp)],2)),e("h4",Yp,t(r.__("Pricing & Discounts")),1)]),e("div",Jp,[h(Ge,{modelValue:y.value.tax_inclusive,"onUpdate:modelValue":_[4]||(_[4]=F=>y.value.tax_inclusive=F),label:r.__("Tax Inclusive"),description:r.__("When enabled, displayed prices include tax. When disabled, tax is calculated separately. Changes apply immediately to your cart when you save.")},null,8,["modelValue","label","description"]),h(wo,{modelValue:y.value.max_discount_allowed,"onUpdate:modelValue":_[5]||(_[5]=F=>y.value.max_discount_allowed=F),label:r.__("Max Discount (%)"),description:r.__("Maximum discount per item"),min:0,max:100},null,8,["modelValue","label","description"]),h(Ge,{modelValue:y.value.use_percentage_discount,"onUpdate:modelValue":_[6]||(_[6]=F=>y.value.use_percentage_discount=F),label:r.__("Use Percentage Discount"),description:r.__("Show discounts as percentages")},null,8,["modelValue","label","description"]),h(Ge,{modelValue:y.value.allow_user_to_edit_additional_discount,"onUpdate:modelValue":_[7]||(_[7]=F=>y.value.allow_user_to_edit_additional_discount=F),label:r.__("Allow Additional Discount"),description:r.__("Enable invoice-level discount")},null,8,["modelValue","label","description"]),h(Ge,{modelValue:y.value.allow_user_to_edit_item_discount,"onUpdate:modelValue":_[8]||(_[8]=F=>y.value.allow_user_to_edit_item_discount=F),label:r.__("Allow Item Discount"),description:r.__("Enable item-level discount in edit dialog")},null,8,["modelValue","label","description"]),h(Ge,{modelValue:y.value.disable_rounded_total,"onUpdate:modelValue":_[9]||(_[9]=F=>y.value.disable_rounded_total=F),label:r.__("Disable Rounded Total"),description:r.__("Show exact totals without rounding")},null,8,["modelValue","label","description"])])],2),e("div",{class:N(te.value.container)},[e("div",Kp,[(s(),n("svg",{class:N(te.value.icon),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:o(et).checkCircle},null,8,Xp)],2)),e("h4",Zp,t(r.__("Sales Operations")),1)]),e("div",ef,[h(Ge,{modelValue:y.value.allow_credit_sale,"onUpdate:modelValue":_[10]||(_[10]=F=>y.value.allow_credit_sale=F),label:r.__("Allow Credit Sale"),description:r.__("Enable sales on credit")},null,8,["modelValue","label","description"]),h(Ge,{modelValue:y.value.allow_return,"onUpdate:modelValue":_[11]||(_[11]=F=>y.value.allow_return=F),label:r.__("Allow Return"),description:r.__("Enable product returns")},null,8,["modelValue","label","description"]),h(Ge,{modelValue:y.value.allow_write_off_change,"onUpdate:modelValue":_[12]||(_[12]=F=>y.value.allow_write_off_change=F),label:r.__("Allow Write Off Change"),description:r.__("Write off small change amounts")},null,8,["modelValue","label","description"]),h(Ge,{modelValue:y.value.allow_partial_payment,"onUpdate:modelValue":_[13]||(_[13]=F=>y.value.allow_partial_payment=F),label:r.__("Allow Partial Payment"),description:r.__("Enable partial payment for invoices")},null,8,["modelValue","label","description"]),h(Ge,{modelValue:y.value.silent_print,"onUpdate:modelValue":_[14]||(_[14]=F=>y.value.silent_print=F),label:r.__("Silent Print"),description:r.__("Print without confirmation")},null,8,["modelValue","label","description"])])],2)])])])):(s(),n("div",tf,[_[25]||(_[25]=e("svg",{class:"w-16 h-16 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),e("p",of,t(r.__("No POS Profile Selected")),1),e("p",sf,t(r.__("Please select a POS Profile to configure settings")),1)]))])])])])):I("",!0)]),_:1}))}},lf=Fe(af,[["__scopeId","data-v-fa2561b0"]]),nf={class:"select-input-wrapper"},rf={key:0,class:"input-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},uf=["d"],df=["placeholder"],cf={class:"input-actions"},mf={key:0,class:"dropdown-menu"},vf={key:0,class:"dropdown-loading"},pf={key:1,class:"dropdown-empty"},ff={key:2,class:"dropdown-list"},gf=["onClick"],hf={key:0,class:"item-icon check-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_f={class:"item-content"},yf=["innerHTML"],bf={key:0,class:"item-subtitle"},xf={__name:"AutocompleteSelect",props:{modelValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},placeholder:{type:String,default:__("Search...")},icon:{type:String,default:""},required:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},searchable:{type:Boolean,default:!0},minSearchLength:{type:Number,default:0}},emits:["update:modelValue","search"],setup(i,{emit:l}){const d=i,m=l,$=C(null),D=C(null),T=C(""),S=C(!1),p=C(-1),x=C(50),g=ee(()=>d.options.find(J=>J.value===d.modelValue));xe(()=>d.modelValue,J=>{J&&g.value?T.value=g.value.label:J||(T.value="")},{immediate:!0});const V=ee(()=>{var te;if(!T.value||T.value===((te=g.value)==null?void 0:te.label))return d.options;const J=T.value.toLowerCase();return d.options.filter(ne=>{var oe;const ae=ne.label.toLowerCase(),he=((oe=ne.subtitle)==null?void 0:oe.toLowerCase())||"";return ae.includes(J)||he.includes(J)})}),O=ee(()=>V.value.slice(0,x.value)),w=ee(()=>V.value.length>x.value);function M(){var J;S.value=!0,p.value=-1,T.value&&((J=D.value)==null||J.select())}function y(){S.value=!0,p.value=-1,x.value=50,d.searchable&&T.value.length>=d.minSearchLength&&m("search",T.value)}function v(J){if(!S.value&&(J.key==="ArrowDown"||J.key==="ArrowUp")){S.value=!0,J.preventDefault();return}switch(J.key){case"ArrowDown":J.preventDefault(),p.value=Math.min(p.value+1,O.value.length-1),L();break;case"ArrowUp":J.preventDefault(),p.value=Math.max(p.value-1,-1),L();break;case"Enter":J.preventDefault(),p.value>=0&&B(O.value[p.value]);break;case"Escape":J.preventDefault(),le();break;case"Tab":le();break}}function b(){var J;S.value=!S.value,S.value&&((J=D.value)==null||J.focus())}function B(J){var te;m("update:modelValue",J.value),T.value=J.label,le(),(te=D.value)==null||te.blur()}function H(){var J;m("update:modelValue",""),T.value="",S.value=!1,(J=D.value)==null||J.focus()}function le(){S.value=!1,p.value=-1,g.value&&(T.value=g.value.label)}function K(){x.value+=50}function L(){var ne,ae;const J=(ne=$.value)==null?void 0:ne.querySelector(".dropdown-list"),te=J==null?void 0:J.querySelectorAll(".dropdown-item:not(.clear-item):not(.load-more)");te&&p.value>=0&&((ae=te[p.value])==null||ae.scrollIntoView({block:"nearest",behavior:"smooth"}))}function me(J){var ae;if(!T.value||T.value===((ae=g.value)==null?void 0:ae.label))return J;const te=T.value,ne=new RegExp(`(${te})`,"gi");return J.replace(ne,"<mark>$1</mark>")}function we(J){$.value&&!$.value.contains(J.target)&&le()}return ze(()=>{document.addEventListener("click",we)}),Qe(()=>{document.removeEventListener("click",we)}),(J,te)=>(s(),n("div",{class:"autocomplete-select",ref_key:"containerRef",ref:$},[e("div",nf,[i.icon?(s(),n("svg",rf,[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:i.icon},null,8,uf)])):I("",!0),dt(e("input",{ref_key:"inputRef",ref:D,"onUpdate:modelValue":te[0]||(te[0]=ne=>T.value=ne),type:"text",class:N(["select-input",{"has-icon":i.icon,"has-value":i.modelValue}]),placeholder:i.placeholder,onFocus:M,onInput:y,onKeydown:v},null,42,df),[[vt,T.value]]),e("div",cf,[i.modelValue?(s(),n("button",{key:0,onClick:H,class:"clear-btn",type:"button"},te[1]||(te[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):I("",!0),e("button",{onClick:b,class:"dropdown-toggle",type:"button"},[(s(),n("svg",{class:N(["w-4 h-4",{"rotate-180":S.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},te[2]||(te[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])])]),h(Ye,{name:"dropdown"},{default:E(()=>[S.value?(s(),n("div",mf,[i.loading?(s(),n("div",vf,[te[3]||(te[3]=e("div",{class:"loading-spinner"},null,-1)),e("span",null,t(J.__("Searching...")),1)])):V.value.length===0?(s(),n("div",pf,[te[4]||(te[4]=e("svg",{class:"empty-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),e("span",null,t(T.value?J.__("No results found"):J.__("No options available")),1)])):(s(),n("div",ff,[!i.required&&i.modelValue?(s(),n("button",{key:0,onClick:H,class:"dropdown-item clear-item",type:"button"},[te[5]||(te[5]=e("svg",{class:"item-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),e("span",null,t(J.__("Clear selection")),1)])):I("",!0),(s(!0),n(ce,null,ge(O.value,(ne,ae)=>(s(),n("button",{key:ne.value,onClick:he=>B(ne),class:N(["dropdown-item",{active:ne.value===i.modelValue,highlighted:ae===p.value}]),type:"button"},[ne.value===i.modelValue?(s(),n("svg",hf,te[6]||(te[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):I("",!0),e("div",_f,[e("span",{class:"item-label",innerHTML:me(ne.label)},null,8,yf),ne.subtitle?(s(),n("span",bf,t(ne.subtitle),1)):I("",!0)])],10,gf))),128)),w.value?(s(),n("button",{key:1,onClick:K,class:"dropdown-item load-more",type:"button"},[te[7]||(te[7]=e("svg",{class:"item-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)),e("span",null,t(J.__("Load more ({0} remaining)",[V.value.length-x.value])),1)])):I("",!0)]))])):I("",!0)]),_:1})],512))}},So=Fe(xf,[["__scopeId","data-v-e8ee12e1"]]),Zt=Es("invoiceFilters",()=>{const i=C(""),l=C(""),d=C(""),m=C(""),$=C(""),D=C(""),T=C(!1),S=C([]),p=C(""),x=ee(()=>{let W=0;return(i.value||l.value)&&W++,d.value&&W++,m.value&&W++,$.value&&W++,W}),g=ee(()=>x.value>0),V=ee(()=>{const W=[];return(i.value||l.value)&&W.push({type:"date",label:Ce(),value:{from:i.value,to:l.value}}),d.value&&W.push({type:"customer",label:d.value,value:d.value}),m.value&&W.push({type:"status",label:m.value,value:m.value}),$.value&&W.push({type:"product",label:$.value,value:$.value}),W});function O(){const W=new Date;i.value=oe(W),l.value=oe(W)}function w(){const W=new Date;W.setDate(W.getDate()-1),i.value=oe(W),l.value=oe(W)}function M(){const W=new Date,se=new Date(W);se.setDate(W.getDate()-W.getDay()),i.value=oe(se),l.value=oe(W)}function y(){const W=new Date,se=new Date(W.getFullYear(),W.getMonth(),1);i.value=oe(se),l.value=oe(W)}function v(){const W=new Date,se=new Date(W);se.setDate(W.getDate()-7),i.value=oe(se),l.value=oe(W)}function b(){const W=new Date,se=new Date(W);se.setDate(W.getDate()-30),i.value=oe(se),l.value=oe(W)}function B(W,se){i.value=W,l.value=se}function H(){i.value="",l.value=""}function le(){d.value=""}function K(){m.value=""}function L(){$.value=""}function me(){D.value=""}function we(){i.value="",l.value="",d.value="",m.value="",$.value="",D.value=""}function J(W){switch(W){case"date":H();break;case"customer":le();break;case"status":K();break;case"product":L();break}}function te(W){const se={name:W,dateFrom:i.value,dateTo:l.value,customer:d.value,status:m.value,product:$.value,createdAt:new Date().toISOString()},_e=S.value.findIndex(De=>De.name===W);_e>=0?S.value[_e]=se:S.value.push(se),p.value=W,localStorage.setItem("pos_invoice_filters",JSON.stringify(S.value))}function ne(W){const se=S.value.find(_e=>_e.name===W);se&&(i.value=se.dateFrom,l.value=se.dateTo,d.value=se.customer,m.value=se.status,$.value=se.product,p.value=W)}function ae(W){S.value=S.value.filter(se=>se.name!==W),p.value===W&&(p.value=""),localStorage.setItem("pos_invoice_filters",JSON.stringify(S.value))}function he(){try{const W=localStorage.getItem("pos_invoice_filters");W&&(S.value=JSON.parse(W))}catch(W){console.error("Failed to load saved filters:",W)}}function oe(W){const se=W.getFullYear(),_e=String(W.getMonth()+1).padStart(2,"0"),De=String(W.getDate()).padStart(2,"0");return`${se}-${_e}-${De}`}function Ce(){return i.value&&l.value?i.value===l.value?be(i.value):`${be(i.value)} - ${be(l.value)}`:i.value?__("From {0}",[be(i.value)]):l.value?__("Until {0}",[be(l.value)]):""}function be(W){return W?new Date(W).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}function Pe(){T.value=!T.value}return{dateFrom:i,dateTo:l,customer:d,status:m,product:$,searchTerm:D,showFilters:T,savedFilters:S,currentFilterName:p,activeFiltersCount:x,hasActiveFilters:g,filterSummary:V,setToday:O,setYesterday:w,setThisWeek:M,setThisMonth:y,setLast7Days:v,setLast30Days:b,setDateRange:B,clearDateFilter:H,clearCustomerFilter:le,clearStatusFilter:K,clearProductFilter:L,clearSearchTerm:me,clearAllFilters:we,clearFilter:J,saveCurrentFilters:te,loadFilterPreset:ne,deleteFilterPreset:ae,loadSavedFiltersFromStorage:he,toggleFilters:Pe,formatDateRangeLabel:Ce,formatDateDisplay:be}}),wf={class:"filters-simple"},kf={class:"search-section"},$f={class:"search-bar"},Cf=["placeholder"],Sf={class:"quick-filters"},If=["onClick"],Vf=["onClick"],Df={key:0,class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Mf={key:1,class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pf={key:2,class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Tf={key:3,class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Af={key:0,class:"count-badge"},jf={key:0,class:"active-summary"},Lf={class:"summary-content"},Bf={class:"active-pills"},Of=["onClick"],Ef={key:0,class:"advanced-panel"},zf={class:"filter-row"},Nf={class:"filter-field"},Ff={class:"field-label"},Rf={class:"filter-field"},Uf={class:"field-label"},Hf={class:"filter-row"},qf={class:"filter-field"},Wf={class:"field-label"},Gf={class:"filter-field"},Qf={class:"field-label"},Yf={key:0,class:"save-row"},Jf=["placeholder"],Kf=["disabled"],Xf={key:1,class:"saved-filters"},Zf={class:"saved-header"},e1={class:"saved-list"},t1=["onClick"],o1=["onClick"],s1={__name:"InvoiceFilters",props:{uniqueCustomers:{type:Array,default:()=>[]},uniqueProducts:{type:Array,default:()=>[]},filterStats:{type:Object,default:null}},setup(i){const l=i,d=Zt(),m=C(!1),$=C(""),D=[{label:__("Today"),value:"today",action:()=>d.setToday()},{label:__("Yesterday"),value:"yesterday",action:()=>d.setYesterday()},{label:__("This Week"),value:"week",action:()=>d.setThisWeek()},{label:__("This Month"),value:"month",action:()=>d.setThisMonth()}],T=[{label:__("Paid"),value:"Paid"},{label:__("Unpaid"),value:"Unpaid"},{label:__("Partial"),value:"Partly Paid"},{label:__("Overdue"),value:"Overdue"}],S=ee(()=>!!(d.customer||d.product||d.dateFrom&&d.dateTo)),p=ee(()=>{let y=0;return d.customer&&y++,d.product&&y++,d.dateFrom&&d.dateTo&&y++,y});function x(y){d.status===y?d.status="":d.status=y}function g(y){const v=new Date;v.setHours(0,0,0,0);let b,B;switch(y){case"today":b=B=V(v);break;case"yesterday":const H=new Date(v);H.setDate(H.getDate()-1),b=B=V(H);break;case"week":const le=new Date(v);le.setDate(v.getDate()-v.getDay()),b=V(le),B=V(v);break;case"month":const K=new Date(v.getFullYear(),v.getMonth(),1);b=V(K),B=V(v);break;default:return!1}return d.dateFrom===b&&d.dateTo===B}function V(y){const v=y.getFullYear(),b=String(y.getMonth()+1).padStart(2,"0"),B=String(y.getDate()).padStart(2,"0");return`${v}-${b}-${B}`}function O(){$.value&&d.hasActiveFilters&&(d.saveCurrentFilters($.value),$.value="",m.value=!1)}function w(y){d.loadFilterPreset(y),m.value=!1}function M(y){confirm(__('Delete "{0}"?',[y]))&&d.deleteFilterPreset(y)}return(y,v)=>(s(),n("div",wf,[e("div",kf,[e("div",$f,[v[10]||(v[10]=e("svg",{class:"search-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),dt(e("input",{"onUpdate:modelValue":v[0]||(v[0]=b=>o(d).searchTerm=b),type:"text",class:"search-input",placeholder:y.__("Search invoices...")},null,8,Cf),[[vt,o(d).searchTerm]]),o(d).searchTerm?(s(),n("button",{key:0,onClick:v[1]||(v[1]=b=>o(d).searchTerm=""),class:"clear-search"},v[9]||(v[9]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):I("",!0)]),e("div",Sf,[(s(),n(ce,null,ge(D,b=>e("button",{key:b.value,onClick:B=>b.action(),class:N(["filter-chip",{active:g(b.value)}])},[v[11]||(v[11]=e("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),Q(" "+t(b.label),1)],10,If)),64)),(s(),n(ce,null,ge(T,b=>e("button",{key:b.value,onClick:B=>x(b.value),class:N(["filter-chip",{active:o(d).status===b.value}])},[b.value==="Paid"?(s(),n("svg",Df,v[12]||(v[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))):b.value==="Unpaid"?(s(),n("svg",Mf,v[13]||(v[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))):b.value==="Partly Paid"?(s(),n("svg",Pf,v[14]||(v[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))):b.value==="Overdue"?(s(),n("svg",Tf,v[15]||(v[15]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"},null,-1)]))):I("",!0),Q(" "+t(b.label),1)],10,Vf)),64)),e("button",{onClick:v[2]||(v[2]=b=>m.value=!m.value),class:N(["filter-chip","more-btn",{active:m.value||S.value}])},[v[16]||(v[16]=e("svg",{class:"chip-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1)),Q(" "+t(y.__("More"))+" ",1),S.value?(s(),n("span",Af,t(p.value),1)):I("",!0)],2)])]),h(Ye,{name:"fade"},{default:E(()=>{var b,B;return[o(d).hasActiveFilters?(s(),n("div",jf,[e("div",Lf,[h(ut,{class:"summary-text",inner:y.__("<strong>{0}</strong> of <strong>{1}</strong> invoice(s)",[((b=i.filterStats)==null?void 0:b.filtered)||0,((B=i.filterStats)==null?void 0:B.total)||0])},null,8,["inner"]),e("div",Bf,[(s(!0),n(ce,null,ge(o(d).filterSummary,H=>(s(),n("button",{key:H.type,onClick:le=>o(d).clearFilter(H.type),class:"active-pill"},[Q(t(H.label)+" ",1),v[17]||(v[17]=e("svg",{class:"w-3 h-3 ms-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1))],8,Of))),128))])]),e("button",{onClick:v[3]||(v[3]=H=>o(d).clearAllFilters()),class:"clear-all"},t(y.__("Clear all")),1)])):I("",!0)]}),_:1}),h(Ye,{name:"expand"},{default:E(()=>[m.value?(s(),n("div",Ef,[e("div",zf,[e("div",Nf,[e("label",Ff,[v[18]||(v[18]=e("svg",{class:"label-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),Q(" "+t(y.__("Customer")),1)]),h(So,{modelValue:o(d).customer,"onUpdate:modelValue":v[4]||(v[4]=b=>o(d).customer=b),options:l.uniqueCustomers,placeholder:y.__("Search customers..."),icon:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,8,["modelValue","options","placeholder"])]),e("div",Rf,[e("label",Uf,[v[19]||(v[19]=e("svg",{class:"label-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1)),Q(" "+t(y.__("Product")),1)]),h(So,{modelValue:o(d).product,"onUpdate:modelValue":v[5]||(v[5]=b=>o(d).product=b),options:l.uniqueProducts,placeholder:y.__("Search products..."),icon:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"},null,8,["modelValue","options","placeholder"])])]),e("div",Hf,[e("div",qf,[e("label",Wf,[v[20]||(v[20]=e("svg",{class:"label-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),Q(" "+t(y.__("From Date")),1)]),dt(e("input",{"onUpdate:modelValue":v[6]||(v[6]=b=>o(d).dateFrom=b),type:"date",class:"field-input"},null,512),[[vt,o(d).dateFrom]])]),e("div",Gf,[e("label",Qf,[v[21]||(v[21]=e("svg",{class:"label-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),Q(" "+t(y.__("To Date")),1)]),dt(e("input",{"onUpdate:modelValue":v[7]||(v[7]=b=>o(d).dateTo=b),type:"date",class:"field-input"},null,512),[[vt,o(d).dateTo]])])]),o(d).hasActiveFilters?(s(),n("div",Yf,[dt(e("input",{"onUpdate:modelValue":v[8]||(v[8]=b=>$.value=b),type:"text",class:"save-input",placeholder:y.__("Save these filters as..."),onKeyup:Jt(O,["enter"])},null,40,Jf),[[vt,$.value]]),e("button",{onClick:O,disabled:!$.value,class:"save-btn"},[v[22]||(v[22]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),Q(" "+t(y.__("Save")),1)],8,Kf)])):I("",!0),o(d).savedFilters.length>0?(s(),n("div",Xf,[e("div",Zf,t(y.__("Saved Filters")),1),e("div",e1,[(s(!0),n(ce,null,ge(o(d).savedFilters,b=>(s(),n("button",{key:b.name,onClick:B=>w(b.name),class:"saved-item"},[v[24]||(v[24]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})],-1)),Q(" "+t(b.name)+" ",1),e("span",{onClick:ke(B=>M(b.name),["stop"]),class:"delete-saved"},v[23]||(v[23]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,o1)],8,t1))),128))])])):I("",!0)])):I("",!0)]),_:1})]))}},a1=Fe(s1,[["__scopeId","data-v-e0eca09b"]]);function Io(i){const l=Zt(),d=ee(()=>{if(!Array.isArray(i.value))return[];let x=[...i.value];if(l.searchTerm){const g=l.searchTerm.toLowerCase();x=x.filter(V=>{var O,w,M;return((O=V.name)==null?void 0:O.toLowerCase().includes(g))||((w=V.customer_name)==null?void 0:w.toLowerCase().includes(g))||((M=V.customer)==null?void 0:M.toLowerCase().includes(g))})}if(l.dateFrom){const g=new Date(l.dateFrom);g.setHours(0,0,0,0),x=x.filter(V=>{const O=new Date(V.posting_date);return O.setHours(0,0,0,0),O>=g})}if(l.dateTo){const g=new Date(l.dateTo);g.setHours(23,59,59,999),x=x.filter(V=>new Date(V.posting_date)<=g)}if(l.customer&&(x=x.filter(g=>g.customer===l.customer||g.customer_name===l.customer)),l.status&&(x=x.filter(g=>g.status===l.status)),l.product){const g=l.product.toLowerCase();x=x.filter(V=>!V.items||!Array.isArray(V.items)?!1:V.items.some(O=>{var w,M;return((w=O.item_name)==null?void 0:w.toLowerCase().includes(g))||((M=O.item_code)==null?void 0:M.toLowerCase().includes(g))}))}return x}),m=ee(()=>{if(!Array.isArray(i.value))return[];const x=new Map;return i.value.forEach(g=>{if(g.customer){const V=g.customer_name||g.customer;x.set(g.customer,V)}}),Array.from(x.entries()).map(([g,V])=>({value:g,label:V})).sort((g,V)=>g.label.localeCompare(V.label))}),$=ee(()=>{if(!Array.isArray(i.value))return[];const x=new Set;return i.value.forEach(g=>{g.status&&x.add(g.status)}),Array.from(x).sort()}),D=ee(()=>{if(!Array.isArray(i.value))return[];const x=new Map;return i.value.forEach(g=>{g.items&&Array.isArray(g.items)&&g.items.forEach(V=>{if(V.item_code){const O=V.item_name||V.item_code;x.set(V.item_code,{value:V.item_code,label:O,subtitle:V.item_code!==O?V.item_code:null})}})}),Array.from(x.values()).sort((g,V)=>g.label.localeCompare(V.label))});function T(x){const g=m.value.find(V=>V.value===x);return g?g.label:x}function S(x){var g,V,O;if(l.searchTerm){const w=l.searchTerm.toLowerCase();if(!(((g=x.name)==null?void 0:g.toLowerCase().includes(w))||((V=x.customer_name)==null?void 0:V.toLowerCase().includes(w))||((O=x.customer)==null?void 0:O.toLowerCase().includes(w))))return!1}if(l.dateFrom){const w=new Date(l.dateFrom);w.setHours(0,0,0,0);const M=new Date(x.posting_date);if(M.setHours(0,0,0,0),M<w)return!1}if(l.dateTo){const w=new Date(l.dateTo);if(w.setHours(23,59,59,999),new Date(x.posting_date)>w)return!1}if(l.customer&&x.customer!==l.customer&&x.customer_name!==l.customer||l.status&&x.status!==l.status)return!1;if(l.product){if(!x.items||!Array.isArray(x.items))return!1;const w=l.product.toLowerCase();if(!x.items.some(y=>{var v,b;return((v=y.item_name)==null?void 0:v.toLowerCase().includes(w))||((b=y.item_code)==null?void 0:b.toLowerCase().includes(w))}))return!1}return!0}const p=ee(()=>{var x,g;return{total:((x=i.value)==null?void 0:x.length)||0,filtered:d.value.length,percentage:(g=i.value)!=null&&g.length?Math.round(d.value.length/i.value.length*100):0}});return{filteredInvoices:d,uniqueCustomers:m,uniqueProducts:D,uniqueStatuses:$,filterStats:p,getCustomerName:T,matchesFilters:S,store:l}}__("Today"),__("Yesterday"),__("This Week"),__("This Month"),__("Last 7 Days"),__("Last 30 Days");__("All Status"),__("Paid"),__("Unpaid"),__("Partly Paid"),__("Overdue");const l1={class:"fixed inset-0 flex items-center justify-center p-4"},n1={class:"w-full h-full max-w-[95vw] max-h-[95vh] bg-white rounded-lg shadow-2xl overflow-hidden flex flex-col"},r1={class:"flex items-center justify-between px-6 py-5 border-b bg-gradient-to-r from-indigo-50 to-purple-50"},i1={class:"flex items-center gap-3"},u1={class:"text-xl font-bold text-gray-900"},d1={class:"text-sm text-gray-600 flex items-center mt-0.5"},c1={class:"flex items-center gap-2"},m1={class:"border-b border-gray-200 bg-gray-50"},v1=["aria-label"],p1=["onClick"],f1={class:"flex items-center gap-2"},g1={class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},h1=["d"],_1={class:"flex-1 overflow-y-auto bg-gray-50"},y1={key:0,class:"flex flex-col items-center justify-center py-16"},b1={class:"text-sm font-medium text-gray-600"},x1={class:"p-6"},w1={key:0,class:"flex flex-col gap-4"},k1={class:"flex items-center gap-2 mb-4 flex-wrap gap-2"},$1={key:0,class:"bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200 rounded-lg p-4"},C1={class:"flex items-center justify-between"},S1={class:"text-sm text-orange-600 font-medium"},I1={class:"text-2xl font-bold text-gray-900 mt-1"},V1={class:"text-end"},D1={class:"text-xs text-gray-600"},M1={class:"text-sm text-gray-800 font-semibold mt-1"},P1={key:1,class:"flex flex-col items-center justify-center py-16 text-center"},T1={class:"text-gray-600 font-medium"},A1={class:"text-gray-500 text-sm mt-1"},j1={key:2,class:"flex flex-col gap-4"},L1={class:"p-4 border-b bg-gray-50"},B1={class:"flex items-start justify-between"},O1={class:"flex items-center gap-2"},E1={class:"text-lg font-bold text-gray-900"},z1={class:"flex items-center gap-4 mt-1 text-sm text-gray-600"},N1={class:"flex items-center"},F1={class:"flex items-center"},R1=["onClick"],U1={class:"p-4"},H1={class:"grid grid-cols-3 gap-4 mb-4"},q1={class:"text-center p-3 bg-blue-50 rounded-lg border border-blue-100"},W1={class:"text-xs text-gray-600 mb-1"},G1={class:"text-lg font-bold text-gray-900"},Q1={class:"text-center p-3 bg-green-50 rounded-lg border border-green-100"},Y1={class:"text-xs text-gray-600 mb-1"},J1={class:"text-lg font-bold text-green-600"},K1={class:"text-center p-3 bg-orange-50 rounded-lg border border-orange-100"},X1={class:"text-xs text-gray-600 mb-1"},Z1={class:"text-lg font-bold text-orange-600"},eg={class:"w-full bg-gray-200 rounded-full h-2 overflow-hidden mb-3"},tg={key:0,class:"mt-3"},og={class:"text-xs font-medium text-gray-600 mb-2"},sg={class:"grid grid-cols-2 md:grid-cols-3 gap-2"},ag={class:"flex items-center justify-between mb-1"},lg={class:"text-gray-700 font-medium"},ng={class:"font-semibold text-gray-900"},rg={class:"flex items-center justify-between"},ig={key:0,class:"text-[9px] text-gray-500"},ug={key:1},dg={class:"mb-6"},cg={key:0,class:"flex flex-col items-center justify-center py-16 text-center"},mg={class:"text-gray-600 font-medium"},vg={key:1,class:"grid gap-4 lg:grid-cols-2 xl:grid-cols-3"},pg={class:"bg-gradient-to-r from-indigo-50 to-blue-50 px-5 py-4 border-b border-gray-200"},fg={class:"flex items-start justify-between mb-2"},gg={class:"flex-1"},hg={class:"text-base font-bold text-gray-900"},_g={class:"flex items-center gap-2 mt-1"},yg={class:"text-end ms-3"},bg={class:"text-xs text-gray-500 mb-1"},xg={class:"text-lg font-bold text-indigo-600"},wg={class:"px-5 py-4 flex flex-col gap-3"},kg={class:"flex items-start"},$g={class:"flex-1"},Cg={class:"text-xs text-gray-500"},Sg={class:"text-sm font-semibold text-gray-900"},Ig={class:"flex items-start"},Vg={class:"flex-1"},Dg={class:"text-xs text-gray-500"},Mg={class:"text-sm font-medium text-gray-900"},Pg={class:"grid grid-cols-2 gap-3 pt-2 border-t border-gray-100"},Tg={class:"text-xs text-gray-500 mb-1"},Ag={class:"text-sm font-semibold text-green-600"},jg={class:"text-xs text-gray-500 mb-1"},Lg={class:"text-sm font-semibold text-orange-600"},Bg={class:"px-5 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-end gap-2"},Og=["onClick","title"],Eg=["onClick","title"],zg={key:2},Ng={key:0,class:"flex flex-col items-center justify-center py-16 text-center"},Fg={class:"text-gray-600 font-medium"},Rg={class:"text-gray-500 text-sm mt-1"},Ug={key:1,class:"grid gap-4"},Hg=["onClick"],qg={class:"flex items-start justify-between mb-2"},Wg={class:"flex-1"},Gg={class:"text-sm font-semibold text-gray-900"},Qg={key:0,class:"text-xs text-gray-500 mt-0.5"},Yg={class:"text-xs text-gray-400 mt-0.5"},Jg=["onClick","title"],Kg={class:"flex items-center justify-between text-xs"},Xg={class:"text-gray-600"},Zg={class:"font-bold text-purple-600"},eh={key:0,class:"mt-2 pt-2 border-t border-gray-100"},th={class:"flex flex-wrap gap-1"},oh={key:0,class:"text-[10px] text-gray-500 px-1.5 py-0.5"},sh={key:3},ah={key:0,class:"flex flex-col items-center justify-center py-16 text-center"},lh={class:"text-gray-600 font-medium"},nh={class:"text-gray-500 text-sm mt-1"},rh={key:1,class:"grid gap-4"},ih={class:"flex items-start justify-between"},uh={class:"flex-1"},dh={class:"flex items-center gap-2 mb-1"},ch={class:"text-sm font-semibold text-gray-900"},mh={class:"text-xs px-2 py-0.5 rounded-full font-medium bg-red-100 text-red-800"},vh={class:"flex items-center gap-4 text-xs text-gray-600"},ph={key:0},fh={class:"text-end ms-4"},gh={class:"text-sm font-bold text-red-600"},hh={class:"flex items-center gap-1 mt-2"},_h=["onClick","title"],yh=["onClick","title"],bh={__name:"InvoiceManagement",props:{modelValue:Boolean,posProfile:String,currency:{type:String,default:"USD"},historyInvoices:{type:Array,default:()=>[]},draftInvoices:{type:Array,default:()=>[]}},emits:["update:modelValue","view-invoice","print-invoice","load-draft","delete-draft","refresh-history"],setup(i,{emit:l}){const{showSuccess:d,showError:m}=ft(),{formatDate:$,formatDateTime:D,formatTime:T}=Ao(),S=i,p=l,x=C(S.modelValue),g=C(!1),V=C("partial"),O=Zt(),w=ee(()=>S.historyInvoices),M=Io(w),y=C([]),v=C("all"),b=C({count:0,total_outstanding:0,total_paid:0}),B=C(null),H=C(!1),le=ee(()=>v.value==="partial"?y.value.filter(r=>r.status==="Partly Paid"):v.value==="unpaid"?y.value.filter(r=>r.status==="Unpaid"):v.value==="overdue"?y.value.filter(r=>r.status==="Overdue"):y.value),K=ee(()=>{const r=le.value;return{count:r.length,total_outstanding:r.reduce((_,F)=>_+(F.outstanding_amount||0),0),total_paid:r.reduce((_,F)=>_+(F.paid_amount||0),0)}}),L=ee(()=>(Array.isArray(S.historyInvoices)?S.historyInvoices:[]).filter(_=>_.is_return)),me=ee(()=>{const _=(Array.isArray(S.historyInvoices)?S.historyInvoices:[]).filter(ve=>!ve.is_return),F=ee(()=>_);return Io(F).filteredInvoices.value}),we=ee(()=>[{id:"partial",label:__("Unpaid"),icon:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z",color:"orange",activeClass:"text-orange-600",badge:()=>y.value.length},{id:"history",label:__("Invoice History"),icon:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",color:"indigo",activeClass:"text-indigo-600",badge:()=>me.value.length},{id:"drafts",label:__("Drafts"),icon:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z",color:"purple",activeClass:"text-purple-600",badge:()=>S.draftInvoices.length},{id:"returns",label:__("Returns"),icon:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6",color:"red",activeClass:"text-red-600",badge:()=>L.value.length}]),J=ee(()=>{var r;return((r=we.value.find(_=>_.id===V.value))==null?void 0:r.label)||""});function te(r){switch(r){case"partial":return"text-orange-600 border-orange-500";case"history":return"text-indigo-600 border-indigo-500";case"drafts":return"text-purple-600 border-purple-500";case"returns":return"text-red-600 border-red-500";default:return"text-gray-600 border-gray-500"}}function ne(r){switch(r){case"partial":return"bg-orange-100 text-orange-700";case"history":return"bg-indigo-100 text-indigo-700";case"drafts":return"bg-purple-100 text-purple-700";case"returns":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}}function ae(r){switch(r){case"partial":return"bg-gray-200 text-gray-600";case"history":return"bg-gray-200 text-gray-600";case"drafts":return"bg-gray-200 text-gray-600";case"returns":return"bg-gray-200 text-gray-600";default:return"bg-gray-200 text-gray-600"}}xe(()=>S.modelValue,r=>{x.value=r,r&&(Ce(),be(),S.historyInvoices.length===0&&p("refresh-history"))}),xe(x,r=>{p("update:modelValue",r)}),xe(V,r=>{r==="history"||r==="returns"?p("refresh-history"):r==="partial"&&(Ce(),be())});function he(){x.value=!1}function oe(){return Z(this,null,function*(){V.value==="partial"?yield Promise.all([Ce(),be()]):(V.value==="history"||V.value==="drafts"||V.value==="returns")&&p("refresh-history")})}function Ce(){return Z(this,null,function*(){if(S.posProfile){g.value=!0;try{const r=yield ct("pos_next.api.partial_payments.get_unpaid_invoices",{pos_profile:S.posProfile,limit:100});y.value=r||[]}catch(r){console.error("Error loading unpaid invoices:",r),m(r.message||__("Failed to load unpaid invoices"))}finally{g.value=!1}}})}function be(){return Z(this,null,function*(){if(S.posProfile)try{const r=yield ct("pos_next.api.partial_payments.get_unpaid_summary",{pos_profile:S.posProfile});b.value=r||{count:0,total_outstanding:0,total_paid:0}}catch(r){console.error("Error loading summary:",r)}})}function Pe(r){B.value=r,H.value=!0}function W(r){return Z(this,null,function*(){if(B.value)try{yield ct("pos_next.api.partial_payments.add_payment_to_partial_invoice",{invoice_name:B.value.name,payments:r.payments}),d(__("Payment added successfully")),yield Ce(),yield be(),p("refresh-history"),B.value=null}catch(_){console.error("Error adding payment:",_),m(_.message||__("Failed to add payment"))}})}function se(r){return Nt(Number.parseFloat(r||0),S.currency)}function _e(r){switch(r){case"POS":return"POS";case"POS Payment Entry":return"POS";case"Payment Entry":return"Back Office";default:return r}}function De(r){return!r||r.length===0?0:r.reduce((_,F)=>_+(F.quantity||F.qty||0)*(F.rate||0),0)}return ze(()=>{O.loadSavedFiltersFromStorage(),x.value&&(Ce(),be())}),(r,_)=>{var F;return s(),n(ce,null,[h(Ye,{name:"fade"},{default:E(()=>[x.value?(s(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-[300]",onClick:ke(he,["self"])},[e("div",l1,[e("div",n1,[e("div",r1,[e("div",i1,[_[5]||(_[5]=e("div",{class:"p-2 bg-indigo-100 rounded-lg"},[e("svg",{class:"w-6 h-6 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e("div",null,[e("h2",u1,t(r.__("Invoice Management")),1),e("p",d1,t(r.__("Manage all your invoices in one place")),1)])]),e("div",c1,[h(o(fe),{onClick:oe,loading:g.value,variant:"ghost",size:"sm"},{prefix:E(()=>_[6]||(_[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])),default:E(()=>[Q(" "+t(r.__("Refresh")),1)]),_:1},8,["loading"]),e("button",{onClick:he,class:"p-2 hover:bg-white/50 rounded-lg transition-colors"},_[7]||(_[7]=[e("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])]),e("div",m1,[e("nav",{class:"flex gap-2 px-6","aria-label":r.__("Tabs")},[(s(!0),n(ce,null,ge(we.value,j=>(s(),n("button",{key:j.id,onClick:ve=>V.value=j.id,class:N(["px-4 py-3 text-sm font-semibold transition-all border-b-2 relative",V.value===j.id?te(j.id):"text-gray-600 border-transparent hover:text-gray-800 hover:border-gray-300"])},[e("div",f1,[(s(),n("svg",g1,[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:j.icon},null,8,h1)])),e("span",null,t(j.label),1),j.badge&&j.badge()>0?(s(),n("span",{key:0,class:N(["ms-1 px-2 py-0.5 text-xs font-bold rounded-full",V.value===j.id?ne(j.id):ae(j.id)])},t(j.badge()),3)):I("",!0)])],10,p1))),128))],8,v1)]),e("div",_1,[g.value&&V.value==="partial"?(s(),n("div",y1,[_[8]||(_[8]=e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-3 border-indigo-500 mb-4"},null,-1)),e("p",b1,t(r.__("Loading {0}...",[J.value])),1)])):I("",!0),e("div",x1,[V.value==="partial"?(s(),n("div",w1,[e("div",k1,[e("button",{onClick:_[0]||(_[0]=j=>v.value="all"),class:N(["px-4 py-2 rounded-lg font-medium text-sm transition-all",v.value==="all"?"bg-orange-500 text-white shadow-md":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"])},t(r.__("All ({0})",[y.value.length])),3),e("button",{onClick:_[1]||(_[1]=j=>v.value="partial"),class:N(["px-4 py-2 rounded-lg font-medium text-sm transition-all",v.value==="partial"?"bg-orange-500 text-white shadow-md":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"])},t(r.__("Partially Paid ({0})",[y.value.filter(j=>j.status==="Partly Paid").length])),3),e("button",{onClick:_[2]||(_[2]=j=>v.value="unpaid"),class:N(["px-4 py-2 rounded-lg font-medium text-sm transition-all",v.value==="unpaid"?"bg-orange-500 text-white shadow-md":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"])},t(r.__("Unpaid ({0})",[y.value.filter(j=>j.status==="Unpaid").length])),3),e("button",{onClick:_[3]||(_[3]=j=>v.value="overdue"),class:N(["px-4 py-2 rounded-lg font-medium text-sm transition-all",v.value==="overdue"?"bg-red-500 text-white shadow-md":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"])},t(r.__("Overdue ({0})",[y.value.filter(j=>j.status==="Overdue").length])),3)]),K.value.count>0?(s(),n("div",$1,[e("div",C1,[e("div",null,[e("div",S1,t(r.__("Outstanding Payments")),1),e("div",I1,t(se(K.value.total_outstanding)),1)]),e("div",V1,[e("div",D1,t(r.__("{0} invoices",[K.value.count])),1),e("div",M1,t(r.__("{0} paid",[se(K.value.total_paid)])),1)])])])):I("",!0),le.value.length===0?(s(),n("div",P1,[_[9]||(_[9]=e("svg",{class:"w-16 h-16 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",T1,t(r.__("No Unpaid Invoices")),1),e("p",A1,t(r.__("All invoices are fully paid")),1)])):(s(),n("div",j1,[(s(!0),n(ce,null,ge(le.value,j=>(s(),n("div",{key:j.name,class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow"},[e("div",L1,[e("div",B1,[e("div",null,[e("div",O1,[e("h3",E1,t(j.name),1),e("span",{class:N(["px-2 py-0.5 text-xs font-semibold rounded-full",o(Gt)(j)])},t(r.__(j.status)),3)]),e("div",z1,[e("div",N1,[_[10]||(_[10]=e("svg",{class:"w-4 h-4 me-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),Q(" "+t(j.customer_name||j.customer),1)]),e("div",F1,[_[11]||(_[11]=e("svg",{class:"w-4 h-4 me-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),Q(" "+t(o($)(j.posting_date))+" "+t(o(T)(j.posting_time)),1)])])]),e("button",{onClick:ve=>Pe(j),class:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors text-sm font-semibold"},t(r.__("Add Payment")),9,R1)])]),e("div",U1,[e("div",H1,[e("div",q1,[e("div",W1,t(r.__("Total Amount")),1),e("div",G1,t(se(j.grand_total)),1)]),e("div",Q1,[e("div",Y1,t(r.__("Paid")),1),e("div",J1,t(se(j.paid_amount)),1)]),e("div",K1,[e("div",X1,t(r.__("Outstanding")),1),e("div",Z1,t(se(j.outstanding_amount)),1)])]),e("div",eg,[e("div",{class:"h-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-300",style:Tt({width:`${j.paid_amount/j.grand_total*100}%`})},null,4)]),j.payments&&j.payments.length>0?(s(),n("div",tg,[e("div",og,t(r.__("Payment History")),1),e("div",sg,[(s(!0),n(ce,null,ge(j.payments,(ve,$e)=>(s(),n("div",{key:$e,class:N(["flex flex-col p-2 rounded-lg border text-sm",ve.source==="Payment Entry"?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"])},[e("div",ag,[e("span",lg,t(ve.mode_of_payment||r.__("N/A")),1),e("span",ng,t(se(ve.amount)),1)]),e("div",rg,[ve.posting_date?(s(),n("span",ig,t(o($)(ve.posting_date)),1)):I("",!0),e("span",{class:N(["text-[9px] font-semibold",ve.source==="Payment Entry"?"text-blue-600":"text-gray-500"])},t(_e(ve.source)),3)])],2))),128))])])):I("",!0)])]))),128))]))])):I("",!0),V.value==="history"?(s(),n("div",ug,[e("div",dg,[h(a1,{"unique-customers":o(M).uniqueCustomers.value,"unique-products":o(M).uniqueProducts.value,"filter-stats":o(M).filterStats.value},null,8,["unique-customers","unique-products","filter-stats"])]),me.value.length===0?(s(),n("div",cg,[_[12]||(_[12]=e("svg",{class:"w-16 h-16 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("p",mg,t(r.__("No invoices found")),1)])):(s(),n("div",vg,[(s(!0),n(ce,null,ge(me.value,j=>(s(),n("div",{key:j.name,class:"bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-lg transition-all overflow-hidden"},[e("div",pg,[e("div",fg,[e("div",gg,[e("h3",hg,t(j.name),1),e("div",_g,[e("span",{class:N(["text-xs px-2.5 py-1 rounded-full font-semibold",o(Gt)(j)])},t(r.__(j.status)),3)])]),e("div",yg,[e("div",bg,t(r.__("Total")),1),e("div",xg,t(se(j.grand_total)),1)])])]),e("div",wg,[e("div",kg,[_[13]||(_[13]=e("svg",{class:"w-5 h-5 text-gray-400 me-2 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),e("div",$g,[e("div",Cg,t(r.__("Customer")),1),e("div",Sg,t(j.customer_name||j.customer),1)])]),e("div",Ig,[_[14]||(_[14]=e("svg",{class:"w-5 h-5 text-gray-400 me-2 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),e("div",Vg,[e("div",Dg,t(r.__("Date & Time")),1),e("div",Mg,t(o($)(j.posting_date))+" "+t(o(T)(j.posting_time)),1)])]),e("div",Pg,[e("div",null,[e("div",Tg,t(r.__("Paid Amount")),1),e("div",Ag,t(se(j.paid_amount||0)),1)]),e("div",null,[e("div",jg,t(r.__("Outstanding")),1),e("div",Lg,t(se(j.outstanding_amount||0)),1)])])]),e("div",Bg,[e("button",{onClick:ve=>r.$emit("view-invoice",j),class:"px-3 py-2 text-xs font-semibold text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors flex items-center gap-1",title:r.__("View Details")},[_[15]||(_[15]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)),e("span",null,t(r.__("View")),1)],8,Og),e("button",{onClick:ve=>r.$emit("print-invoice",j),class:"px-3 py-2 text-xs font-semibold text-green-600 bg-green-50 hover:bg-green-100 rounded-lg transition-colors flex items-center gap-1",title:r.__("Print")},[_[16]||(_[16]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1)),e("span",null,t(r.__("Print")),1)],8,Eg)])]))),128))]))])):I("",!0),V.value==="drafts"?(s(),n("div",zg,[i.draftInvoices.length===0?(s(),n("div",Ng,[_[17]||(_[17]=e("svg",{class:"w-16 h-16 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("p",Fg,t(r.__("No draft invoices")),1),e("p",Rg,t(r.__("Save invoices as drafts to continue later")),1)])):(s(),n("div",Ug,[(s(!0),n(ce,null,ge(i.draftInvoices,j=>{var ve,$e,ue;return s(),n("div",{key:j.draft_id,class:"bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-purple-400 transition-all cursor-pointer",onClick:f=>r.$emit("load-draft",j)},[e("div",qg,[e("div",Wg,[e("h4",Gg,t(j.draft_id),1),j.customer?(s(),n("p",Qg,t(r.__("Customer: {0}",[((ve=j.customer)==null?void 0:ve.customer_name)||(($e=j.customer)==null?void 0:$e.name)||j.customer])),1)):I("",!0),e("p",Yg,t(o(D)(j.created_at)),1)]),e("button",{onClick:ke(f=>r.$emit("delete-draft",j.draft_id),["stop"]),class:"text-gray-400 hover:text-red-600 transition-colors p-1",title:r.__("Delete draft")},_[18]||(_[18]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Jg)]),e("div",Kg,[e("span",Xg,t(r.__("{0} item(s)",[((ue=j.items)==null?void 0:ue.length)||0])),1),e("span",Zg,t(se(De(j.items))),1)]),j.items&&j.items.length>0?(s(),n("div",eh,[e("div",th,[(s(!0),n(ce,null,ge(j.items.slice(0,3),(f,R)=>(s(),n("span",{key:R,class:"text-[10px] bg-purple-50 text-purple-700 px-1.5 py-0.5 rounded"},t(f.item_name)+" ("+t(f.quantity||f.qty)+") ",1))),128)),j.items.length>3?(s(),n("span",oh,t(r.__("+{0} more",[j.items.length-3])),1)):I("",!0)])])):I("",!0)],8,Hg)}),128))]))])):I("",!0),V.value==="returns"?(s(),n("div",sh,[L.value.length===0?(s(),n("div",ah,[_[19]||(_[19]=e("svg",{class:"w-16 h-16 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1)),e("p",lh,t(r.__("No return invoices")),1),e("p",nh,t(r.__("Return invoices will appear here")),1)])):(s(),n("div",rh,[(s(!0),n(ce,null,ge(L.value,j=>(s(),n("div",{key:j.name,class:"bg-white border border-red-200 rounded-lg p-4 hover:shadow-md transition-all"},[e("div",ih,[e("div",uh,[e("div",dh,[e("h4",ch,t(j.name),1),e("span",mh,t(r.__("Return")),1)]),e("div",vh,[e("span",null,t(j.customer_name),1),e("span",null,t(o($)(j.posting_date)),1),j.return_against?(s(),n("span",ph,t(r.__("Against: {0}",[j.return_against])),1)):I("",!0)])]),e("div",fh,[e("p",gh," -"+t(se(Math.abs(j.grand_total))),1),e("div",hh,[e("button",{onClick:ve=>r.$emit("view-invoice",j),class:"p-1.5 hover:bg-blue-50 rounded transition-colors",title:r.__("View Details")},_[20]||(_[20]=[e("svg",{class:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)]),8,_h),e("button",{onClick:ve=>r.$emit("print-invoice",j),class:"p-1.5 hover:bg-green-50 rounded transition-colors",title:r.__("Print")},_[21]||(_[21]=[e("svg",{class:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1)]),8,yh)])])])]))),128))]))])):I("",!0)])])])])])):I("",!0)]),_:1}),h(Lo,{modelValue:H.value,"onUpdate:modelValue":_[4]||(_[4]=j=>H.value=j),"grand-total":((F=B.value)==null?void 0:F.outstanding_amount)||0,"pos-profile":i.posProfile,currency:i.currency,"is-offline":!1,"allow-partial-payment":!0,onPaymentCompleted:W},null,8,["modelValue","grand-total","pos-profile","currency"])],64)}}},xh=Fe(bh,[["__scopeId","data-v-71ef0b3e"]]),wh={key:0,class:"text-center py-12"},kh={class:"mt-3 text-sm text-gray-500"},$h={key:1,class:"flex flex-col gap-6"},Ch={class:"bg-gradient-to-r from-indigo-50 to-blue-50 rounded-lg p-4 md:p-5 border border-indigo-100"},Sh={class:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4"},Ih={class:"flex-1"},Vh={class:"flex items-center gap-3 mb-2 flex-wrap"},Dh={class:"text-lg md:text-xl font-bold text-gray-900"},Mh={key:0,class:"px-3 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800"},Ph={class:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm"},Th={class:"text-start"},Ah={class:"text-gray-600"},jh={class:"ms-2 font-semibold text-gray-900"},Lh={class:"text-start"},Bh={class:"text-gray-600"},Oh={class:"ms-2 font-medium text-gray-900"},Eh={key:0,class:"text-start"},zh={class:"text-gray-600"},Nh={class:"ms-2 font-medium text-gray-900"},Fh={class:"text-start sm:text-end"},Rh={class:"text-xs text-gray-500 mb-1"},Uh={class:"text-xl md:text-2xl font-bold text-indigo-600"},Hh={class:"text-sm font-semibold text-gray-700 mb-3 flex items-center"},qh={class:"md:hidden flex flex-col gap-3"},Wh={class:"flex items-center justify-between gap-3 mb-2"},Gh={class:"flex-1 min-w-0 text-center"},Qh={class:"text-sm font-semibold text-gray-900"},Yh={class:"text-xs text-gray-500"},Jh={class:"grid grid-cols-3 gap-2 text-center border-t border-gray-100 pt-2"},Kh={class:"text-xs text-gray-500"},Xh={class:"text-sm font-medium text-gray-900"},Zh={class:"text-xs text-gray-500"},e_={class:"text-sm font-medium text-gray-900"},t_={class:"text-xs text-gray-500"},o_={class:"text-sm font-semibold text-gray-900"},s_={key:0,class:"text-center text-xs text-orange-600 mt-2 pt-2 border-t border-gray-100"},a_={class:"hidden md:block border border-gray-200 rounded-lg overflow-hidden"},l_={class:"min-w-full divide-y divide-gray-200"},n_={class:"bg-gray-50"},r_={class:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider"},i_={class:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider"},u_={class:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider"},d_={class:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider"},c_={class:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider"},m_={class:"bg-white divide-y divide-gray-200"},v_={class:"px-4 py-3 text-center"},p_={class:"text-sm font-medium text-gray-900"},f_={class:"text-xs text-gray-500"},g_={class:"px-4 py-3 text-center text-sm text-gray-900"},h_={class:"px-4 py-3 text-center text-sm text-gray-900"},y_={class:"px-4 py-3 text-center text-sm text-gray-600"},b_={class:"px-4 py-3 text-center text-sm font-semibold text-gray-900"},x_={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},w_={key:0},k_={class:"text-sm font-semibold text-gray-700 mb-3 flex items-center"},$_={class:"flex flex-col gap-2"},C_={class:"text-start"},S_={class:"text-sm font-medium text-gray-900"},I_={key:0,class:"text-xs text-gray-500"},V_={class:"text-sm font-semibold text-green-700"},D_={class:"text-sm font-semibold text-gray-700 mb-3 text-start"},M_={class:"flex flex-col gap-2 bg-gray-50 p-4 rounded-lg border border-gray-200"},P_={class:"flex justify-between text-sm"},T_={class:"text-gray-600"},A_={class:"font-medium text-gray-900"},j_={key:0,class:"flex justify-between text-sm"},L_={class:"text-gray-600"},B_={class:"font-medium text-gray-900"},O_={key:1,class:"flex justify-between text-sm"},E_={class:"text-gray-600"},z_={class:"font-medium text-red-600"},N_={class:"pt-2 border-t border-gray-300 flex justify-between"},F_={class:"font-semibold text-gray-900"},R_={class:"font-bold text-lg text-indigo-600"},U_={key:2,class:"flex justify-between text-sm"},H_={class:"text-gray-600"},q_={class:"font-semibold text-green-600"},W_={key:3,class:"flex justify-between text-sm"},G_={class:"text-gray-600"},Q_={class:"font-semibold text-orange-600"},Y_={key:0,class:"bg-gray-50 p-4 rounded-lg border border-gray-200"},J_={class:"text-sm font-semibold text-gray-700 mb-2 text-start"},K_={class:"text-sm text-gray-600 text-start"},X_={key:2,class:"text-center py-12"},Z_={class:"mt-2 text-sm text-gray-500"},e2={class:"flex justify-between items-center w-full"},t2={__name:"InvoiceDetailDialog",props:{modelValue:Boolean,invoiceName:String,posProfile:String,currency:{type:String,default:"USD"}},emits:["update:modelValue","print-invoice"],setup(i,{emit:l}){const d=Ct.create("InvoiceDetailDialog"),{formatDate:m,formatTime:$}=Ao(),D=i;function T(w){return Nt(Number.parseFloat(w||0),D.currency)}const S=l,p=C(D.modelValue),x=C(!1),g=C(null);xe(()=>D.modelValue,w=>{p.value=w,w&&D.invoiceName&&V()}),xe(p,w=>Z(this,null,function*(){S("update:modelValue",w),w?(yield kt(),document.querySelectorAll(".modal-container, .modal-backdrop").forEach(y=>{var b;const v=y.querySelector('[class*="title"]');v&&((b=v.textContent)!=null&&b.includes("Invoice Details"))&&(y.style.zIndex="400")})):g.value=null}));function V(){return Z(this,null,function*(){if(D.invoiceName){x.value=!0;try{const w=yield ct("pos_next.api.invoices.get_invoice",{invoice_name:D.invoiceName});w&&w.items&&(w.items=w.items.map(M=>lt(We({},M),{quantity:M.qty}))),g.value=w}catch(w){d.error("Error loading invoice details:",w),g.value=null}finally{x.value=!1}}})}function O(){g.value&&S("print-invoice",g.value)}return(w,M)=>(s(),ie(o(it),{modelValue:p.value,"onUpdate:modelValue":M[1]||(M[1]=y=>p.value=y),options:{title:w.__("Invoice Details"),size:"5xl"}},{"body-content":E(()=>[x.value?(s(),n("div",wh,[M[2]||(M[2]=e("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500 mx-auto"},null,-1)),e("p",kh,t(w.__("Loading invoice details...")),1)])):g.value?(s(),n("div",$h,[e("div",Ch,[e("div",Sh,[e("div",Ih,[e("div",Vh,[e("h3",Dh,t(g.value.name),1),g.value.is_return?(s(),n("span",Mh,t(w.__("Return Invoice")),1)):(s(),n("span",{key:1,class:N(["px-3 py-1 text-xs font-semibold rounded-full",o(Gt)(g.value)])},t(w.__(g.value.status)),3))]),e("div",Ph,[e("div",Th,[e("span",Ah,t(w.__("Customer:")),1),e("span",jh,t(g.value.customer_name||g.value.customer),1)]),e("div",Lh,[e("span",Bh,t(w.__("Date:")),1),e("span",Oh,t(o(m)(g.value.posting_date))+" "+t(o($)(g.value.posting_time)),1)]),g.value.return_against?(s(),n("div",Eh,[e("span",zh,t(w.__("Return Against:")),1),e("span",Nh,t(g.value.return_against),1)])):I("",!0)])]),e("div",Fh,[e("div",Rh,t(w.__("Grand Total")),1),e("div",Uh,t(T(g.value.grand_total)),1)])])]),e("div",null,[e("h4",Hh,[M[3]||(M[3]=e("svg",{class:"w-4 h-4 me-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)),Q(" "+t(w.__("Items")),1)]),e("div",qh,[(s(!0),n(ce,null,ge(g.value.items,(y,v)=>(s(),n("div",{key:v,class:"bg-white border border-gray-200 rounded-lg p-3"},[e("div",Wh,[e("div",Gh,[e("div",Qh,t(y.item_name),1),e("div",Yh,t(y.item_code),1)])]),e("div",Jh,[e("div",null,[e("div",Kh,t(w.__("Qty")),1),e("div",Xh,t(y.quantity),1)]),e("div",null,[e("div",Zh,t(w.__("Rate")),1),e("div",e_,t(T(y.rate)),1)]),e("div",null,[e("div",t_,t(w.__("Amount")),1),e("div",o_,t(T(y.amount)),1)])]),y.discount_percentage?(s(),n("div",s_,t(w.__("Discount:"))+" "+t(y.discount_percentage)+"% ",1)):I("",!0)]))),128))]),e("div",a_,[e("table",l_,[e("thead",n_,[e("tr",null,[e("th",r_,t(w.__("Item")),1),e("th",i_,t(w.__("Qty")),1),e("th",u_,t(w.__("Rate")),1),e("th",d_,t(w.__("Discount")),1),e("th",c_,t(w.__("Amount")),1)])]),e("tbody",m_,[(s(!0),n(ce,null,ge(g.value.items,(y,v)=>(s(),n("tr",{key:v,class:"hover:bg-gray-50"},[e("td",v_,[e("div",p_,t(y.item_name),1),e("div",f_,t(y.item_code),1)]),e("td",g_,t(y.quantity),1),e("td",h_,t(T(y.rate)),1),e("td",y_,t(y.discount_percentage?`${y.discount_percentage}%`:"-"),1),e("td",b_,t(T(y.amount)),1)]))),128))])])])]),e("div",x_,[g.value.payments&&g.value.payments.length>0?(s(),n("div",w_,[e("h4",k_,[M[4]||(M[4]=e("svg",{class:"w-4 h-4 me-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})],-1)),Q(" "+t(w.__("Payments")),1)]),e("div",$_,[(s(!0),n(ce,null,ge(g.value.payments,(y,v)=>(s(),n("div",{key:v,class:"flex justify-between items-center p-3 bg-green-50 border border-green-200 rounded-lg"},[e("div",C_,[e("div",S_,t(y.mode_of_payment),1),y.account?(s(),n("div",I_,t(y.account),1)):I("",!0)]),e("div",V_,t(T(y.amount)),1)]))),128))])])):I("",!0),e("div",null,[e("h4",D_,t(w.__("Summary")),1),e("div",M_,[e("div",P_,[e("span",T_,t(w.__("Net Total:")),1),e("span",A_,t(T(g.value.net_total||g.value.total)),1)]),g.value.total_taxes_and_charges?(s(),n("div",j_,[e("span",L_,t(w.__("Taxes:")),1),e("span",B_,t(T(g.value.total_taxes_and_charges)),1)])):I("",!0),g.value.discount_amount?(s(),n("div",O_,[e("span",E_,t(w.__("Discount:")),1),e("span",z_,"-"+t(T(g.value.discount_amount)),1)])):I("",!0),e("div",N_,[e("span",F_,t(w.__("Grand Total:")),1),e("span",R_,t(T(g.value.grand_total)),1)]),g.value.paid_amount?(s(),n("div",U_,[e("span",H_,t(w.__("Paid Amount:")),1),e("span",q_,t(T(g.value.paid_amount)),1)])):I("",!0),g.value.outstanding_amount?(s(),n("div",W_,[e("span",G_,t(w.__("Outstanding:")),1),e("span",Q_,t(T(g.value.outstanding_amount)),1)])):I("",!0)])])]),g.value.remarks?(s(),n("div",Y_,[e("h4",J_,t(w.__("Remarks")),1),e("p",K_,t(g.value.remarks),1)])):I("",!0)])):(s(),n("div",X_,[M[5]||(M[5]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Z_,t(w.__("Failed to load invoice details")),1)]))]),actions:E(()=>[e("div",e2,[h(o(fe),{variant:"subtle",onClick:M[0]||(M[0]=y=>p.value=!1)},{default:E(()=>[Q(t(w.__("Close")),1)]),_:1}),h(o(fe),{onClick:O},{prefix:E(()=>M[6]||(M[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1)])),default:E(()=>[Q(" "+t(w.__("Print")),1)]),_:1})])]),_:1},8,["modelValue","options"]))}},o2={class:"side-categories flex flex-col h-full bg-gray-100 border-l-2 border-gray-300 overflow-hidden relative"},s2=["disabled"],a2=["onClick","title"],l2={class:"category-name text-sm font-bold"},n2=["disabled"],r2={__name:"SideCategories",props:{itemGroups:{type:Array,default:()=>[]},modelValue:{type:String,default:null}},emits:["update:modelValue","category-selected"],setup(i,{emit:l}){const d=i,m=l,$=C(d.modelValue),D=C(null),T=C(!1),S=C(!1),p=[{name:"الكل",value:null},{name:"مشروبات",value:"beverages"},{name:"حلويات",value:"sweets"},{name:"سندوتشات",value:"sandwiches"},{name:"وجبات",value:"meals"},{name:"مقبلات",value:"appetizers"}],x=ee(()=>d.itemGroups&&d.itemGroups.length>0?[{name:"الكل",value:null},...d.itemGroups.map(M=>({name:M.item_group||M.name,value:M.item_group||M.name}))]:p),g=M=>{$.value=M.name,m("update:modelValue",M.value),m("category-selected",M)},V=M=>(M&&(M.preventDefault(),M.stopPropagation(),M.stopImmediatePropagation()),D.value&&(D.value.scrollBy({top:-100,behavior:"smooth"}),setTimeout(()=>w(),100)),!1),O=M=>(M&&(M.preventDefault(),M.stopPropagation(),M.stopImmediatePropagation()),D.value&&(D.value.scrollBy({top:100,behavior:"smooth"}),setTimeout(()=>w(),100)),!1),w=()=>{if(!D.value)return;const{scrollTop:M,scrollHeight:y,clientHeight:v}=D.value;T.value=M>0,S.value=M+v<y-1};return ze(()=>{kt(()=>{setTimeout(()=>{w()},100),setTimeout(()=>{w()},500)})}),(M,y)=>(s(),n("aside",o2,[e("button",{onClick:ke(V,["stop"]),onTouchstart:ke(V,["stop","prevent"]),onMousedown:ke(V,["stop","prevent"]),onTouchend:y[0]||(y[0]=ke(()=>{},["stop","prevent"])),class:"scroll-btn up",disabled:!T.value,type:"button"},y[2]||(y[2]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"})],-1)]),40,s2),e("div",{ref_key:"categoriesContainer",ref:D,class:"flex-1 overflow-y-auto scrollbar-hide p-2 flex flex-col gap-2",onScroll:w},[(s(!0),n(ce,null,ge(x.value,v=>(s(),n("button",{key:v.name,onClick:b=>g(v),class:N(["category-btn-intouch",{active:$.value===v.name}]),title:v.name},[e("span",l2,t(v.name),1)],10,a2))),128))],544),e("button",{onClick:ke(O,["stop"]),onTouchstart:ke(O,["stop","prevent"]),onMousedown:ke(O,["stop","prevent"]),onTouchend:y[1]||(y[1]=ke(()=>{},["stop","prevent"])),class:"scroll-btn down",disabled:!S.value,type:"button"},y[3]||(y[3]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)]),40,n2)]))}},i2=Fe(r2,[["__scopeId","data-v-f0d17cbe"]]),Qt=Ct.create("RealtimeStock"),jt=C(!1),Pt=new Set,$t=new Map;let at=null;const u2=Bo.get("stockBatchDelay"),d2=Bo.get("stockMaxBatchSize");function Yt(){return Z(this,null,function*(){if($t.size===0)return;const i=Array.from($t.values());$t.clear();try{Pt.forEach(l=>{try{l(i)}catch(d){Qt.error("Handler error",d)}})}catch(l){Qt.error("Failed to process batch updates",l)}})}function c2(){if(at&&clearTimeout(at),$t.size>=d2){Yt();return}at=setTimeout(()=>{Yt(),at=null},u2)}function Fo(i){!i||!i.stock_updates||(i.stock_updates.forEach(l=>{const d=`${l.item_code}|${l.warehouse}`;$t.set(d,l)}),c2())}function Ro(i){}function Vo(){var i;if(!jt.value){if(!((i=window.frappe)!=null&&i.realtime)){Qt.warn("Socket.IO not available");return}window.frappe.realtime.on("pos_stock_update",Fo),window.frappe.realtime.on("pos_invoice_created",Ro),jt.value=!0}}function Do(){var i;jt.value&&((i=window.frappe)!=null&&i.realtime&&(window.frappe.realtime.off("pos_stock_update",Fo),window.frappe.realtime.off("pos_invoice_created",Ro)),at&&(clearTimeout(at),at=null),$t.clear(),jt.value=!1)}function m2(){return Z(this,null,function*(){at&&(clearTimeout(at),at=null),yield Yt()})}function v2(){function i(l){if(typeof l!="function")throw new Error("Handler must be a function");return Pt.add(l),Pt.size===1&&Vo(),()=>{Pt.delete(l),Pt.size===0&&Do()}}return{isListening:jt,onStockUpdate:i,flushUpdates:m2,startListening:Vo,stopListening:Do}}const p2={class:"flex flex-col bg-gray-50 overflow-x-hidden",style:{height:"100vh","max-height":"100vh"}},f2={key:0,class:"ms-auto text-xs bg-purple-600 text-white px-1.5 py-0.5 rounded-full"},g2={class:"ms-auto text-xs bg-orange-600 text-white px-1.5 py-0.5 rounded-full"},h2=["title","aria-label"],_2={class:"lg:hidden bg-white border-b border-gray-200 flex shadow-sm sticky top-0 z-[100]"},y2=["aria-label","aria-selected"],b2={class:"flex items-center justify-center gap-1.5"},x2=["aria-label","aria-selected"],w2={class:"flex items-center justify-center gap-1.5"},k2={key:0,class:"bg-blue-600 text-white text-[10px] font-bold rounded-full min-w-[20px] h-5 px-1.5 flex items-center justify-center shadow-sm"},$2={key:0,class:"flex flex-1 flex-col bg-white overflow-hidden",style:{contain:"layout style paint"}},C2=["aria-label"],S2={class:"relative"},I2={class:"absolute -top-2 -end-2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[22px] h-[22px] px-1 flex items-center justify-center shadow-lg animate-pulse"},V2={class:"text-center"},D2={class:"mt-4 text-lg font-medium text-gray-900"},M2={class:"mt-2 text-sm text-gray-500"},P2={class:"p-4 space-y-4"},T2={class:"flex gap-2 mb-4 border-b border-gray-200 pb-2"},A2={key:0},j2={class:"flex gap-2 mb-4"},L2={class:"mb-4"},B2={class:"block text-sm font-medium text-gray-700 mb-2"},O2={class:"grid grid-cols-3 gap-2 mb-4"},E2=["onClick"],z2={key:0,class:"flex gap-2 mb-4"},N2=["onClick"],F2={key:1,class:"bg-gray-50 rounded-lg p-4"},R2={class:"flex justify-between items-center text-sm"},U2={class:"text-gray-600"},H2={class:"font-bold"},q2={class:"flex justify-between items-center text-sm text-red-600 mt-2"},W2={class:"font-bold"},G2={class:"flex justify-between items-center text-lg font-bold mt-2 pt-2 border-t border-gray-200"},Q2={class:"text-green-600"},Y2={key:1},J2={class:"mb-4"},K2={class:"block text-sm font-medium text-gray-700 mb-2"},X2={class:"flex gap-2"},Z2=["placeholder"],ey={key:0},ty={class:"block text-sm font-medium text-gray-700 mb-2"},oy={class:"grid grid-cols-1 gap-2 max-h-48 overflow-y-auto"},sy=["onClick"],ay={class:"font-bold text-purple-800"},ly={class:"text-xs text-purple-600"},ny={key:1,class:"text-center py-8 text-gray-500"},ry={class:"text-xs mt-1"},iy={class:"flex gap-2 w-full"},uy={class:"py-3"},dy={class:"text-sm text-gray-600"},cy={class:"flex gap-2 w-full"},my={key:0,class:"px-4 py-5"},vy={class:"text-center mb-6"},py={class:"text-lg font-bold text-red-600 mb-2"},fy={class:"text-sm text-gray-600 max-w-sm mx-auto"},gy={class:"space-y-3 max-w-md mx-auto"},hy=["disabled"],_y={class:"grid grid-cols-2 gap-2"},yy=["disabled"],by=["disabled"],xy={key:1,class:"px-4 py-5"},wy={class:"text-center mb-6"},ky={class:"text-lg font-bold text-red-600 mb-2"},$y={class:"text-sm text-gray-600"},Cy={class:"grid grid-cols-2 gap-3 max-w-sm mx-auto"},Sy=["disabled"],Iy=["disabled"],Vy={key:0},Dy={key:1,class:"flex items-center justify-center"},My={class:"text-center py-6"},Py={class:"mt-4 text-lg font-medium text-gray-900"},Ty={class:"mt-2 text-sm text-gray-500"},Ay={class:"flex gap-2"},jy={class:"py-3"},Ly={class:"text-sm text-gray-700 whitespace-pre-line"},By={key:0,class:"mt-3 pt-3 border-t border-gray-200"},Oy={class:"text-xs text-gray-500"},Ey={class:"flex justify-between items-center w-full"},zy={key:1},Ny={class:"flex gap-2"},Wy={__name:"POSSale",setup(i){const l=Kt(),d=Gs(),m=Ns(),$=Qs(),D=Ys(),T=To(),S=zt(),p=Js(),x=T,{onStockUpdate:g}=v2(),{onWarehouseChanged:V,onPricingChanged:O,onStockPolicyChanged:w,onSettingsChanged:M,onSalesOperationsChanged:y}=No(),{showSuccess:v,showError:b,showWarning:B}=ft(),H=Ct.create("POSSale"),le=C(60),K=C(null),L=C(!1),me=C(null);function we(u){L.value=u,le.value=u?0:60}function J(){me.value&&me.value.toggleCollapse?me.value.toggleCollapse():(L.value=!L.value,le.value=L.value?0:60,typeof window!="undefined"&&localStorage.setItem("pos-header-collapsed",L.value.toString()),we(L.value))}const te=C(!1),ne=C("percentage"),ae=C(0);C(null);const he=C("manual"),oe=C(""),Ce=C(!1),be=C([]),Pe=ee(()=>!ae.value||ae.value<=0?0:ne.value==="percentage"?l.subtotal*ae.value/100:Math.min(ae.value,l.subtotal));function W(u){return`${d.profileCurrency||""} ${Number(u||0).toFixed(2)}`}function se(u){if(u==="C"){ae.value=0;return}let c=String(ae.value||"");if(u==="."){if(c.includes("."))return;c=c+"."}else c==="0"?c=u:c=c+u;const q=parseFloat(c);isNaN(q)||(ne.value==="percentage"&&q>100?ae.value=100:ae.value=q)}function _e(){return Z(this,null,function*(){try{const u=yield wt("frappe.client.get_list",{doctype:"POS Coupon",filters:{used:0},fields:["name","coupon_code","coupon_name","description"],limit_page_length:20});be.value=u||[]}catch(u){console.error("Error loading coupons:",u),be.value=[]}})}function De(){return Z(this,null,function*(){if(!oe.value.trim()){B(__("الرجاء إدخال كود الكوبون"));return}Ce.value=!0;try{l.couponCode=oe.value.trim().toUpperCase(),v(__("تم تطبيق الكوبون: {0}",[oe.value])),te.value=!1,oe.value=""}catch(u){b(__("فشل تطبيق الكوبون"))}finally{Ce.value=!1}})}function r(u){oe.value=u.coupon_code,De()}function _(){if(!ae.value||ae.value<=0){B(__("الرجاء إدخال قيمة الخصم"));return}const u=Pe.value;l.additionalDiscount=u,l.rebuildIncrementalCache(),v(__("تم تطبيق خصم بقيمة {0}",[W(u)])),te.value=!1,ae.value=0}const{userName:F,userImage:j}=zs(),{isRTL:ve}=Xt(),$e=C(null),ue=C(null),f=C(null),R=C(null),Se=C(null),X=C(!1),Ve=C(!1),je=C(!1),qe=C(null),ot=C(null);let Re="";function Je(){return l.invoiceItems.map(u=>`${u.item_code}-${u.quantity}-${u.rate}-${u.discount_percentage||0}-${u.discount_amount||0}-${u.uom||""}-${u.warehouse||""}`).join("|")}const Ee=C(!1),rt=C(!1),Ke=C(!1),mt=C(!1),gt=C(null),Xe=C([]),Ue=C(!1),Ne=C([]),ht=Ae({url:"pos_next.api.pos_profile.get_warehouses",makeParams(){return{pos_profile:d.profileName}},auto:!1,onSuccess(u){const c=(u==null?void 0:u.message)||u||[];Ne.value=c},onError(u){H.error("Error loading warehouses:",u),Ne.value=[]}});xe(()=>d.profileName,u=>{u&&ht.reload()},{immediate:!0});const _t=ee(()=>Ne.value.length>0?Ne.value.map(u=>({name:u.name,warehouse:u.warehouse_name||u.name})):d.profileWarehouse?[{name:d.profileWarehouse,warehouse:d.profileWarehouse}]:[]);let Te=null,k=null;const a=C(450);ze(()=>Z(this,null,function*(){var q;typeof window!="undefined"&&localStorage.getItem("pos-header-collapsed")==="true"&&(L.value=!0,le.value=0);const u=()=>{m.setWindowWidth(window.innerWidth),yt()};window.addEventListener("resize",u,{passive:!0});const c=g(G=>Z(this,null,function*(){const Y=d.profileWarehouse?[d.profileWarehouse]:Ne.value.map(P=>P.warehouse_name||P.name),re=G.filter(P=>Y.includes(P.warehouse));re.length>0&&(p.update(re),yield He.updateStockQuantities(re))}));V(re=>Z(this,[re],function*({newWarehouse:G,oldWarehouse:Y}){H.info(`Event: Warehouse changed from ${Y} to ${G}`),yield ro(G)})),O(Y=>Z(this,[Y],function*({changes:G}){var re;if(H.info("Event: Pricing settings changed",G),G.hasOwnProperty("tax_inclusive")){const P=G.tax_inclusive.new;H.info(`Updating tax_inclusive from ${G.tax_inclusive.old} to ${P}`),l.setTaxInclusive(P);try{H.info("Reloading tax rules with new tax_inclusive setting..."),yield l.loadTaxRules((re=d.currentShift)==null?void 0:re.pos_profile,{tax_inclusive:P}),H.info("Tax rules reloaded successfully")}catch(Me){H.error("Failed to reload tax rules:",Me)}}if(l.invoiceItems.length>0){l.invoiceItems.forEach(Me=>{l.recalculateItem(Me)}),l.rebuildIncrementalCache();const P=G.hasOwnProperty("tax_inclusive")?__("Tax mode updated. Cart recalculated with new tax settings."):__("Discount settings changed. Cart recalculated.");v(P)}else G.hasOwnProperty("tax_inclusive")&&v(G.tax_inclusive.new?__("Prices are now tax-inclusive. This will apply to new items added to cart."):__("Prices are now tax-exclusive. This will apply to new items added to cart."))})),w(({changes:G,requiresReload:Y})=>{if(H.info("Event: Stock policy changed",G),G.allow_negative_stock){const P=G.allow_negative_stock.new?__("Negative stock sales are now allowed"):__("Negative stock sales are now restricted");v(P)}}),y(({changes:G})=>{H.info("Event: Sales operations settings changed",G),T.reloadSettings();const Y={allow_credit_sale:__("Credit Sale"),allow_return:__("Returns"),allow_write_off_change:__("Write Off Change"),allow_partial_payment:__("Partial Payment"),silent_print:__("Silent Print")},re=Object.keys(G).map(P=>Y[P]).filter(Boolean).join(", ");re&&v(__("{0} settings applied immediately",[re]))}),M(Y=>Z(this,[Y],function*({changes:G}){H.info("Event: Settings changed",G),yield T.reloadSettings()})),Qe(c);try{d.startTimers(),(yield d.checkShift())?d.currentProfile&&(l.posProfile=d.profileName,l.posOpeningShift=(q=d.currentShift)==null?void 0:q.name,yield T.loadSettings(d.profileName),H.info("POS Settings loaded:",{allowPartialPayment:T.allowPartialPayment,settings:T.settings}),yield l.loadTaxRules(d.profileName,T.settings),yield l.setDefaultCustomer(),d.profileWarehouse&&p.setWarehouse(d.profileWarehouse),$.isOffline?yield $.checkOfflineCacheAvailability():yield $.preloadDataForOffline(d.currentProfile)):m.showOpenShiftDialog=!0,yt(),yield D.updateDraftsCount()}catch(G){H.error("Error checking shift:",G)}finally{m.setLoading(!1)}})),xe(()=>d.hasOpenShift,u=>{u&&typeof window!="undefined"&&yt()}),xe(()=>Je(),u=>{l.appliedOffers.length!==0&&u!==Re&&(Re=u,ot.value&&clearTimeout(ot.value),ot.value=setTimeout(()=>Z(this,null,function*(){yield l.reapplyOffer(d.currentProfile)}),500))}),xe(()=>l.customer,(u,c)=>{const q=(u==null?void 0:u.name)||u,G=(c==null?void 0:c.name)||c;q!==G&&(ot.value&&clearTimeout(ot.value),ot.value=setTimeout(()=>Z(this,null,function*(){yield l.reapplyOffer(d.currentProfile)}),300))},{deep:!0}),xe(()=>l.appliedOffers.length,()=>{l.invoiceItems.length>0&&(Re=Je())});let A=!1,z=null,pe="";xe(()=>{var Y,re,P;const u=S.allItems,c=d.profileWarehouse,q=u.length,G=q>0?`${((Y=u[0])==null?void 0:Y.item_code)||""}-${((re=u[Math.floor(q/2)])==null?void 0:re.item_code)||""}-${((P=u[q-1])==null?void 0:P.item_code)||""}`:"";return{count:q,warehouse:c,signature:G}},(Y,re)=>Z(this,[Y,re],function*({count:u,warehouse:c,signature:q},G){if(!c||u===0)return;const P=c!==z,Me=q!==pe;!A&&u>0?(H.info(`Items loaded (${u}), configuring periodic stock sync`),yield U(c),A=!0,z=c,pe=q):A&&(P||Me)&&(P?H.info(`Warehouse changed (${z} → ${c}), updating periodic stock sync`):H.info("Items changed (catalog replacement or new items), updating periodic stock sync"),yield St(c),z=c,pe=q)})),Qe(()=>{window.removeEventListener("resize",()=>{m.setWindowWidth(window.innerWidth),yt()}),Vt(),He.stopStockSync().catch(()=>{})});function U(u){return Z(this,null,function*(){var c,q;try{let G=!1,Y=6e4;try{const Be=localStorage.getItem("pos_stock_sync_settings");if(Be){const Ze=JSON.parse(Be);G=(c=Ze.enabled)!=null?c:!1,Y=((q=Ze.intervalSeconds)!=null?q:60)*1e3}}catch(Be){H.error("Failed to load stock sync settings:",Be)}const re=S.allItems.map(Be=>Be.item_code),P=yield He.configureStockSync({warehouse:u,itemCodes:re,intervalMs:Y});if(H.info("Periodic stock sync configured:",P),G){const Be=yield He.startStockSync();H.success("Periodic stock sync started:",Be.status),Ue.value=!0}else H.info("Stock sync is disabled in settings (not starting)"),Ue.value=!1;window.addEventListener("stockSyncComplete",Ie),window.addEventListener("stockSyncError",Le);const Me=setInterval(()=>Z(this,null,function*(){try{const Be=yield He.getStockSyncStatus();Ue.value=Be.enabled}catch(Be){}}),1e4);Qe(()=>{clearInterval(Me)})}catch(G){H.error("Failed to setup periodic stock sync:",G)}})}function Ie(u){return Z(this,null,function*(){const{updated:c,total:q,duration:G}=u.detail;if(H.success(`Background stock sync: ${c}/${q} items updated in ${G}ms`),c>0){try{yield p.refresh(null,d.profileWarehouse)}catch(Y){H.error("Failed to refresh stock after background sync:",Y)}try{const Y=yield He.getCacheStats();S.cacheStats=Y}catch(Y){H.error("Failed to refresh cache stats:",Y)}}})}function Le(u){const{message:c}=u.detail;H.warn("Background stock sync error:",c)}function St(u){return Z(this,null,function*(){try{const c=S.allItems.map(q=>q.item_code);yield He.configureStockSync({warehouse:u,itemCodes:c}),H.info(`Updated periodic stock sync with ${c.length} items`)}catch(c){H.error("Failed to update periodic stock sync items:",c)}})}Qe(()=>{window.removeEventListener("stockSyncComplete",Ie),window.removeEventListener("stockSyncError",Le)});function Lt(){return Z(this,null,function*(){var u;m.showOpenShiftDialog=!1,d.currentProfile&&(l.posProfile=d.profileName,l.posOpeningShift=(u=d.currentShift)==null?void 0:u.name,yield T.loadSettings(d.profileName),yield l.loadTaxRules(d.profileName,T.settings)),v(__("You can now start making sales"))})}function Uo(){m.showCloseShiftDialog=!1,v(__("Shift closed successfully")),Ve.value?(Ve.value=!1,m.resetAllDialogs(),st.logout.submit()):setTimeout(()=>{m.showOpenShiftDialog=!0},500)}function Ho(u,c=!1){var G,Y,re;let q=1;if((G=Se.value)!=null&&G.keypadValue){const P=Number.parseFloat(Se.value.keypadValue);!Number.isNaN(P)&&P>0&&(q=P,Se.value.clearKeypad())}if(c){try{l.addItem(u,q,!0,d.currentProfile)}catch(P){m.showError(__("Insufficient Stock"),P.message,__("Item: {0}",[u.item_code]))}return}if(x.shouldEnforceStockValidation()&&(u.is_stock_item||u.is_bundle)&&!u.has_serial_no&&!u.has_batch_no&&Math.floor((re=(Y=u.actual_qty)!=null?Y:u.stock_qty)!=null?re:0)<=0){b(u.is_bundle?__('"{0}" cannot be added to cart. Bundle is out of stock. Allow Negative Stock is disabled.',[u.item_name]):__('"{0}" cannot be added to cart. Item is out of stock. Allow Negative Stock is disabled.',[u.item_name]));return}if(u.has_variants){l.setPendingItem(u,q,"variant"),m.showItemSelectionDialog=!0;return}if(u.item_uoms&&u.item_uoms.length>0){l.setPendingItem(u,q,"uom"),m.showItemSelectionDialog=!0;return}if(u.has_batch_no||u.has_serial_no){l.setPendingItem(u,q),m.showBatchSerialDialog=!0;return}try{l.addItem(u,q,!1,d.currentProfile),v(__("تمت إضافة {0} × {1}",[q,u.item_name]))}catch(P){m.showError(__("Insufficient Stock"),P.message,__("Item: {0}",[u.item_code]))}}function qo(u){return Z(this,null,function*(){const c=u.row_id||u.item_code;yield l.updateItemDetails(c,u)})}function Wo(u){l.additionalDiscount=u,l.rebuildIncrementalCache()}function Go(u){u?(l.setCustomer(u),m.showCustomerDialog=!1,v(__("{0} selected",[u.customer_name])),X.value&&(X.value=!1,m.showPaymentDialog=!0)):l.setCustomer(null)}function Qo(u){m.setInitialCustomerName(u||""),m.showCreateCustomerDialog=!0}function eo(){return Z(this,null,function*(){if(l.isEmpty){B(__("Please add items to cart before proceeding to payment"));return}try{const{call:u}=yield po(()=>Z(this,null,function*(){const{call:q}=yield import("./index-CLcWQdf2.js").then(G=>G.ag);return{call:q}}),__vite__mapDeps([0,1])),c=yield u("pos_next.api.pos_profile.get_payment_methods",{pos_profile:d.profileName});if(c&&c.length===1){const q=c[0],G={payments:[{mode_of_payment:q.mode_of_payment,amount:l.grandTotal,type:q.type||"Cash"}],change_amount:0,is_partial_payment:!1,paid_amount:l.grandTotal,outstanding_amount:0,autoPrint:!0,silentPrint:!0};yield to(G);return}}catch(u){console.error("Error checking payment methods:",u)}m.showPaymentDialog=!0})}function Yo(){return Z(this,null,function*(){var c;if(!((c=m.errorRetryActionData)!=null&&c.failedInvoiceId))return;const u=m.errorRetryActionData.failedInvoiceId;m.clearError();try{yield $.deleteOfflineInvoice(u)}catch(q){}})}function Jo(){return Z(this,null,function*(){m.clearError(),m.errorRetryAction==="payment"?setTimeout(()=>{m.showPaymentDialog=!0},300):m.errorRetryAction==="sync"&&(yield $.loadPendingInvoices(),setTimeout(()=>{so()},300))})}function to(u){return Z(this,null,function*(){var c,q;try{const G=((c=l.customer)==null?void 0:c.name)||l.customer;if(l.payments=[],u.payments&&Array.isArray(u.payments)&&u.payments.forEach(Y=>{l.payments.push({mode_of_payment:Y.mode_of_payment,amount:Y.amount,type:Y.type})}),u.sales_team&&Array.isArray(u.sales_team)?l.salesTeam=u.sales_team:l.salesTeam=[],$.isOffline){const Y={pos_profile:l.posProfile,posa_pos_opening_shift:l.posOpeningShift,customer:G||d.profileCustomer,items:JSON.parse(JSON.stringify(l.invoiceItems)),payments:JSON.parse(JSON.stringify(l.payments)),sales_team:JSON.parse(JSON.stringify(l.salesTeam||[])),grand_total:l.grandTotal,total_tax:l.totalTax,total_discount:l.totalDiscount};yield $.saveInvoiceOffline(Y),m.showSuccess(`OFFLINE-${Date.now()}`,l.grandTotal),m.showPaymentDialog=!1,l.clearCart(),Re="",v(__("Invoice saved offline. Will sync when online"))}else{const Y=l.invoiceItems.map(P=>P.item_code),re=yield l.submitInvoice();if(re){const P=re.name||((q=re.message)==null?void 0:q.name)||__("Unknown"),Me=re.grand_total||re.total||0;m.showPaymentDialog=!1,l.clearCart(),Re="";const Be=d.autoPrintEnabled||u.autoPrint;if(u.autoPrint){const Ze=u.silentPrint?{silentPrint:!0}:{};bt(We({name:P},Ze)).catch(Is=>{H.error("Auto-print error:",Is)})}else if(Be)try{yield bt({name:P}),v(__("Invoice {0} created and sent to printer",[P]))}catch(Ze){H.error("Auto-print error:",Ze),B(__("Invoice {0} created but print failed",[P]))}else m.showSuccess(P,Me),v(__("Invoice {0} created successfully",[P]));p.refresh(Y,d.profileWarehouse).catch(Ze=>{H.error("Background stock refresh failed:",Ze)})}}}catch(G){H.error("Error submitting invoice:",G),m.showPaymentDialog=!1;const Y=Ut(G);m.showError(Y.title||__("Error"),Y.message||__("An unexpected error occurred"),Y.technicalDetails||null,Y.retryable?"payment":null),Y.type==="error"?b(Y.message):(Y.type,B(Y.message))}})}function Ko(){l.isEmpty||(m.showClearCartDialog=!0)}function Xo(){l.clearCart(),Re="",m.showClearCartDialog=!1,v(__("All items removed from cart"))}function Zo(u){return Z(this,null,function*(){var c;if(l.pendingItem)try{if(u.type==="variant"){const q=u.data;if(q.item_uoms&&q.item_uoms.length>0){l.setPendingItem(q,l.pendingItemQty,"uom");return}if(q.has_batch_no||q.has_serial_no)l.setPendingItem(q,l.pendingItemQty),m.showItemSelectionDialog=!1,m.showBatchSerialDialog=!0;else try{l.addItem(q,l.pendingItemQty,!1,d.currentProfile),m.showItemSelectionDialog=!1,l.clearPendingItem(),v(__("{0} added to cart",[q.item_name]))}catch(G){b(G.message)}}else if(u.type==="uom"){const q=yield l.getItemDetailsResource.submit({item_code:l.pendingItem.item_code,pos_profile:l.posProfile,customer:((c=l.customer)==null?void 0:c.name)||l.customer,qty:l.pendingItemQty,uom:u.uom}),G=lt(We({},l.pendingItem),{uom:u.uom,conversion_factor:u.conversion_factor,rate:q.price_list_rate||q.rate,price_list_rate:q.price_list_rate});if(G.has_batch_no||G.has_serial_no)l.setPendingItem(G,l.pendingItemQty),m.showItemSelectionDialog=!1,m.showBatchSerialDialog=!0;else try{l.addItem(G,l.pendingItemQty,!1,d.currentProfile),m.showItemSelectionDialog=!1,l.clearPendingItem(),v(__("{0} ({1}) added to cart",[G.item_name,u.uom]))}catch(Y){b(Y.message)}}}catch(q){H.error("Error handling option selection:",q),b(__("Failed to process selection. Please try again."))}})}function Ft(){m.showCloseShiftDialog=!0}function It(){Ve.value=!1,l.clearCart(),m.resetAllDialogs(),st.logout.submit()}function es(){Ve.value=!0,m.showLogoutDialog=!1,m.showCloseShiftDialog=!0}function ts(){return Z(this,null,function*(){if(l.itemCount===0||l.invoiceItems.length===0){m.showDraftDialog=!0;return}(yield D.saveDraftInvoice(l.invoiceItems,l.customer,l.posProfile,l.appliedOffers))&&(l.clearCart(),Re="")})}function oo(u){return Z(this,null,function*(){try{const c=yield D.loadDraft(u);l.invoiceItems=c.items,l.setCustomer(c.customer),l.rebuildIncrementalCache(),c.applied_offers&&c.applied_offers.length>0&&(l.appliedOffers=c.applied_offers,yield l.reapplyOffer(d.currentProfile)),Re=Je(),m.showDraftDialog=!1}catch(c){H.error("Error loading draft:",c)}})}function os(u){v(__("Return invoice {0} created successfully",[u.name]))}function ss(u){l.applyDiscountToCart(u),m.showCouponDialog=!1}function as(){l.removeDiscountFromCart()}function ls(u){return Z(this,null,function*(){(yield l.applyOffer(u,d.currentProfile,ue.value))&&(m.showOffersDialog=!1)})}function ns(u){if(l.pendingItem){const c=u.quantity||l.pendingItemQty,q=We(lt(We({},l.pendingItem),{quantity:c}),u);try{l.addItem(q,c,!1,d.currentProfile),l.clearPendingItem()}catch(G){b(G.message)}}}function rs(u){m.showReturnDialog=!0,B(__("Creating return for invoice {0}",[u.name]))}function is(u){l.setCustomer(u),m.showCreateCustomerDialog=!1,v(__("{0} created and selected",[u.customer_name]))}function us(u){return Z(this,null,function*(){if(!u){b(__("Please select an image file"));return}if(!u.type.startsWith("image/")){b(__("Please select a valid image file"));return}B(__("Searching by image..."));try{const c=new FileReader;c.onload=q=>Z(this,null,function*(){try{const G=q.target.result;try{const Y=yield wt("pos_next.api.items.search_by_image",{image:G,pos_profile:d.currentProfile});let re=[];Array.isArray(Y)?re=Y:Y&&Y.message&&Array.isArray(Y.message)?re=Y.message:Y&&Array.isArray(Y.data)&&(re=Y.data),re.length>0?(S.setSearchResults(re),S.searchTerm=`[Image Search: ${re.length} results]`,v(__("Found {0} items matching the image",[re.length]))):B(__("No items found matching the image. Try uploading a clearer image or use text search."))}catch(Y){console.error("Image search API error:",Y);const re=(Y==null?void 0:Y.message)||(Y==null?void 0:Y.exc)||String(Y);re.includes("module")&&re.includes("has no attribute")?b(__("Image search feature is not available. Please contact administrator.")):re.includes("ImportError")||re.includes("not available")?B(__("Image search requires additional libraries. Please contact administrator.")):B(__("Failed to search by image: {0}. Please try again or use text search.",[re.substring(0,50)]))}}catch(G){console.error("Error processing image:",G),b(__("Failed to process image. Please try again."))}}),c.onerror=()=>{b(__("Failed to read image file. Please try again."))},c.readAsDataURL(u)}catch(c){console.error("Error handling image search:",c),b(__("Failed to process image. Please try again."))}})}function ds(){return Z(this,null,function*(){try{H.info("Manual stock refresh initiated"),yield p.refresh(null,d.profileWarehouse);const u=yield He.getCacheStats();S.cacheStats=u,H.success("Manual stock refresh completed")}catch(u){H.error("Manual stock refresh failed:",u)}})}function cs(){je.value=!0}function ms(){return Z(this,null,function*(){try{H.info("Clearing cached data...");const{clearCachedData:u,clearBrowserCache:c}=yield po(()=>Z(this,null,function*(){const{clearCachedData:Y,clearBrowserCache:re}=yield import("./index-CLcWQdf2.js").then(P=>P.ah);return{clearCachedData:Y,clearBrowserCache:re}}),__vite__mapDeps([0,1])),q=yield u({preserveInvoices:!0,preserveDrafts:!0,preserveSettings:!0}),G=c();if(q.success&&G.success){H.success("Cache cleared successfully",{db:q.cleared,browser:G.cleared}),S.invalidateCache(),$e.value&&(yield $e.value.loadItems()),yield p.refresh(null,d.profileWarehouse);const Y=yield He.getCacheStats();S.cacheStats=Y,je.value=!1,qe.value&&qe.value.reset(),v(__("All cached data has been cleared successfully"))}else throw new Error("Failed to clear cache completely")}catch(u){H.error("Error clearing cache:",u),je.value=!1,qe.value&&qe.value.reset(),b(__("Failed to clear cache. Please try again."))}})}function vs(u){return Z(this,null,function*(){try{l.clearCart();const c=u.data;if(c.customer&&l.setCustomer(c.customer),c.items&&c.items.length>0)for(const q of c.items)l.addItem(q,q.quantity||q.qty||1,!0,d.currentProfile);Re=Je(),yield $.deleteOfflineInvoice(u.id),v(__("Invoice loaded to cart for editing"))}catch(c){H.error("Error editing offline invoice:",c)}})}function ps(u){return Z(this,null,function*(){try{yield $.deleteOfflineInvoice(u)}catch(c){H.error("Error deleting offline invoice:",c)}})}function so(){return Z(this,null,function*(){if($.hasPendingInvoices){yield $.loadPendingInvoices(),m.showOfflineInvoicesDialog=!0;return}v(__("No pending invoices to sync"))})}function fs(){return Z(this,null,function*(){if($.isOffline){B(__("Cannot sync while offline"));return}try{const u=yield $.syncAllPending();if(u.success>0&&$e.value&&(yield $e.value.loadItems()),u.failed>0&&u.errors&&u.errors.length>0){const c=u.errors[0],q=Ut(c.error);m.showError(q.title,__(`Failed to sync invoice for {0}

\${1}

You can delete this invoice from the offline queue if you don't need it.`,[c.customer,q.message]),q.technicalDetails||__("Invoice ID: {0}",[c.invoiceId]),"sync",{failedInvoiceId:c.invoiceId})}else u.failed>0&&B(__("{0} invoice(s) failed to sync",[u.failed]))}catch(u){H.error("Sync error:",u);const c=Ut(u);m.showError(c.title,c.message,c.technicalDetails,"sync")}})}function yt(){if(!f.value)return;const u=f.value.offsetWidth;m.updateLayoutBounds(u)}function gs(u){var c,q,G,Y;!f.value||!R.value||u.isPrimary!==!1&&(u.button!==void 0&&u.button!==0&&u.pointerType!=="touch"||(yt(),Te={pointerId:u.pointerId,startX:u.clientX,startWidth:a.value,containerWidth:(q=(c=f.value)==null?void 0:c.offsetWidth)!=null?q:1120},m.setResizing(!0),k={cursor:document.body.style.cursor,userSelect:document.body.style.userSelect},document.addEventListener("pointermove",ao),document.addEventListener("pointerup",Vt),document.addEventListener("pointercancel",Vt),(Y=(G=R.value).setPointerCapture)==null||Y.call(G,u.pointerId),document.body.style.cursor="col-resize",document.body.style.userSelect="none",u.preventDefault()))}function ao(u){var Me,Be,Ze;if(!m.isResizing||!Te||((Me=u.pointerId)!=null?Me:Te.pointerId)!==Te.pointerId)return;u.preventDefault();const c=(Ze=(Be=f.value)==null?void 0:Be.offsetWidth)!=null?Ze:Te.containerWidth;Te.containerWidth=c;const q=u.clientX-Te.startX,G=ve.value?q:-q,Y=Te.startWidth+G,re=350,P=c*.5;a.value=Math.max(re,Math.min(P,Y))}function Vt(u){var c,q;!m.isResizing||!Te||(u==null?void 0:u.pointerId)!==void 0&&u.pointerId!==Te.pointerId||(u!=null&&u.preventDefault&&u.preventDefault(),document.removeEventListener("pointermove",ao),document.removeEventListener("pointerup",Vt),document.removeEventListener("pointercancel",Vt),(q=(c=R.value)==null?void 0:c.hasPointerCapture)!=null&&q.call(c,Te.pointerId)&&R.value.releasePointerCapture(Te.pointerId),m.setResizing(!1),Te=null,hs(),yt())}function hs(){k&&(document.body.style.cursor=k.cursor||"",document.body.style.userSelect=k.userSelect||"",k=null)}function _s(u){u==="promotions"?Ee.value=!0:u==="settings"?rt.value=!0:u==="invoices"&&(lo(),Ke.value=!0)}function lo(){return Z(this,null,function*(){H.info("Loading invoice history data for profile:",d.profileName);try{const u=yield wt("pos_next.api.invoices.get_invoices",{pos_profile:d.profileName,limit:100});Xe.value=u||[],H.info("Loaded invoice history:",Xe.value.length,"invoices")}catch(u){H.error("Error loading invoice history:",u),Xe.value=[]}})}function no(u){gt.value=u.name||u,mt.value=!0}function bt(u){return Z(this,null,function*(){var c;try{const q=u.silentPrint===!0;u.items&&Array.isArray(u.items)?yield ra(u):yield ia(u.name,null,null,q)}catch(q){H.error("Error printing invoice:",q),(c=window.frappe)==null||c.msgprint({title:"Error",message:"Failed to print invoice",indicator:"red"})}})}function ys(u){oo(u),Ke.value=!1}function bs(u){D.deleteDraft(u)}function ro(u){return Z(this,null,function*(){H.info("Warehouse changed to:",u);try{d.currentProfile&&(d.currentProfile.warehouse=u),S.invalidateCache(),$e.value&&(yield $e.value.loadItems()),v(__("Switched to {0}. Stock quantities refreshed.",[u]))}catch(c){H.error("Error handling warehouse change:",c),B(__("Warehouse updated but failed to reload stock. Please refresh manually."))}})}function xs(u){v(u.message||__("Promotion saved successfully"))}function io(u){requestAnimationFrame(()=>{m.setMobileTab(u)})}function ws(){var u;(u=Se.value)==null||u.triggerAdd()}function ks(){var u;if((u=window.frappe)!=null&&u.user&&!window.frappe.user.has_role("System Manager")){b(__("You don't have permission to view today's orders"));return}m.showHistoryDialog=!0}function $s(){rt.value=!0}function Cs(u){var c;u==="Delivery"?m.showCustomerDialog=!0:u==="Dine In"?uo():u==="Takeaway"&&(l.clearCart(),(c=Se.value)==null||c.clearKeypad(),v(__("تم مسح الأصناف - تيك أواي")))}function uo(){v(__("Table selection will be available soon"))}function Ss(){return Z(this,null,function*(){var u,c,q,G,Y;try{let re=!1;if((u=window.frappe)!=null&&u.user_roles)re=window.frappe.user_roles.includes("System Manager");else if((q=(c=window.frappe)==null?void 0:c.user)!=null&&q.has_role)re=window.frappe.user.has_role("System Manager");else{const P=yield wt("frappe.client.get_list",{doctype:"Has Role",filters:{parent:((Y=(G=window.frappe)==null?void 0:G.session)==null?void 0:Y.user)||st.user||"",role:"System Manager"},limit_page_length:1});re=P&&P.length>0}if(!re){b(__("ليس لديك صلاحية لإضافة خصم. هذه الخاصية متاحة فقط لمدير النظام."));return}ne.value="percentage",ae.value=0,he.value="manual",oe.value="",te.value=!0,_e()}catch(re){console.error("Error checking discount permission:",re),ne.value="percentage",ae.value=0,he.value="manual",te.value=!0,_e()}})}return(u,c)=>{var G,Y,re;const q=Ea;return s(),n("div",p2,[o(m).isLoading?(s(),ie(Ks,{key:0})):(s(),n(ce,{key:1},[h(Nn,{ref_key:"posHeaderRef",ref:me,"current-time":o(d).currentTime,"shift-duration":o(d).shiftDuration,"has-open-shift":o(d).hasOpenShift,"profile-name":o(d).profileName,"user-name":o(F),"user-image":o(j),"is-offline":o($).isOffline,"is-syncing":o($).isSyncing,"pending-invoices-count":o($).pendingInvoicesCount,"is-any-dialog-open":o(m).isAnyDialogOpen,"cache-syncing":o(S).cacheSyncing,"cache-stats":o(S).cacheStats,"stock-sync-active":Ue.value,"is-refreshing":o(p).refreshing,onSyncClick:so,onPrinterClick:c[6]||(c[6]=P=>o(m).showHistoryDialog=!0),onRefreshClick:ds,onClearCache:cs,onLogout:It,onHeaderCollapsed:we},{"menu-items":E(()=>[o(d).hasOpenShift?(s(),n("button",{key:0,onClick:c[0]||(c[0]=P=>o(m).showOpenShiftDialog=!0),class:"w-full text-start px-4 py-2.5 text-sm text-gray-700 hover:bg-blue-50 flex items-center gap-3 transition-colors"},[c[61]||(c[61]=e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,t(u.__("View Shift")),1)])):I("",!0),e("button",{onClick:c[1]||(c[1]=P=>o(m).showDraftDialog=!0),class:"w-full text-start px-4 py-2.5 text-sm text-gray-700 hover:bg-purple-50 flex items-center gap-3 transition-colors relative"},[c[62]||(c[62]=e("svg",{class:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("span",null,t(u.__("Draft Invoices")),1),o(D).draftsCount>0?(s(),n("span",f2,t(o(D).draftsCount),1)):I("",!0)]),e("button",{onClick:c[2]||(c[2]=P=>o(m).showHistoryDialog=!0),class:"w-full text-start px-4 py-2.5 text-sm text-gray-700 hover:bg-indigo-50 flex items-center gap-3 transition-colors"},[c[63]||(c[63]=e("svg",{class:"w-5 h-5 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("span",null,t(u.__("Invoice History")),1)]),o($).pendingInvoicesCount>0?(s(),n("button",{key:1,onClick:c[3]||(c[3]=P=>{o(m).showOfflineInvoicesDialog=!0,o($).loadPendingInvoices()}),class:"w-full text-start px-4 py-2.5 text-sm text-gray-700 hover:bg-orange-50 flex items-center gap-3 transition-colors relative"},[c[64]||(c[64]=e("svg",{class:"w-5 h-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,t(u.__("Offline Invoices")),1),e("span",g2,t(o($).pendingInvoicesCount),1)])):I("",!0),e("button",{onClick:c[4]||(c[4]=P=>o(m).showReturnDialog=!0),class:"w-full text-start px-4 py-2.5 text-sm text-gray-700 hover:bg-red-50 flex items-center gap-3 transition-colors"},[c[65]||(c[65]=e("svg",{class:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1)),e("span",null,t(u.__("Return Invoice")),1)])]),"additional-actions":E(()=>[e("button",{onClick:c[5]||(c[5]=P=>Ft()),class:"w-full text-start px-4 py-2.5 text-sm text-gray-700 hover:bg-orange-50 flex items-center gap-3 transition-colors"},[c[66]||(c[66]=e("svg",{class:"w-5 h-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,t(u.__("Close Shift")),1)])]),_:1},8,["current-time","shift-duration","has-open-shift","profile-name","user-name","user-image","is-offline","is-syncing","pending-invoices-count","is-any-dialog-open","cache-syncing","cache-stats","stock-sync-active","is-refreshing"]),L.value?(s(),n("button",{key:0,onClick:J,class:"fixed top-2 left-2 z-[300] w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-110 active:scale-95 touch-manipulation",title:u.__("Show Header"),"aria-label":u.__("Show Header")},c[67]||(c[67]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"})],-1)]),8,h2)):I("",!0),o(d).hasOpenShift?(s(),n("div",{key:1,class:"flex-1 flex overflow-hidden relative",style:Tt({maxHeight:`calc(100vh - ${le.value}px)`}),ref_key:"mainContentRef",ref:K},[h(dl,{onMenuClicked:_s}),e("div",{ref_key:"containerRef",ref:f,class:"flex-1 flex flex-col lg:flex-row overflow-hidden relative"},[e("div",_2,[e("button",{onClick:c[7]||(c[7]=P=>io("items")),class:N(["flex-1 px-3 py-3 text-sm font-semibold transition-[color,background-color,border-color] duration-100 relative touch-manipulation",o(m).mobileActiveTab==="items"?"text-blue-600 border-b-3 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-800 hover:bg-gray-50 active:bg-gray-100"]),"aria-label":u.__("View items"),"aria-selected":o(m).mobileActiveTab==="items",role:"tab"},[e("div",b2,[c[68]||(c[68]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1)),e("span",null,t(u.__("Items")),1)])],10,y2),e("button",{onClick:c[8]||(c[8]=P=>io("cart")),class:N(["flex-1 px-3 py-3 text-sm font-semibold transition-[color,background-color,border-color] duration-100 relative touch-manipulation",o(m).mobileActiveTab==="cart"?"text-blue-600 border-b-3 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-800 hover:bg-gray-50 active:bg-gray-100"]),"aria-label":u.__("View cart"),"aria-selected":o(m).mobileActiveTab==="cart",role:"tab"},[e("div",w2,[c[69]||(c[69]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})],-1)),e("span",null,t(u.__("Cart")),1),o(l).itemCount>0?(s(),n("span",k2,t(o(l).itemCount),1)):I("",!0)])],10,x2)]),(s(),ie(vo,null,[o(m).isDesktop||o(m).mobileActiveTab==="items"?(s(),n("div",$2,[h(jd,{customer:o(l).customer,"pos-profile":o(d).profileName,ref_key:"itemsSelectorRef",ref:$e,"cart-items":o(l).invoiceItems,currency:o(d).profileCurrency,onItemSelected:Ho,onSelectCustomer:c[9]||(c[9]=P=>o(m).showCustomerDialog=!0),onShowHistory:c[10]||(c[10]=P=>o(m).showHistoryDialog=!0),onCloseShift:Ft,onLogout:It,onShowTodayOrders:ks,onShowTools:$s,onAddComment:c[11]||(c[11]=P=>{var Me;return(Me=Se.value)==null?void 0:Me.openCommentDialog()}),onSetOrderType:Cs,onSelectTable:uo,onShowDiscount:Ss,onTriggerRemoveItem:c[12]||(c[12]=P=>{var Me;return(Me=Se.value)==null?void 0:Me.removeSelectedItem()}),onTriggerAddItem:ws,onFinishBill:eo,onAddImage:us},null,8,["customer","pos-profile","cart-items","currency"])])):I("",!0)],1024)),o(m).isDesktop?(s(),ie(i2,{key:0,"item-groups":o(S).itemGroups,modelValue:o(S).selectedItemGroup,"onUpdate:modelValue":c[13]||(c[13]=P=>o(S).selectedItemGroup=P),class:"flex-shrink-0 h-full overflow-y-auto bg-white border-l border-gray-300"},null,8,["item-groups","modelValue"])):I("",!0),o(m).isDesktop?(s(),n("div",{key:1,ref_key:"dividerRef",ref:R,onPointerdown:gs,class:N(["w-1 bg-gray-300 hover:bg-blue-500 cursor-col-resize flex-shrink-0 transition-colors relative group",{"bg-blue-500":o(m).isResizing}]),style:{"touch-action":"none"}},c[70]||(c[70]=[e("div",{class:"absolute inset-y-0 -left-1 -right-1"},null,-1),e("div",{class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-blue-500 group-hover:bg-blue-600 rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"},[e("svg",{class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4m0 6l-4 4-4-4"})])],-1)]),34)):I("",!0),(s(),ie(vo,null,[o(m).isDesktop||o(m).mobileActiveTab==="cart"?(s(),n("div",{key:0,class:"flex flex-col bg-gray-50 overflow-hidden flex-shrink-0",style:Tt([{width:o(m).isDesktop?`${a.value}px`:"auto"},{contain:"layout style paint"}])},[h(zr,{ref_key:"invoiceCartRef",ref:Se,items:o(l).invoiceItems,customer:o(l).customer,subtotal:o(l).subtotal,"tax-amount":o(l).totalTax,"discount-amount":o(l).totalDiscount,"grand-total":o(l).grandTotal,"pos-profile":o(d).profileName,currency:o(d).profileCurrency,"applied-offers":o(l).appliedOffers,warehouses:_t.value,onUpdateQuantity:o(l).updateItemQuantity,onRemoveItem:o(l).removeItem,onSelectCustomer:c[14]||(c[14]=P=>o(m).showCustomerDialog=!0),onCreateCustomer:Qo,onProceedToPayment:eo,onClearCart:Ko,onSaveDraft:ts,onApplyCoupon:c[15]||(c[15]=P=>o(m).showCouponDialog=!0),onShowOffers:c[16]||(c[16]=P=>o(m).showOffersDialog=!0),onRemoveOffer:c[17]||(c[17]=P=>o(l).removeOffer(P,o(d).currentProfile,ue.value.value)),onUpdateUom:o(l).changeItemUOM,onEditItem:qo,onViewShift:c[18]||(c[18]=P=>o(m).showOpenShiftDialog=!0),onShowDrafts:c[19]||(c[19]=P=>o(m).showDraftDialog=!0),onShowHistory:c[20]||(c[20]=P=>o(m).showHistoryDialog=!0),onShowReturn:c[21]||(c[21]=P=>o(m).showReturnDialog=!0),onCloseShift:c[22]||(c[22]=P=>Ft()),onLogout:It},null,8,["items","customer","subtotal","tax-amount","discount-amount","grand-total","pos-profile","currency","applied-offers","warehouses","onUpdateQuantity","onRemoveItem","onUpdateUom"])],4)):I("",!0)],1024)),!o(m).isDesktop&&o(m).mobileActiveTab==="items"&&o(l).itemCount>0?(s(),n("button",{key:2,onClick:c[23]||(c[23]=P=>o(m).setMobileTab("cart")),class:"lg:hidden fixed bottom-20 end-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-full p-4 shadow-2xl hover:shadow-3xl hover:from-blue-700 hover:to-blue-800 active:from-blue-800 active:to-blue-900 transition-[background,box-shadow,transform] duration-200 z-50 touch-manipulation active:scale-95 ring-4 ring-blue-100","aria-label":u.__("View cart with {0} items",[o(l).itemCount])},[e("div",S2,[c[71]||(c[71]=e("svg",{class:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2.5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})],-1)),e("span",I2,t(o(l).itemCount),1)])],8,C2)):I("",!0),h(q)],512)],4)):(s(),n("div",{key:2,class:"flex-1 flex items-center justify-center bg-gray-50",style:Tt({maxHeight:`calc(100vh - ${le.value}px)`})},[e("div",V2,[c[72]||(c[72]=e("div",{class:"mx-auto flex items-center justify-center h-24 w-24 rounded-full bg-blue-100"},[e("svg",{class:"h-12 w-12 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("h3",D2,t(u.__("Welcome to INTouch POS")),1),e("p",M2,t(u.__("Please open a shift to start making sales")),1),h(o(fe),{variant:"solid",theme:"blue",onClick:c[24]||(c[24]=P=>o(m).showOpenShiftDialog=!0),class:"mt-6"},{default:E(()=>[Q(t(u.__("Open Shift")),1)]),_:1})])],4)),h(Lo,{modelValue:o(m).showPaymentDialog,"onUpdate:modelValue":c[25]||(c[25]=P=>o(m).showPaymentDialog=P),"grand-total":o(l).grandTotal,subtotal:o(l).subtotal,"pos-profile":o(d).profileName,currency:o(d).profileCurrency,"is-offline":o($).isOffline,"allow-partial-payment":o(T).allowPartialPayment,"allow-credit-sale":o(T).allowCreditSale,customer:o(l).customer,company:o(d).profileCompany,"additional-discount":o(l).additionalDiscount,onPaymentCompleted:to,onUpdateAdditionalDiscount:Wo},null,8,["modelValue","grand-total","subtotal","pos-profile","currency","is-offline","allow-partial-payment","allow-credit-sale","customer","company","additional-discount"]),h(jo,{modelValue:o(m).showCustomerDialog,"onUpdate:modelValue":c[26]||(c[26]=P=>o(m).showCustomerDialog=P),"pos-profile":o(d).profileName,onCustomerSelected:Go},null,8,["modelValue","pos-profile"]),h(Fs,{modelValue:o(m).showOpenShiftDialog,"onUpdate:modelValue":c[27]||(c[27]=P=>o(m).showOpenShiftDialog=P),onShiftOpened:Lt},null,8,["modelValue"]),h(Rs,{modelValue:o(m).showCloseShiftDialog,"onUpdate:modelValue":c[28]||(c[28]=P=>o(m).showCloseShiftDialog=P),"opening-shift":(G=o(d).currentShift)==null?void 0:G.name,onShiftClosed:Uo},null,8,["modelValue","opening-shift"]),h(Xs,{modelValue:o(m).showDraftDialog,"onUpdate:modelValue":c[29]||(c[29]=P=>o(m).showDraftDialog=P),currency:o(d).profileCurrency,onLoadDraft:oo,onDraftsUpdated:o(D).updateDraftsCount},null,8,["modelValue","currency","onDraftsUpdated"]),h(Zs,{modelValue:o(m).showReturnDialog,"onUpdate:modelValue":c[30]||(c[30]=P=>o(m).showReturnDialog=P),"pos-profile":o(d).profileName,currency:o(d).profileCurrency,onReturnCreated:os},null,8,["modelValue","pos-profile","currency"]),h(ea,{modelValue:o(m).showCouponDialog,"onUpdate:modelValue":c[31]||(c[31]=P=>o(m).showCouponDialog=P),subtotal:o(l).subtotal,items:o(l).invoiceItems,"pos-profile":o(d).profileName,customer:((Y=o(l).customer)==null?void 0:Y.name)||o(l).customer,company:o(d).profileCompany,currency:o(d).profileCurrency,"applied-coupon":o(l).appliedCoupon,onDiscountApplied:ss,onDiscountRemoved:as},null,8,["modelValue","subtotal","items","pos-profile","customer","company","currency","applied-coupon"]),h(o(it),{modelValue:te.value,"onUpdate:modelValue":c[38]||(c[38]=P=>te.value=P),options:{title:u.__("إضافة خصم"),size:"lg"}},{"body-content":E(()=>[e("div",P2,[e("div",T2,[e("button",{onClick:c[32]||(c[32]=P=>he.value="manual"),class:N(["flex-1 py-2 px-4 rounded-t-lg font-bold text-sm transition-all border-b-2",he.value==="manual"?"border-blue-600 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700"])},t(u.__("خصم يدوي")),3),e("button",{onClick:c[33]||(c[33]=P=>he.value="coupon"),class:N(["flex-1 py-2 px-4 rounded-t-lg font-bold text-sm transition-all border-b-2",he.value==="coupon"?"border-purple-600 text-purple-600 bg-purple-50":"border-transparent text-gray-500 hover:text-gray-700"])},t(u.__("كوبون")),3)]),he.value==="manual"?(s(),n("div",A2,[e("div",j2,[e("button",{onClick:c[34]||(c[34]=P=>ne.value="percentage"),class:N(["flex-1 py-3 px-4 rounded-lg font-bold text-lg transition-all",ne.value==="percentage"?"bg-blue-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},t(u.__("نسبة %")),3),e("button",{onClick:c[35]||(c[35]=P=>ne.value="amount"),class:N(["flex-1 py-3 px-4 rounded-lg font-bold text-lg transition-all",ne.value==="amount"?"bg-green-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},t(u.__("مبلغ")),3)]),e("div",L2,[e("label",B2,t(ne.value==="percentage"?u.__("نسبة الخصم (%)"):u.__("مبلغ الخصم")),1),e("div",{class:N(["w-full text-3xl font-bold text-center border-2 border-gray-300 rounded-lg p-4 bg-white min-h-[60px] flex items-center justify-center",ae.value>0?"border-blue-500 text-blue-600":"text-gray-400"])},t(ae.value||"0")+t(ne.value==="percentage"?" %":""),3)]),e("div",O2,[(s(),n(ce,null,ge(["7","8","9","4","5","6","1","2","3",".","0","C"],P=>e("button",{key:P,onClick:Me=>se(P),class:N(["py-4 text-xl font-bold rounded-lg transition-all active:scale-95",P==="C"?"bg-red-100 text-red-600 hover:bg-red-200":"bg-gray-100 text-gray-800 hover:bg-gray-200"])},t(P==="C"?u.__("مسح"):P),11,E2)),64))]),ne.value==="percentage"?(s(),n("div",z2,[(s(),n(ce,null,ge([5,10,15,20,25,50],P=>e("button",{key:P,onClick:Me=>ae.value=P,class:"flex-1 py-2 text-sm font-bold rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 transition-all"},t(P)+"% ",9,N2)),64))])):I("",!0),ae.value>0?(s(),n("div",F2,[e("div",R2,[e("span",U2,t(u.__("الإجمالي الحالي:")),1),e("span",H2,t(W(o(l).subtotal)),1)]),e("div",q2,[e("span",null,t(u.__("قيمة الخصم:")),1),e("span",W2,"- "+t(W(Pe.value)),1)]),e("div",G2,[e("span",null,t(u.__("الإجمالي بعد الخصم:")),1),e("span",Q2,t(W(o(l).subtotal-Pe.value)),1)])])):I("",!0)])):I("",!0),he.value==="coupon"?(s(),n("div",Y2,[e("div",J2,[e("label",K2,t(u.__("كود الكوبون")),1),e("div",X2,[dt(e("input",{"onUpdate:modelValue":c[36]||(c[36]=P=>oe.value=P),type:"text",class:"flex-1 text-lg font-bold text-center border-2 border-gray-300 rounded-lg p-3 focus:border-purple-500 focus:outline-none uppercase",placeholder:u.__("أدخل كود الكوبون"),onKeydown:Jt(De,["enter"])},null,40,Z2),[[vt,oe.value]]),h(o(fe),{onClick:De,loading:Ce.value,theme:"purple",variant:"solid",class:"px-6"},{default:E(()=>[Q(t(u.__("تطبيق")),1)]),_:1},8,["loading"])])]),be.value.length>0?(s(),n("div",ey,[e("label",ty,t(u.__("الكوبونات المتاحة")),1),e("div",oy,[(s(!0),n(ce,null,ge(be.value,P=>(s(),n("button",{key:P.name,onClick:Me=>r(P),class:"flex items-center justify-between p-3 bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100 transition-all text-start"},[e("div",null,[e("div",ay,t(P.coupon_code),1),e("div",ly,t(P.coupon_name||P.description),1)]),c[73]||(c[73]=e("svg",{class:"w-5 h-5 text-purple-600",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1))],8,sy))),128))])])):(s(),n("div",ny,[c[74]||(c[74]=e("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"})],-1)),e("p",null,t(u.__("لا توجد كوبونات متاحة حالياً")),1),e("p",ry,t(u.__("أدخل كود الكوبون يدوياً")),1)]))])):I("",!0)])]),actions:E(()=>[e("div",iy,[h(o(fe),{variant:"subtle",class:"flex-1",onClick:c[37]||(c[37]=P=>te.value=!1)},{default:E(()=>[Q(t(u.__("إلغاء")),1)]),_:1}),he.value==="manual"?(s(),ie(o(fe),{key:0,variant:"solid",theme:"blue",class:"flex-1",onClick:_,disabled:!ae.value||ae.value<=0},{default:E(()=>[Q(t(u.__("تطبيق الخصم")),1)]),_:1},8,["disabled"])):I("",!0)])]),_:1},8,["modelValue","options"]),h(ta,{ref_key:"offersDialogRef",ref:ue,modelValue:o(m).showOffersDialog,"onUpdate:modelValue":c[39]||(c[39]=P=>o(m).showOffersDialog=P),subtotal:o(l).subtotal,items:o(l).invoiceItems,"pos-profile":o(d).profileName,customer:((re=o(l).customer)==null?void 0:re.name)||o(l).customer,company:o(d).profileCompany,currency:o(d).profileCurrency,"applied-offers":o(l).appliedOffers,onApplyOffer:ls,onRemoveOffer:c[40]||(c[40]=P=>o(l).removeOffer(P,o(d).currentProfile,ue.value.value))},null,8,["modelValue","subtotal","items","pos-profile","customer","company","currency","applied-offers"]),h(oa,{modelValue:o(m).showBatchSerialDialog,"onUpdate:modelValue":c[41]||(c[41]=P=>o(m).showBatchSerialDialog=P),item:o(l).pendingItem,quantity:o(l).pendingItemQty,warehouse:o(d).profileWarehouse,onBatchSerialSelected:ns},null,8,["modelValue","item","quantity","warehouse"]),h(sa,{modelValue:o(m).showItemSelectionDialog,"onUpdate:modelValue":c[42]||(c[42]=P=>o(m).showItemSelectionDialog=P),item:o(l).pendingItem,mode:o(l).selectionMode,"pos-profile":o(d).profileName,currency:o(d).profileCurrency,onOptionSelected:Zo},null,8,["modelValue","item","mode","pos-profile","currency"]),h(aa,{modelValue:o(m).showHistoryDialog,"onUpdate:modelValue":c[43]||(c[43]=P=>o(m).showHistoryDialog=P),"pos-profile":o(d).profileName,currency:o(d).profileCurrency,onCreateReturn:rs,onViewInvoice:no,onPrintInvoice:bt},null,8,["modelValue","pos-profile","currency"]),h(la,{modelValue:o(m).showOfflineInvoicesDialog,"onUpdate:modelValue":c[44]||(c[44]=P=>o(m).showOfflineInvoicesDialog=P),"is-offline":o($).isOffline,"pending-invoices":o($).pendingInvoicesList,"is-syncing":o($).isSyncing,currency:o(d).profileCurrency,onSyncAll:fs,onDeleteInvoice:ps,onEditInvoice:vs,onRefresh:o($).loadPendingInvoices},null,8,["modelValue","is-offline","pending-invoices","is-syncing","currency","onRefresh"]),h(na,{modelValue:o(m).showCreateCustomerDialog,"onUpdate:modelValue":c[45]||(c[45]=P=>o(m).showCreateCustomerDialog=P),"pos-profile":o(d).profileName,"initial-name":o(m).initialCustomerName,onCustomerCreated:is},null,8,["modelValue","pos-profile","initial-name"]),h($v,{modelValue:Ee.value,"onUpdate:modelValue":c[46]||(c[46]=P=>Ee.value=P),"pos-profile":o(d).profileName,company:o(d).profileCompany,currency:o(d).profileCurrency,onPromotionSaved:xs},null,8,["modelValue","pos-profile","company","currency"]),h(lf,{modelValue:rt.value,"onUpdate:modelValue":c[47]||(c[47]=P=>rt.value=P),"pos-profile":o(d).profileName,"current-warehouse":o(d).profileWarehouse,onWarehouseChanged:ro},null,8,["modelValue","pos-profile","current-warehouse"]),h(xh,{modelValue:Ke.value,"onUpdate:modelValue":c[48]||(c[48]=P=>Ke.value=P),"pos-profile":o(d).profileName,currency:o(d).profileCurrency,"history-invoices":Xe.value,"draft-invoices":o(D).drafts,onViewInvoice:no,onPrintInvoice:bt,onLoadDraft:ys,onDeleteDraft:bs,onRefreshHistory:lo},null,8,["modelValue","pos-profile","currency","history-invoices","draft-invoices"]),h(t2,{modelValue:mt.value,"onUpdate:modelValue":c[49]||(c[49]=P=>mt.value=P),"invoice-name":gt.value,"pos-profile":o(d).profileName,currency:o(d).profileCurrency,onPrintInvoice:bt},null,8,["modelValue","invoice-name","pos-profile","currency"]),h(o(it),{modelValue:o(m).showClearCartDialog,"onUpdate:modelValue":c[51]||(c[51]=P=>o(m).showClearCartDialog=P),options:{title:u.__("Clear Cart?"),size:"xs"}},{"body-content":E(()=>[e("div",uy,[e("p",dy,t(u.__("Remove all {0} items from cart?",[o(l).itemCount])),1)])]),actions:E(()=>[e("div",cy,[h(o(fe),{class:"flex-1",variant:"subtle",onClick:c[50]||(c[50]=P=>o(m).showClearCartDialog=!1)},{default:E(()=>[Q(t(u.__("Cancel")),1)]),_:1}),h(o(fe),{class:"flex-1",variant:"solid",theme:"red",onClick:Xo},{default:E(()=>[Q(t(u.__("Clear All")),1)]),_:1})])]),_:1},8,["modelValue","options"]),h(o(it),{modelValue:o(m).showLogoutDialog,"onUpdate:modelValue":c[54]||(c[54]=P=>o(m).showLogoutDialog=P),options:{title:u.__("Sign Out Confirmation"),size:"md"},dismissable:!o(st).logout.loading},{"body-content":E(()=>[o(d).hasOpenShift?(s(),n("div",my,[e("div",vy,[c[75]||(c[75]=e("div",{class:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-gradient-to-br from-red-100 to-red-200 shadow-md mb-4"},[e("svg",{class:"h-8 w-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("h3",py,t(u.__("Your Shift is Still Open!")),1),e("p",fy,t(u.__("Close your shift first to save all transactions properly")),1)]),e("div",gy,[e("button",{onClick:es,disabled:o(st).logout.loading,class:"w-full flex items-center justify-center px-5 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold rounded-lg shadow-lg hover:shadow-blue-500/30 transition-[background,box-shadow,opacity,transform] duration-200 disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-[1.02] active:scale-[0.98]"},[c[76]||(c[76]=e("svg",{class:"w-5 h-5 me-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})],-1)),Q(" "+t(u.__("Close Shift & Sign Out")),1)],8,hy),e("div",_y,[e("button",{onClick:It,disabled:o(st).logout.loading,class:"px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold text-sm rounded-lg shadow-md hover:shadow-red-500/30 transition-[background,box-shadow,opacity] duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},t(u.__("Skip & Sign Out")),9,yy),e("button",{onClick:c[52]||(c[52]=P=>o(m).showLogoutDialog=!1),disabled:o(st).logout.loading,class:"px-4 py-3 bg-white hover:bg-gray-50 text-gray-700 font-semibold text-sm rounded-lg transition-[background-color,border-color,opacity] duration-200 disabled:opacity-50 disabled:cursor-not-allowed border border-gray-300 hover:border-gray-400"},t(u.__("Cancel")),9,by)])])])):(s(),n("div",xy,[e("div",wy,[c[77]||(c[77]=e("div",{class:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-gradient-to-br from-red-100 to-red-200 shadow-md mb-4"},[e("svg",{class:"h-8 w-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})])],-1)),e("h3",ky,t(u.__("Sign Out?")),1),e("p",$y,t(u.__("You will be logged out of INTouch POS")),1)]),e("div",Cy,[e("button",{onClick:c[53]||(c[53]=P=>o(m).showLogoutDialog=!1),disabled:o(st).logout.loading,class:"px-5 py-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md hover:shadow-blue-500/30 transition-[background-color,box-shadow,opacity,transform] duration-200 disabled:opacity-50 transform hover:scale-[1.02] active:scale-[0.98]"},t(u.__("Cancel")),9,Sy),e("button",{onClick:It,disabled:o(st).logout.loading,class:"px-5 py-4 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold rounded-lg shadow-lg hover:shadow-red-500/30 transition-[background,box-shadow,opacity,transform] duration-200 disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-[1.02] active:scale-[0.98]"},[o(st).logout.loading?(s(),n("span",Dy,[c[78]||(c[78]=e("svg",{class:"animate-spin h-5 w-5 me-2",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),Q(" "+t(u.__("Signing Out...")),1)])):(s(),n("span",Vy,t(u.__("Sign Out")),1))],8,Iy)])]))]),_:1},8,["modelValue","options","dismissable"]),h(o(it),{modelValue:o(m).showSuccessDialog,"onUpdate:modelValue":c[57]||(c[57]=P=>o(m).showSuccessDialog=P),options:{title:u.__("Invoice Created Successfully"),size:"md"}},{"body-content":E(()=>[e("div",My,[c[79]||(c[79]=e("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100"},[e("svg",{class:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),e("h3",Py,t(u.__("Invoice {0} created successfully!",[o(m).lastInvoiceName])),1),e("p",Ty,t(u.__("Total: {0}",[W(o(m).lastInvoiceTotal)])),1)])]),actions:E(()=>[e("div",Ay,[h(o(fe),{variant:"subtle",onClick:c[55]||(c[55]=P=>o(m).showSuccessDialog=!1)},{default:E(()=>[Q(t(u.__("Close")),1)]),_:1}),h(o(fe),{variant:"solid",theme:"blue",onClick:c[56]||(c[56]=()=>{bt({name:o(m).lastInvoiceName}),o(m).showSuccessDialog=!1})},{default:E(()=>[Q(t(u.__("Print Invoice")),1)]),_:1})])]),_:1},8,["modelValue","options"]),h(o(it),{modelValue:o(m).showErrorDialog,"onUpdate:modelValue":c[59]||(c[59]=P=>o(m).showErrorDialog=P),options:{title:o(m).errorDialogTitle||u.__("Error"),size:"md"}},{"body-content":E(()=>[e("div",jy,[e("p",Ly,t(o(m).errorDialogMessage||u.__("An unexpected error occurred.")),1),o(m).errorDetails?(s(),n("div",By,[e("p",Oy,t(o(m).errorDetails),1)])):I("",!0)])]),actions:E(()=>{var P;return[e("div",Ey,[o(m).errorRetryAction==="sync"&&((P=o(m).errorRetryActionData)!=null&&P.failedInvoiceId)?(s(),ie(o(fe),{key:0,variant:"outline",theme:"red",onClick:Yo},{default:E(()=>[Q(t(u.__("Delete Invoice")),1)]),_:1})):(s(),n("div",zy)),e("div",Ny,[h(o(fe),{variant:"subtle",onClick:c[58]||(c[58]=Me=>o(m).clearError())},{default:E(()=>[Q(t(u.__("Close")),1)]),_:1}),o(m).errorRetryAction?(s(),ie(o(fe),{key:0,variant:"solid",onClick:Jo},{default:E(()=>[Q(t(u.__("Try Again")),1)]),_:1})):I("",!0)])])]}),_:1},8,["modelValue","options"]),h(Ja,{ref_key:"clearCacheOverlayRef",ref:qe,show:je.value,onCancel:c[60]||(c[60]=P=>je.value=!1),onConfirm:ms},null,8,["show"])],64))])}}};export{Wy as default};
