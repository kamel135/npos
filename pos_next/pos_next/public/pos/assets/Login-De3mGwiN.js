var T=(I,w,r)=>new Promise((h,S)=>{var s=f=>{try{u(r.next(f))}catch(x){S(x)}},g=f=>{try{u(r.throw(f))}catch(x){S(x)}},u=f=>f.done?h(f.value):Promise.resolve(f.value).then(s,g);u((r=r.apply(I,w)).next())});import{a as K,z as C,c as b,o as m,f as e,F as E,B as O,t as c,a6 as H,a5 as R,a4 as N,i as _,j as q,Z as d,a7 as A,V as J,r as W,d as P,g as M,A as D,u as k,H as F,J as Z,a8 as G,p as Q,w as X,e as Y}from"./index-CLcWQdf2.js";import{u as ee,c as te,d as oe}from"./posUI-DTgWktYq.js";import"./bootstrap-BaxiQ869.js";const ae={class:"virtual-keyboard-container"},se={class:"keyboard-wrapper"},ne={class:"keyboard-row"},le=["onClick"],re={class:"keyboard-char"},ie={class:"keyboard-row"},ue=["onClick"],de={class:"keyboard-char"},ce={class:"keyboard-row"},pe=["onClick"],be={class:"keyboard-char"},me={class:"keyboard-row"},fe=["onClick"],ve={class:"keyboard-char"},ge={class:"keyboard-row"},he={class:"keyboard-char"},_e=["title"],ye={class:"keyboard-char"},ke={__name:"VirtualKeyboard",props:{modelValue:{type:String,default:""},targetInput:{type:Object,default:null}},emits:["update:modelValue","input","close"],setup(I,{emit:w}){const r=I,h=w;C(()=>r.modelValue,i=>{if(r.targetInput){const n=r.targetInput;if(n&&n.value!==i){n.value=i||"";const t=new Event("input",{bubbles:!0,cancelable:!0});Object.defineProperty(t,"target",{value:n,enumerable:!0}),n.dispatchEvent(t)}}},{immediate:!0});const S={1:["q","w","e","r","t","y","u","i","o","p"],2:["a","s","d","f","g","h","j","k","l"],3:["z","x","c","v","b","n","m"],4:["1","2","3","4","5","6","7","8","9","0","@","."]};function s(i){return S[i]||[]}function g(){return r.targetInput&&r.targetInput.value!==void 0?r.targetInput.value||"":r.modelValue||""}function u(i){const t=g()+i;if(h("update:modelValue",t),h("input",t),r.targetInput){const l=r.targetInput;if(l&&l.value!==void 0){l.value=t;const y=new Event("input",{bubbles:!0,cancelable:!0});Object.defineProperty(y,"target",{value:l,enumerable:!0}),Object.defineProperty(y,"currentTarget",{value:l,enumerable:!0}),l.dispatchEvent(y);const V=new Event("change",{bubbles:!0,cancelable:!0});Object.defineProperty(V,"target",{value:l,enumerable:!0}),l.dispatchEvent(V)}}}function f(){const n=g().slice(0,-1);if(h("update:modelValue",n),h("input",n),r.targetInput){const t=r.targetInput;if(t&&t.value!==void 0){t.value=n;const l=new Event("input",{bubbles:!0,cancelable:!0});Object.defineProperty(l,"target",{value:t,enumerable:!0}),Object.defineProperty(l,"currentTarget",{value:t,enumerable:!0}),t.dispatchEvent(l);const y=new Event("change",{bubbles:!0,cancelable:!0});Object.defineProperty(y,"target",{value:t,enumerable:!0}),t.dispatchEvent(y)}}}function x(){h("close")}function v(i){return i}return(i,n)=>(m(),b("div",ae,[e("div",se,[e("div",ne,[(m(!0),b(E,null,O(s(1),t=>(m(),b("button",{key:t,onClick:l=>u(t),class:"keyboard-key keyboard-key-char"},[e("span",re,c(t),1)],8,le))),128))]),e("div",ie,[(m(!0),b(E,null,O(s(2),t=>(m(),b("button",{key:t,onClick:l=>u(t),class:"keyboard-key keyboard-key-char"},[e("span",de,c(t),1)],8,ue))),128))]),e("div",ce,[(m(!0),b(E,null,O(s(3),t=>(m(),b("button",{key:t,onClick:l=>u(t),class:"keyboard-key keyboard-key-char"},[e("span",be,c(t),1)],8,pe))),128))]),e("div",me,[(m(!0),b(E,null,O(s(4),t=>(m(),b("button",{key:t,onClick:l=>u(t),class:"keyboard-key keyboard-key-char"},[e("span",ve,c(t),1)],8,fe))),128))]),e("div",ge,[e("button",{onClick:n[0]||(n[0]=t=>u(" ")),class:"keyboard-key keyboard-key-space"},[e("span",he,c("Space"),1)]),e("button",{onClick:f,class:"keyboard-key keyboard-key-action keyboard-key-backspace",title:"Backspace"},n[1]||(n[1]=[e("svg",{class:"backspace-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M12 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M3 12l6.414 6.414a2 2 0 001.414.586H19a2 2 0 002-2V7a2 2 0 00-2-2h-8.172a2 2 0 00-1.414.586L3 12z"})],-1)]),8,_e),e("button",{onClick:x,class:"keyboard-key keyboard-key-action keyboard-key-done"},[e("span",ye,c("Done"),1)])])])]))}},we=K(ke,[["__scopeId","data-v-159a1aa6"]]),xe={class:"login-container min-h-screen flex flex-col items-center justify-center bg-gray-50 py-6 px-4 sm:px-6 lg:px-8"},Ce={class:"max-w-lg w-full space-y-4"},Se={class:"text-center"},Ie={class:"mt-2 text-2xl sm:text-3xl font-extrabold text-gray-900"},Ve={class:"mt-2 text-sm sm:text-base text-gray-600"},$e={class:"bg-white py-6 px-6 sm:px-8 shadow-xl rounded-xl"},Ee={key:0,class:"rounded-md bg-red-50 p-4"},Oe={class:"flex"},Pe={class:"ml-3"},je={class:"text-sm font-medium text-red-800"},Be={class:"mt-2 text-sm text-red-700"},Le={class:"block"},Te={class:"mb-2 block text-base sm:text-lg font-semibold leading-5 text-gray-700"},Me={class:"relative email-input-wrapper"},De=["placeholder","disabled"],Fe={class:"block"},Ke={class:"mb-2 block text-base sm:text-lg font-semibold leading-5 text-gray-700"},ze={class:"relative password-input-wrapper"},Ue=["type","placeholder","disabled"],He=["disabled","title"],Re={class:"fixed bottom-4 right-4 z-50"},Ne=["title"],qe={key:0,class:"virtual-keyboard-fixed"},Ae={class:"keyboard-header"},Je={class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},We=["title"],Ze={__name:"Login",setup(I){const w=H(),{shiftState:r}=R(),h=ee(),S=te(),s=N({email:"",password:""}),g=_(!1),u=_(!1),f=_(null),x=_(null),v=_(!1),i=_(""),n=_(null),t=_(null),l=_(!1);q(()=>{l.value="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0||window.matchMedia("(pointer: coarse)").matches||window.matchMedia("(hover: none)").matches,s.email="",s.password="",u.value=!1,d.login.error&&d.login.reset(),d.isLoggedIn||(g.value=!1,h.clearCart(),S.resetAllDialogs(),r.value={pos_opening_shift:null,pos_profile:null,company:null,isOpen:!1},localStorage.removeItem("pos_shift_data"))});function y(){!s.email||!s.password||d.login.submit({email:s.email.trim(),password:s.password})}C(()=>d.isLoggedIn,o=>T(this,null,function*(){if(o){try{console.log("User logged in, initializing CSRF token..."),yield A(),window.csrf_token&&(yield J.setCSRFToken(window.csrf_token))}catch(a){console.error("Failed to initialize CSRF token after login:",a)}g.value=!0}})),C(g,(o,a)=>{a===!0&&o===!1&&d.isLoggedIn&&w.push({name:"POSSale"})});function V(){w.push({name:"POSSale"})}function z({reason:o}){(o==="cancelled"||o==="resumed")&&w.push({name:"POSSale"})}C([()=>s.email,()=>s.password],()=>{d.login.error&&d.login.reset()});function j(o,a){t.value=a,n.value=o.target,v.value=!0,i.value=a==="email"?s.email:s.password,l.value&&(o.preventDefault(),o.target.blur())}function B(o){setTimeout(()=>{const a=document.querySelector(".virtual-keyboard-fixed");a&&a.contains(document.activeElement)},200)}function $(o){const a=o.target.name==="email"?"email":"password";t.value=a,n.value=o.target,v.value=!0,i.value=a==="email"?s.email:s.password,l.value&&o.preventDefault()}function L(){v.value=!1,n.value=null,t.value=null}return C(i,o=>{t.value==="email"?s.email=o:t.value==="password"&&(s.password=o)}),C(()=>s.email,o=>{t.value==="email"&&v.value&&(i.value=o)}),C(()=>s.password,o=>{t.value==="password"&&v.value&&(i.value=o)}),(o,a)=>{const U=W("Button");return m(),b("div",xe,[e("div",Ce,[e("div",Se,[e("h2",Ie,c(o.__("Sign in to INTouch POS")),1),e("p",Ve,c(o.__("Access your point of sale system")),1)]),e("div",$e,[e("form",{class:"space-y-5",onSubmit:D(y,["prevent"])},[k(d).login.error?(m(),b("div",Ee,[e("div",Oe,[a[8]||(a[8]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",Pe,[e("h3",je,c(o.__("Login Failed")),1),e("div",Be,[e("p",null,c(k(d).login.error.messages.join(`
`)),1)])])])])):M("",!0),e("div",null,[e("label",Le,[e("span",Te,c(o.__("User ID / Email")),1),e("div",Me,[F(e("input",{ref_key:"emailInput",ref:f,"onUpdate:modelValue":a[0]||(a[0]=p=>s.email=p),required:"",name:"email",type:"text",autocomplete:"email",placeholder:o.__("Enter your username or email"),disabled:k(d).login.loading,class:"form-input w-full border-2 border-gray-300 placeholder-gray-400 text-base sm:text-lg py-3 px-4 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all",style:{"font-size":"1rem","min-height":"48px"},onFocus:a[1]||(a[1]=p=>j(p,"email")),onBlur:B,onClick:$,onTouchstart:$},null,40,De),[[Z,s.email]])])])]),e("div",null,[e("label",Fe,[e("span",Ke,c(o.__("Password")),1),e("div",ze,[F(e("input",{ref_key:"passwordInput",ref:x,"onUpdate:modelValue":a[2]||(a[2]=p=>s.password=p),required:"",name:"password",autocomplete:"current-password",type:u.value?"text":"password",placeholder:o.__("Enter your password"),disabled:k(d).login.loading,class:"form-input w-full border-2 border-gray-300 placeholder-gray-400 text-base sm:text-lg py-3 px-4 pr-12 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all",style:{"font-size":"1rem","min-height":"48px"},onFocus:a[3]||(a[3]=p=>j(p,"password")),onBlur:B,onClick:$,onTouchstart:$},null,40,Ue),[[G,s.password]]),e("button",{type:"button",onClick:a[4]||(a[4]=D(p=>u.value=!u.value,["stop"])),class:"absolute inset-y-0 end-0 flex items-center justify-center px-3 text-gray-500 hover:text-gray-700 transition-colors focus:outline-none",disabled:k(d).login.loading,style:{"min-width":"40px"},title:u.value?o.__("Hide password"):o.__("Show password")},[P(k(Q),{name:u.value?"eye-off":"eye",class:"h-5 w-5","stroke-width":2},null,8,["name"])],8,He)])])]),e("div",null,[P(U,{loading:k(d).login.loading,variant:"solid",class:"w-full py-3 px-4 border border-transparent rounded-lg shadow-md text-base sm:text-lg font-bold text-white focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50",style:{"min-height":"48px","background-color":"#1d4ed8"},type:"submit"},{default:X(()=>[Y(c(k(d).login.loading?o.__("Signing in..."):o.__("Sign in")),1)]),_:1},8,["loading"])])],32)])]),P(oe,{modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=p=>g.value=p),onShiftOpened:V,onDialogClosed:z},null,8,["modelValue"]),e("div",Re,[e("button",{onClick:a[6]||(a[6]=p=>v.value=!v.value),class:"bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-blue-700 transition-colors",title:v.value?o.__("Hide Keyboard"):o.__("Show Keyboard")},c(v.value?o.__("Hide KB"):o.__("Show KB")),9,Ne)]),v.value?(m(),b("div",qe,[e("div",Ae,[e("span",Je,c(o.__("English Keyboard")),1),e("button",{onClick:L,class:"keyboard-close-btn",title:o.__("Hide Keyboard")},a[9]||(a[9]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,We)]),P(we,{modelValue:i.value,"onUpdate:modelValue":a[7]||(a[7]=p=>i.value=p),"target-input":n.value,onClose:L},null,8,["modelValue","target-input"])])):M("",!0)])}}},et=K(Ze,[["__scopeId","data-v-d51be818"]]);export{et as default};
