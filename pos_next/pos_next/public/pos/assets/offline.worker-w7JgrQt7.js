var oe=Object.defineProperty,ne=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var Q=(t,e,r)=>e in t?oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Z=(t,e)=>{for(var r in e||(e={}))ce.call(e,r)&&Q(t,r,e[r]);if(j)for(var r of j(e))le.call(e,r)&&Q(t,r,e[r]);return t},X=(t,e)=>ne(t,ie(e));var ue=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var c=(t,e,r)=>new Promise((s,a)=>{var n=l=>{try{m(r.next(l))}catch(u){a(u)}},i=l=>{try{m(r.throw(l))}catch(u){a(u)}},m=l=>l.done?s(l.value):Promise.resolve(l.value).then(n,i);m((r=r.apply(t,e)).next())});var $e=ue(se=>{const f={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4},E={DEBUG:"\x1B[36m",INFO:"\x1B[34m",WARN:"\x1B[33m",ERROR:"\x1B[31m",SUCCESS:"\x1B[32m",RESET:"\x1B[0m",BOLD:"\x1B[1m",DIM:"\x1B[2m"};class de{constructor(){if(this.isDev=!1,typeof window!="undefined"&&typeof localStorage!="undefined"){const e=localStorage.getItem("POS_LOG_LEVEL"),r=localStorage.getItem("POS_LOGGING_ENABLED");this.currentLevel=e?f[e.toUpperCase()]:this.getDefaultLevel(),this.enabled=r!==null?r==="true":this.isDev}else this.currentLevel=this.getDefaultLevel(),this.enabled=this.isDev;this.enabledNamespaces=new Set,this.disabledNamespaces=new Set,this.loadNamespaceConfig()}getDefaultLevel(){return this.isDev?f.DEBUG:f.WARN}loadNamespaceConfig(){if(!(typeof window=="undefined"||typeof localStorage=="undefined"))try{const e=localStorage.getItem("POS_LOG_NAMESPACES_ENABLED"),r=localStorage.getItem("POS_LOG_NAMESPACES_DISABLED");e&&e.split(",").forEach(s=>this.enabledNamespaces.add(s.trim())),r&&r.split(",").forEach(s=>this.disabledNamespaces.add(s.trim()))}catch(e){}}setLevel(e){const r=typeof e=="string"?f[e.toUpperCase()]:e;r!==void 0&&(this.currentLevel=r,typeof localStorage!="undefined"&&localStorage.setItem("POS_LOG_LEVEL",Object.keys(f)[r]))}setEnabled(e){this.enabled=e,typeof localStorage!="undefined"&&localStorage.setItem("POS_LOGGING_ENABLED",e.toString())}enableNamespace(e){this.enabledNamespaces.add(e),this.disabledNamespaces.delete(e),this.saveNamespaceConfig()}disableNamespace(e){this.disabledNamespaces.add(e),this.enabledNamespaces.delete(e),this.saveNamespaceConfig()}saveNamespaceConfig(){typeof localStorage!="undefined"&&(this.enabledNamespaces.size>0?localStorage.setItem("POS_LOG_NAMESPACES_ENABLED",Array.from(this.enabledNamespaces).join(",")):localStorage.removeItem("POS_LOG_NAMESPACES_ENABLED"),this.disabledNamespaces.size>0?localStorage.setItem("POS_LOG_NAMESPACES_DISABLED",Array.from(this.disabledNamespaces).join(",")):localStorage.removeItem("POS_LOG_NAMESPACES_DISABLED"))}shouldLog(e,r){return!this.enabled||r<this.currentLevel?!1:this.enabledNamespaces.size>0?this.enabledNamespaces.has(e):!this.disabledNamespaces.has(e)}}class fe{constructor(e,r){this.namespace=e,this.config=r,this.timers=new Map}format(e,r,...s){const a=new Date().toISOString().split("T")[1].split(".")[0],n=Object.keys(f)[e],i=E[n]||E.RESET;return typeof window!="undefined"?[`%c[${a}] %c${n}%c [${this.namespace}]%c ${r}`,"color: gray; font-size: 0.9em",`${i}; font-weight: bold`,"color: blue; font-weight: bold","color: inherit",...s]:[`${E.DIM}[${a}]${E.RESET} ${i}${E.BOLD}${n}${E.RESET} ${E.BOLD}[${this.namespace}]${E.RESET} ${r}`,...s]}debug(e,...r){this.config.shouldLog(this.namespace,f.DEBUG)&&console.log(...this.format(f.DEBUG,e,...r))}info(e,...r){this.config.shouldLog(this.namespace,f.INFO)&&console.log(...this.format(f.INFO,e,...r))}warn(e,...r){this.config.shouldLog(this.namespace,f.WARN)&&console.warn(...this.format(f.WARN,e,...r))}error(e,...r){this.config.shouldLog(this.namespace,f.ERROR)&&console.error(...this.format(f.ERROR,e,...r))}success(e,...r){if(this.config.shouldLog(this.namespace,f.INFO)){const s=this.format(f.INFO,e,...r);typeof window!="undefined"?(s[1]=s[1].replace("INFO","‚úì SUCCESS"),s[2]=`${E.SUCCESS}; font-weight: bold`):s[0]=s[0].replace("INFO","‚úì SUCCESS"),console.log(...s)}}group(e){this.config.shouldLog(this.namespace,f.DEBUG)&&console.group(`[${this.namespace}] ${e}`)}groupEnd(){this.config.shouldLog(this.namespace,f.DEBUG)&&console.groupEnd()}table(e,r){this.config.shouldLog(this.namespace,f.DEBUG)&&console.table(e,r)}time(e){this.config.shouldLog(this.namespace,f.DEBUG)&&this.timers.set(e,performance.now())}timeEnd(e){if(this.config.shouldLog(this.namespace,f.DEBUG)){const r=this.timers.get(e);if(r!==void 0){const s=performance.now()-r;this.debug(`‚è±Ô∏è  ${e}: ${s.toFixed(2)}ms`),this.timers.delete(e)}}}custom(e,r,s,...a){if(this.config.shouldLog(this.namespace,e)){const n=this.format(e,s,...a);n[2]=`color: ${r}; font-weight: bold`,console.log(...n)}}}class me{constructor(){this.config=new de,this.loggers=new Map}create(e){return this.loggers.has(e)||this.loggers.set(e,new fe(e,this.config)),this.loggers.get(e)}setLevel(e){this.config.setLevel(e)}setEnabled(e){this.config.setEnabled(e)}enableNamespace(e){this.config.enableNamespace(e)}disableNamespace(e){this.config.disableNamespace(e)}getConfig(){return{enabled:this.config.enabled,level:Object.keys(f)[this.config.currentLevel],isDev:this.config.isDev,enabledNamespaces:Array.from(this.config.enabledNamespaces),disabledNamespaces:Array.from(this.config.disabledNamespaces)}}help(){console.log(`
%cüîç POS Logging System Help

%cControl logging globally:%c
  logger.setLevel('DEBUG')    - Set log level (DEBUG, INFO, WARN, ERROR, NONE)
  logger.setEnabled(true)     - Enable/disable all logging
  logger.getConfig()          - View current configuration

%cControl specific modules:%c
  logger.enableNamespace('ItemSearch')   - Only log from ItemSearch
  logger.disableNamespace('Worker')      - Disable Worker logs

%cExamples:%c
  // Create module logger
  const log = logger.create('MyModule')

  // Log at different levels
  log.debug('Detailed info', { data })
  log.info('General info')
  log.warn('Warning message')
  log.error('Error occurred', error)
  log.success('Operation successful!')

  // Performance timing
  log.time('operation')
  // ... do work ...
  log.timeEnd('operation')  // Logs: ‚è±Ô∏è  operation: 42.35ms

  // Group logs
  log.group('Processing items')
  log.info('Item 1')
  log.info('Item 2')
  log.groupEnd()

%cPersistence:%c
  Settings are saved to localStorage and persist across sessions.

%cCurrent Config:%c
  ${JSON.stringify(this.getConfig(),null,2)}
		`,"font-size: 16px; font-weight: bold","font-weight: bold; color: #2196F3","font-weight: normal","font-weight: bold; color: #4CAF50","font-weight: normal","font-weight: bold; color: #FF9800","font-weight: normal","font-weight: bold; color: #9C27B0","font-weight: normal","font-weight: bold; color: #607D8B","font-weight: normal")}}const N=new me;typeof window!="undefined"&&(window.posLogger=N);if(N.config.isDev){const t=N.create("Logger");t.info("Logger initialized",N.getConfig()),t.debug("Type posLogger.help() in console for usage guide")}const o=N.create("OfflineWorker"),b={DB_NAME:"pos_next_offline",BATCH_SIZE:500,MAX_RETRY_ATTEMPTS:3,RETRY_DELAY_MS:1e3,QUERY_CACHE_SIZE:100,QUERY_CACHE_TTL_MS:5*60*1e3};let _=null,P=!1,O=null;const w=new Map,G=new Map;let U=0,x=!1;function g(){return c(this,null,function*(){if(_&&P)return _;if(O)return O;if(x)throw new Error("Circuit breaker open - database unavailable");O=c(this,null,function*(){const t=performance.now();let e=null;for(let r=1;r<=b.MAX_RETRY_ATTEMPTS;r++)try{const s=yield import("./import-wrapper-prod-D0w64MZP.js"),a=s.default||s;_=new a(b.DB_NAME),yield _.open();const n=_.tables.map(m=>m.name);if(n.length===0)throw new Error("No tables found in database");P=!0,U=0;const i=Math.round(performance.now()-t);return o.success(`DB initialized in ${i}ms (attempt ${r})`,{tables:n.length}),_}catch(s){if(e=s,o.error(`DB init failed (attempt ${r}/${b.MAX_RETRY_ATTEMPTS})`,{error:s.message}),_){try{yield _.close()}catch(a){}_=null,P=!1}if(r>=b.MAX_RETRY_ATTEMPTS)throw U++,U>=5&&(x=!0,o.error("Circuit breaker opened - DB permanently unavailable")),new Error(`DB init failed after ${r} attempts: ${e.message}`);yield new Promise(a=>setTimeout(a,b.RETRY_DELAY_MS*Math.pow(2,r-1)))}throw e});try{return yield O}finally{O=null}})}let v=!0,C=!1,Y=null,I=null,L=!1,D=6e4,M=null,$=new Set,R=null,F=!1;function p(t,e,r=!1){G.has(t)||G.set(t,{count:0,totalTime:0,errors:0,avgTime:0,minTime:1/0,maxTime:0});const s=G.get(t);s.count++,s.totalTime+=e,s.avgTime=Math.round(s.totalTime/s.count),s.minTime=Math.min(s.minTime,e),s.maxTime=Math.max(s.maxTime,e),r&&s.errors++}function ge(t){return Array.isArray(t.barcodes)?t.barcodes:t.barcode?[t.barcode]:t.item_barcode?Array.isArray(t.item_barcode)?t.item_barcode.map(e=>typeof e=="object"?e.barcode:e).filter(Boolean):[t.item_barcode]:[]}function z(t,e){const r=[];for(let s=0;s<t.length;s+=e)r.push(t.slice(s,s+e));return r}function A(t,e){if(w.size>=b.QUERY_CACHE_SIZE){const r=w.keys().next().value;w.delete(r)}w.set(t,{value:e,timestamp:Date.now()})}function he(t){const e=w.get(t);return e?Date.now()-e.timestamp>b.QUERY_CACHE_TTL_MS?(w.delete(t),null):e.value:null}function T(t){if(!t){w.clear();return}for(const e of w.keys())e.startsWith(t)&&w.delete(e)}function pe(){return{operations:Object.fromEntries(G),cache:{size:w.size,maxSize:b.QUERY_CACHE_SIZE,entries:Array.from(w.keys()).slice(0,10)},circuit:{open:x,failures:U},db:{initialized:P}}}function H(){return c(this,null,function*(){try{const t=new AbortController,e=setTimeout(()=>t.abort(),3e3),r=yield fetch("/api/method/pos_next.api.ping",{method:"GET",signal:t.signal});return clearTimeout(e),v=r.ok,v}catch(t){return v=!1,!1}})}function we(t){return C?!0:!t||!v}function J(){return c(this,null,function*(){try{const t=yield g();return t.tables.some(s=>s.name==="invoice_queue")?yield t.table("invoice_queue").filter(s=>s.synced===!1).count():(o.debug("invoice_queue table does not exist yet, returning 0"),0)}catch(t){return t.name==="NotFoundError"||t.name==="DatabaseClosedError"?(o.debug("Invoice queue not accessible yet, returning 0"),0):(o.error("Error getting offline invoice count",t),0)}})}function be(){return c(this,null,function*(){try{const t=yield g();return t.tables.some(s=>s.name==="invoice_queue")?yield t.table("invoice_queue").filter(s=>s.synced===!1).toArray():(o.debug("invoice_queue table does not exist yet, returning empty array"),[])}catch(t){return o.error("Error getting offline invoices",t),[]}})}function ye(t){return c(this,null,function*(){try{const e=yield g();if(!t.items||t.items.length===0)throw new Error("Cannot save empty invoice");return{success:!0,id:yield e.table("invoice_queue").add({data:t,timestamp:Date.now(),synced:!1,retry_count:0})}}catch(e){throw o.error("Error saving offline invoice",e),e}})}function Ee(t="",e=50){return c(this,null,function*(){const r=performance.now(),s=`search:${t}:${e}`,a=he(s);if(a)return o.debug("Cache hit for search",{searchTerm:t}),a;try{const n=yield g();if(!t||t.trim().length===0){const d=yield n.table("items").filter(h=>!h.disabled).limit(e).toArray();return A(s,d),d}const i=t.toLowerCase().trim(),m=i.split(/\s+/).filter(Boolean);if(m.length===1){const d=yield n.table("items").where("barcodes").equals(i).filter(S=>!S.disabled).limit(e).toArray();if(d.length>0)return A(s,d),p("searchCachedItems",performance.now()-r,!1),d;const h=yield n.table("items").where("item_code").startsWithIgnoreCase(i).filter(S=>!S.disabled).limit(e).toArray();if(h.length>0)return A(s,h),p("searchCachedItems",performance.now()-r,!1),h;const y=yield n.table("items").where("item_name").startsWithIgnoreCase(i).filter(S=>!S.disabled).limit(e).toArray();if(y.length>0)return A(s,y),p("searchCachedItems",performance.now()-r,!1),y}const u=(yield n.table("items").filter(d=>!d.disabled).limit(e*10).toArray()).map(d=>{var S,W,K,V;const h=`${d.item_code||""} ${d.item_name||""} ${d.description||""}`.toLowerCase();if(!m.every(ae=>h.includes(ae)))return null;let y=100;return((S=d.item_name)==null?void 0:S.toLowerCase())===i?y=1e3:((W=d.item_code)==null?void 0:W.toLowerCase())===i?y=900:(K=d.item_name)!=null&&K.toLowerCase().startsWith(i)?y=500:(V=d.item_code)!=null&&V.toLowerCase().startsWith(i)&&(y=400),{item:d,score:y}}).filter(Boolean).sort((d,h)=>h.score-d.score).slice(0,e).map(({item:d})=>d),k=Math.round(performance.now()-r);return p("searchCachedItems",k,!1),A(s,u),u}catch(n){return p("searchCachedItems",performance.now()-r,!0),o.error("Error searching cached items",n),[]}})}function _e(t="",e=20){return c(this,null,function*(){try{const r=yield g(),s=t.toLowerCase();if(!s)return e>0?yield r.table("customers").limit(e).toArray():yield r.table("customers").toArray();const a=yield r.table("customers").toArray();return a.filter(i=>{const m=(i.customer_name||"").toLowerCase(),l=(i.mobile_no||"").toLowerCase(),u=(i.name||"").toLowerCase();return m.includes(s)||l.includes(s)||u.includes(s)}).slice(0,e||a.length)}catch(r){return o.error("Error searching cached customers",r),[]}})}function Se(t){return c(this,null,function*(){if(!t||t.length===0)return{success:!0,count:0,duration:0};const e=performance.now();try{const r=yield g(),s=z(t,b.BATCH_SIZE);let a=0;yield r.transaction("rw","items","item_prices","settings",()=>c(this,null,function*(){for(const i of s){const m=i.map(u=>X(Z({},u),{barcodes:ge(u)}));yield r.table("items").bulkPut(m);const l=i.filter(u=>u.item_code?u.rate||u.price_list_rate:!1).map(u=>({price_list:u.selling_price_list||u.price_list||"Standard",item_code:u.item_code,rate:u.rate||u.price_list_rate||0,timestamp:Date.now()}));if(l.length>0)try{yield r.table("item_prices").bulkPut(l)}catch(u){o.error("Failed to cache item prices",{error:u.message,batchSize:l.length,samplePrices:l.slice(0,3)});let k=0;for(const d of l)try{yield r.table("item_prices").put(d),k++}catch(h){o.warn("Skipping invalid price record",{item_code:d.item_code,price_list:d.price_list,error:h.message})}k>0&&o.info(`Recovered ${k}/${l.length} price records`)}a+=i.length}yield r.table("settings").put({key:"items_last_sync",value:Date.now()})}));const n=Math.round(performance.now()-e);return p("cacheItems",n,!1),T("search:"),T("items:"),o.success(`Cached ${a} items in ${n}ms`,{batches:s.length,throughput:Math.round(a/(n/1e3))+" items/s"}),{success:!0,count:a,duration:n}}catch(r){const s=Math.round(performance.now()-e);throw p("cacheItems",s,!0),o.error("Error caching items",{error:r.message,count:t.length}),r}})}function Ce(t){return c(this,null,function*(){if(!t||t.length===0)return{success:!0,count:0,duration:0};const e=performance.now();try{const r=yield g();yield r.transaction("rw","customers","settings",()=>c(this,null,function*(){const a=z(t,b.BATCH_SIZE);for(const n of a)yield r.table("customers").bulkPut(n);yield r.table("settings").put({key:"customers_last_sync",value:Date.now()})}));const s=Math.round(performance.now()-e);return p("cacheCustomers",s,!1),T("customers:"),o.success(`Cached ${t.length} customers in ${s}ms`),{success:!0,count:t.length,duration:s}}catch(r){throw p("cacheCustomers",performance.now()-e,!0),o.error("Error caching customers",r),r}})}function Te(){return c(this,null,function*(){try{const t=yield g();return yield t.transaction("rw","items","item_prices","settings",()=>c(this,null,function*(){yield t.table("items").clear(),yield t.table("item_prices").clear(),yield t.table("settings").put({key:"items_last_sync",value:null})})),T("items"),T("search"),o.info("Items cache cleared"),{success:!0}}catch(t){throw o.error("Error clearing items cache",t),t}})}function ke(){return c(this,null,function*(){try{const t=yield g();return yield t.transaction("rw","customers","settings",()=>c(this,null,function*(){yield t.table("customers").clear(),yield t.table("settings").put({key:"customers_last_sync",value:null})})),T("customers"),o.info("Customers cache cleared"),{success:!0}}catch(t){throw o.error("Error clearing customers cache",t),t}})}function ve(t){return c(this,null,function*(){if(!t||t.length===0)return{success:!0,removed:0,pricesRemoved:0};const e=performance.now();try{const r=yield g();let s=0,a=0;yield r.transaction("rw","items","item_prices",()=>c(this,null,function*(){const i=[];for(const m of t){const l=yield r.table("items").where("item_group").equals(m).primaryKeys();i.push(...l);const u=yield r.table("items").where("item_group").equals(m).delete();s+=u}if(i.length>0){const m=z(i,500);for(const l of m){const u=yield r.table("item_prices").where("item_code").anyOf(l).delete();a+=u}}}));const n=Math.round(performance.now()-e);return p("removeItemsByGroups",n,!1),T("items"),T("search"),o.success(`Removed ${s} items, ${a} prices in ${n}ms`,{groups:t.length}),{success:!0,removed:s,pricesRemoved:a,duration:n}}catch(r){throw p("removeItemsByGroups",performance.now()-e,!0),o.error("Error removing items by groups",{error:r.message,groups:t}),r}})}function Oe(t){return c(this,null,function*(){try{const e=yield g();return yield e.table("payment_methods").bulkPut(t),yield e.table("settings").put({key:"payment_methods_last_sync",value:Date.now()}),{success:!0,count:t.length}}catch(e){throw o.error("Error caching payment methods",e),e}})}function Ae(t){return c(this,null,function*(){try{const e=yield g();return t?yield e.table("payment_methods").where("pos_profile").equals(t).toArray():yield e.table("payment_methods").toArray()}catch(e){return o.error("Error getting cached payment methods",e),[]}})}function Ne(){return c(this,null,function*(){try{return(yield(yield g()).table("items").count())>0}catch(t){return!1}})}function Ie(){return c(this,null,function*(){try{const t=yield g(),[e,r,s,a]=yield Promise.all([t.table("items").count(),t.table("customers").count(),J(),t.table("settings").get("items_last_sync")]);return{items:e,customers:r,queuedInvoices:s,cacheReady:e>0,lastSync:(a==null?void 0:a.value)||null}}catch(t){return o.error("Error getting cache stats",t),{items:0,customers:0,queuedInvoices:0,cacheReady:!1,lastSync:null}}})}function Re(t){return c(this,null,function*(){try{return yield(yield g()).table("invoice_queue").delete(t),{success:!0}}catch(e){throw o.error("Error deleting offline invoice",e),e}})}function ee(t){return c(this,null,function*(){try{const e=yield g();if(!t||t.length===0)return{success:!0,updated:0};let r=0;for(const s of t){const{item_code:a,warehouse:n,actual_qty:i,stock_qty:m}=s;if(!a)continue;const l=yield e.table("items").get(a);l&&(l.actual_qty=i!==void 0?i:m,l.stock_qty=m!==void 0?m:i,l.warehouse=n||l.warehouse,yield e.table("items").put(l),r++)}if(r>0)try{yield e.table("settings").put({key:"items_last_sync",value:Date.now()})}catch(s){o.error("Error updating items_last_sync timestamp",s)}return{success:!0,updated:r}}catch(e){throw o.error("Error updating stock quantities",e),e}})}function Le(){return c(this,null,function*(){if(!M||$.size===0)return o.debug("Stock sync skipped: No warehouse or items tracked"),[];try{const t=new AbortController,e=setTimeout(()=>t.abort(),5e3),r=Array.from($),s={"Content-Type":"application/json",Accept:"application/json"};Y&&(s["X-Frappe-CSRF-Token"]=Y);const a=yield fetch("/api/method/pos_next.api.items.get_stock_quantities",{method:"POST",headers:s,body:JSON.stringify({item_codes:JSON.stringify(r),warehouse:M}),signal:t.signal});if(clearTimeout(e),!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const n=yield a.json();return(n==null?void 0:n.message)||n||[]}catch(t){return t.name==="AbortError"?o.warn("Stock fetch timeout"):o.error("Error fetching stock from server",t),[]}})}function q(){return c(this,null,function*(){if(F){o.debug("Stock sync already running, skipping");return}if(!v||C){o.debug("Stock sync skipped: Server offline");return}try{F=!0;const t=Date.now(),e=yield Le();if(e.length>0){const r=yield ee(e);R=Date.now();const s=R-t;o.success(`Stock sync completed: ${r.updated}/${e.length} items updated in ${s}ms`),self.postMessage({type:"STOCK_SYNC_COMPLETE",payload:{updated:r.updated,total:e.length,duration:s,timestamp:R}})}else o.debug("Stock sync: No updates received")}catch(t){o.error("Stock sync failed",t),self.postMessage({type:"STOCK_SYNC_ERROR",payload:{message:t.message,timestamp:Date.now()}})}finally{F=!1}})}function te(){if(I){o.debug("Stock sync already running");return}L=!0,q().catch(t=>{o.error("Initial stock sync failed",t)}),I=setInterval(()=>{q().catch(t=>{o.error("Periodic stock sync failed",t)})},D),o.success(`Periodic stock sync started (interval: ${D}ms)`)}function re(){I&&(clearInterval(I),I=null,L=!1,o.info("Periodic stock sync stopped"))}function De({warehouse:t,itemCodes:e,intervalMs:r}){let s=!1;return t!==void 0&&(M=t,o.debug(`Stock sync warehouse set: ${t}`),s=!0),e!==void 0&&Array.isArray(e)&&($=new Set(e),o.debug(`Stock sync tracking ${e.length} items`),s=!0),r!==void 0&&r>=1e4&&(D=r,o.debug(`Stock sync interval set: ${r}ms`),s=!0),s&&L&&(re(),te()),{warehouse:M,itemCount:$.size,intervalMs:D,enabled:L,lastSync:R}}function B(){return{enabled:L,warehouse:M,itemCount:$.size,intervalMs:D,lastSync:R,running:F}}self.onmessage=t=>c(se,null,function*(){const{type:e,payload:r,id:s}=t.data;try{let a;switch(e){case"SET_CSRF_TOKEN":Y=r.token,a={success:!0};break;case"PING_SERVER":a=yield H();break;case"CHECK_OFFLINE":a=we(r.browserOnline);break;case"GET_INVOICE_COUNT":a=yield J();break;case"GET_INVOICES":a=yield be();break;case"SAVE_INVOICE":a=yield ye(r.invoiceData);break;case"SEARCH_ITEMS":a=yield Ee(r.searchTerm,r.limit);break;case"SEARCH_CUSTOMERS":a=yield _e(r.searchTerm,r.limit);break;case"CACHE_ITEMS":a=yield Se(r.items);break;case"CACHE_CUSTOMERS":a=yield Ce(r.customers);break;case"CLEAR_ITEMS_CACHE":a=yield Te();break;case"CLEAR_CUSTOMERS_CACHE":a=yield ke();break;case"REMOVE_ITEMS_BY_GROUPS":a=yield ve(r.itemGroups);break;case"GET_METRICS":a=pe();break;case"CACHE_PAYMENT_METHODS":a=yield Oe(r.paymentMethods);break;case"GET_PAYMENT_METHODS":a=yield Ae(r.posProfile);break;case"IS_CACHE_READY":a=yield Ne();break;case"GET_CACHE_STATS":a=yield Ie();break;case"DELETE_INVOICE":a=yield Re(r.id);break;case"SET_MANUAL_OFFLINE":C=r.value,self.postMessage({type:"SERVER_STATUS_CHANGE",payload:{serverOnline:v&&!C,manualOffline:C}}),a={success:!0,manualOffline:C};break;case"UPDATE_STOCK_QUANTITIES":a=yield ee(r.stockUpdates);break;case"START_STOCK_SYNC":te(),a={success:!0,status:B()};break;case"STOP_STOCK_SYNC":re(),a={success:!0,status:B()};break;case"CONFIGURE_STOCK_SYNC":a=De(r);break;case"GET_STOCK_SYNC_STATUS":a=B();break;case"TRIGGER_STOCK_SYNC":yield q(),a={success:!0,status:B()};break;default:throw new Error(`Unknown message type: ${e}`)}self.postMessage({type:"SUCCESS",id:s,payload:a})}catch(a){self.postMessage({type:"ERROR",id:s,payload:{message:a.message,stack:a.stack}})}});function Me(){return c(this,null,function*(){try{yield g(),o.info("Database ready"),setInterval(()=>c(this,null,function*(){const e=yield H();self.postMessage({type:"SERVER_STATUS_CHANGE",payload:{serverOnline:e,manualOffline:C}})}),3e4);const t=yield H();self.postMessage({type:"WORKER_READY",payload:{serverOnline:t,manualOffline:C}}),o.success("Offline worker initialized and ready")}catch(t){o.error("Offline worker initialization failed",t),self.postMessage({type:"ERROR",payload:{message:`Worker initialization failed: ${t.message}`,stack:t.stack}})}})}Me()});export default $e();
